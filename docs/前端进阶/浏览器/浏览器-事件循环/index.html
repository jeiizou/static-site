<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-前端进阶/浏览器/浏览器-事件循环">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">浏览器-事件循环 | wiki &amp; blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wiki.jeiizou.site/docs/前端进阶/浏览器/浏览器-事件循环"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="浏览器-事件循环 | wiki &amp; blog"><meta data-rh="true" name="description" content="尽管 JS 运行异步 JS 代码, 但实际上, JS 本身并没有内建异步的概念."><meta data-rh="true" property="og:description" content="尽管 JS 运行异步 JS 代码, 但实际上, JS 本身并没有内建异步的概念."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wiki.jeiizou.site/docs/前端进阶/浏览器/浏览器-事件循环"><link data-rh="true" rel="alternate" href="https://wiki.jeiizou.site/docs/前端进阶/浏览器/浏览器-事件循环" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://wiki.jeiizou.site/docs/前端进阶/浏览器/浏览器-事件循环" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R2IYF7ETH7-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="wiki &amp; blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="wiki &amp; blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="wiki &amp; blog JSON Feed">



<link rel="search" type="application/opensearchdescription+xml" title="wiki &amp; blog" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c961b78e.css">
<link rel="preload" href="/assets/js/runtime~main.82983e27.js" as="script">
<link rel="preload" href="/assets/js/main.8393f512.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_B8Ea">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_cmch"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">WIKI.JEIIZOU.SITE</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Wiki</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/jeiizou" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_dbYH"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_aLgs"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_Wbdk colorModeToggle_qKyZ"><button class="clean-btn toggleButton_ZMwS toggleButtonDisabled_bkOl" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v5D6"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ZxuA"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_Bh6J docsWrapper_Q1yX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_wVrL" type="button"></button><div class="docPage_ZAu3"><aside class="theme-doc-sidebar-container docSidebarContainer_ZFCQ"><div class="sidebar_d_V8 sidebarWithHideableNavbar_DHfV"><a tabindex="-1" class="sidebarLogo_VhE4" href="/"><b>WIKI.JEIIZOU.SITE</b></a><nav class="menu thin-scrollbar menu_mA06"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Wiki For Front End Developer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/前端基础/JavsScript/原理-类型与文法">前端基础</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/前端进阶/前端工程/Babel/Babel-插件">前端进阶</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/前端工程/Babel/Babel-插件">前端工程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/前端框架/Lit-Element快速入门">前端框架</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/小程序/Taro-框架原理">小程序</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/微前端/ModuleFederationinWebpack5">微前端</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/性能优化/优化-CSS">性能优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/前端进阶/浏览器/V8/V8-内存">浏览器</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/浏览器/V8/V8-内存">V8</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-CDP">浏览器-CDP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-事件循环">浏览器-事件循环</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-前端路由">浏览器-前端路由</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-原理">浏览器-原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-存储">浏览器-存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-缓存">浏览器-缓存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-网页状态">浏览器-网页状态</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-跨域">浏览器-跨域</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端进阶/浏览器/浏览器-跨页面通信">浏览器-跨页面通信</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端进阶/移动端/JSBridge概述">移动端</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/计算机网络/CDN原理">计算机网络</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/数据结构与算法/DFS&amp;BFS">数据结构与算法</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/服务端/Nginx常用配置">服务端</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/架构&amp;模式&amp;工程/ShapeUp工作流">架构&amp;模式&amp;工程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/图形学/WebGL-GLSL语法">图形学</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/信息安全/网络安全/安全-常见安全策略">信息安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/其他/Git/Git-GitFlow">其他</a></div></li></ul></nav></div></aside><main class="docMainContainer_l9Db"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_lDak"><div class="docItemContainer_Nuls"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_MUoR" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_API8"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">前端进阶</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">浏览器</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">浏览器-事件循环</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_FtTS theme-doc-toc-mobile tocMobile_l5fy"><button type="button" class="clean-btn tocCollapsibleButton_Dnbe">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>浏览器-事件循环</h1><p>尽管 JS 运行异步 JS 代码, 但实际上, JS 本身并没有内建异步的概念.</p><p>JS 引擎没有运行在隔离的区域, 而是运行在一个宿主环境中, 它可能是浏览器, 或者 Node 这样的 Runtime. 所有的这些环境都有同样的机制: 事件轮询 (Event Loop).</p><p>JS的事件分为两种, 宏任务(macro-task)和微任务(micro-task).</p><ul><li><strong>宏任务</strong>: script全部代码, setTimeout, setInterval, setImmediate(浏览器暂不支持), I/O, UI render</li><li><strong>微任务</strong>: Promise.then, process.nectTick(Node), Object.observe(废弃)、MutationObserver . </li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="浏览器中的-event-loop">浏览器中的 Event-Loop<a class="hash-link" href="#浏览器中的-event-loop" title="标题的直接链接">​</a></h2><p>JavaScript有一个<code>main thread(主线程)</code>和<code>call-stack(调用栈, 或执行栈)</code>, 所有的任务都会被放到调用栈中等待主线程去执行.</p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="js-调用栈">JS 调用栈<a class="hash-link" href="#js-调用栈" title="标题的直接链接">​</a></h3><p>JS调用栈采用的是后进先出的规则, 当函数指定的时候, 会被添加到栈的顶部, 当执行栈执行完成后, 就会从栈顶移出, 直到栈内被清空.</p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="同步任务和异步任务">同步任务和异步任务<a class="hash-link" href="#同步任务和异步任务" title="标题的直接链接">​</a></h3><p>JS单线程任务被分为同步任务和异步任务, 同步任务会在调用栈中按照顺序等待主线程一次执行, 异步任务会在异步任务有了结果以后, 将注册的回调函数放入<strong>任务队列</strong>中等待主线程空闲的时候(调用栈被清空), 被读取到栈内等待主线程的执行.</p><p><img loading="lazy" alt="image" src="/assets/images/v2-55c58a901cf835e5e308e4360694505f_1440w-d92390a5c98877fb32a862037aafc843.jpg" width="636" height="518" class="img_wb0S"></p><p>任务队列<code>task Queue</code>, 是一个典型的队列结构, 也就是先进先出. </p><p>简单的说, 一个任务的执行流程会如下所示:</p><p><img loading="lazy" alt="image" src="/assets/images/v2-971a09fea16fff72db03d498245bc892_1440w-ad12725f04a11354a6f1552187c1abbc.jpg" width="1440" height="1204" class="img_wb0S"></p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="事件循环的进程模型">事件循环的进程模型<a class="hash-link" href="#事件循环的进程模型" title="标题的直接链接">​</a></h3><ul><li>选择当前的任务队列, 选择任务队列中最先进入的任务, 如果任务队列为空, 则跳转到执行微任务队列</li><li>将事件循环中的任务设置为已选择任务</li><li>执行任务</li><li>将事件循环中当前运行任务设置为null</li><li>将已经运行完成的任务从任务队列中删除</li><li>microtasks步骤: 进入mincrotask检查点<ul><li>设置microtask检查点标志为true</li><li>当事件循环mincrotask执行不为空:<ul><li>选择一个最先进入微任务队列的微任务</li><li>将事件循环的微任务设置为已选择的微任务</li><li>运行微任务</li><li>将已经执行的微任务设置为null</li><li>移除该微任务</li></ul></li><li>清理IndexDB食物</li><li>设置mincrotask检查点的标志位false</li></ul></li><li>更新界面渲染</li><li>返回第一步</li></ul><p>简单的来说, 就是执行栈在执行完<strong>同步任务</strong>后, 查看<strong>执行栈</strong>是否为空, 如果执行栈为孔明, 就会去执行<code>Task(宏任务)</code>, <strong>每次</strong>宏任务执行完毕后, 检查<code>microTask(微任务)</code>是否为空, 如果不为空, 按照先入先出的规则执行完全部的微任务, 然后重置<strong>微任务队列</strong>, 然后再执行<strong>宏任务</strong>. 如此循环.</p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="一个简单的例子">一个简单的例子<a class="hash-link" href="#一个简单的例子" title="标题的直接链接">​</a></h3><div class="language-js codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-js codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;script start&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">async1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">async2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;async1 end&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">async2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;async2 end&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">async1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;setTimeout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Promise&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;promise1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;promise2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;script end&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里, 首先输出第一次同步任务的结果:</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">script start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async2 end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scriptend</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里被推入到微任务队列中的有:</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">async1 end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise2</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以执行这些微任务. 注意这里的<code>promise2</code>是在执行微任务的过程中被推入到当前的微任务队列中的. </p><p>最后执行宏任务:</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">setTimeout</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="node-中的-event-loop">Node 中的 Event Loop<a class="hash-link" href="#node-中的-event-loop" title="标题的直接链接">​</a></h2><p>Node 中的 Event Loop 和浏览器中的是完全不相同的东西. Node.js 采用 v8 作为 js 的解析引擎, 而 I/O 处理方面使用了libuv, libuv是一个基于事件驱动的跨平台抽象层, libuv使用异步, 事件驱动的编程方式. 和兴是提供<code>i/o</code>的时间循环和异步回调. <code>libuv</code>的<code>api</code>包含: 时间(timer), 非阻塞的网络, 异步文件操作, 子进程等等. <code>Event Loop</code>就是在libuv中实现的. </p><p><img loading="lazy" alt="image" src="/assets/images/1683d81674f076eb-b7740907370db5a28f043f3076afe2ad.png" width="543" height="223" class="img_wb0S"></p><p>Node.js 的运行机制如下:</p><ul><li>V8 引擎解析 JS 脚本</li><li>解析后的代码调用 Node API</li><li>libuv 库负责 Node API 的执行. 它将不同的任务分配给不同的线程, 形成一个事件循环(Event Loop), 以异步的方式将任务的执行结果返回给 v8 引擎.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="六个阶段">六个阶段<a class="hash-link" href="#六个阶段" title="标题的直接链接">​</a></h3><p>其中 libuv 引擎中的事件分为 6 个阶段, 会按照顺序反复运行. 每当进入某一个阶段的时候, 都会从对应的回调队列中取出函数去执行, 当队列为空或者执行的回调函数数量达到系统设定的阈值, 就会进入下一阶段:</p><p><img loading="lazy" alt="image" src="data:image/png;base64,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" width="359" height="331" class="img_wb0S"></p><p>大致可以看出, 事件循环的事件是:</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">外部输入数据--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">轮询阶段(poll)--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查阶段(check)--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">关闭事件回调阶段(close callback)--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">定时器检测阶段(timer)--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I/O事件回调阶段(I/O callbacks)--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">闲置阶段(idle, prepare)--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">轮询阶段（按照该顺序反复运行）...</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>timers</code>: 执行 timer(setTimeout、setInterval)中到期的回调</li><li><code>pending callbacks</code>:  处理一些上一轮循环中的少数未执行的 I/O 回调</li><li><code>idle, prepare</code>: 仅 node 内部使用</li><li><code>poll</code>: 最重要的阶段, 执行<code>pending callback</code>, 在适当的情况下会阻塞在这个阶段</li><li><code>check</code>: 执行 setImmediate() 的回调, setImmediate是将事件插入到事件队列尾部, 主线程和事件队列的函数执行完成之后立即执行<code>setImmediate()</code>指定的回到函数. </li><li><code>close callbacks</code>: 执行 close 事件回调, 例如<code>socket.on(&#x27;close&#x27;[, fn])</code>或者<code>heep.server.on(&#x27;close&#x27;, fn)</code>.</li></ul><div class="language-js codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-js codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">   ┌───────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">│        timers         │</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">————— 执行 </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">、setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> 的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> 执行所有 </span><span class="token maybe-class-name">Next</span><span class="token plain"> </span><span class="token maybe-class-name">Tick</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 以及 </span><span class="token maybe-class-name">MicroTask</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────┴────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │     pending callbacks │</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">————— 执行由上一个 </span><span class="token maybe-class-name">Tick</span><span class="token plain"> 延迟下来的 </span><span class="token constant" style="color:#36acaa">I</span><span class="token operator" style="color:#393A34">/</span><span class="token constant" style="color:#36acaa">O</span><span class="token plain"> 回调（待完善，可忽略）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> 执行所有 </span><span class="token maybe-class-name">Next</span><span class="token plain"> </span><span class="token maybe-class-name">Tick</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 以及 </span><span class="token maybe-class-name">MicroTask</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────┴────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │     idle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prepare     │</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">————— 内部调用（可忽略）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬────────────┘     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> 执行所有 </span><span class="token maybe-class-name">Next</span><span class="token plain"> </span><span class="token maybe-class-name">Tick</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 以及 </span><span class="token maybe-class-name">MicroTask</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                   ┌───────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────┴────────────┐      │   incoming</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   │ </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">执行几乎所有的回调，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         poll          │</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">─────┤  connections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> │    除了 close callbacks </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬────────────┘      │   data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> etc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">  </span><span class="token property-access">│</span><span class="token plain">    以及 timers 调度的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">    和 </span><span class="token function" style="color:#d73a49">setImmediate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> 调度的回调，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                   └───────────────┘    在恰当的时机将会阻塞在此阶段</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> 执行所有 </span><span class="token maybe-class-name">Next</span><span class="token plain"> </span><span class="token maybe-class-name">Tick</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 以及 </span><span class="token maybe-class-name">MicroTask</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  ┌──────────┴────────────┐      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │        check          │</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">————— </span><span class="token function" style="color:#d73a49">setImmediate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> 的回调将会在这个阶段执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> 执行所有 </span><span class="token maybe-class-name">Next</span><span class="token plain"> </span><span class="token maybe-class-name">Tick</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 以及 </span><span class="token maybe-class-name">MicroTask</span><span class="token plain"> </span><span class="token maybe-class-name">Queue</span><span class="token plain"> 的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────┴────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──┤    close callbacks    │</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">————— socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;close&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └───────────────────────┘</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其实node和浏览器的区别, 就是node的MacroTask分为好几种, 而这些不同的宏任务队列之间又有顺序区别, 微任务队列穿插在每一种(不是每一个)宏任务队列之间.</p><p>如图里面写的:</p><ul><li><p>setTimeout/setInterval 属于<strong>timers</strong></p></li><li><p>setImmediate 属于<strong>check</strong>类型</p></li><li><p>socket的close事件属于<code>close callbacks</code>类型</p></li><li><p>其他<strong>宏任务</strong>就都是<strong>poll</strong>类型</p></li><li><p>process.nextTick 本质上属于<strong>微任务</strong>, 但它先于所有其他的微任务执行</p></li><li><p>所有微任务的执行时机, 是不同类型的idle/prepare 仅供内部调用，我们可以忽略。</p></li><li><p>idle/prepare 仅供内部调用，我们可以忽略。</p></li><li><p>pending callbacks 不太常见，我们也可以忽略。</p></li></ul><p>所以按照我们在浏览器中的经验, 可以得出一个结论:</p><ul><li>先执行所有任务类型为timers的宏任务, 然后执行所有微任务, 这里如果有nextTick, 要先执行nextTick</li><li>进入poll阶段, 执行几乎所有的宏任务, 再执行所有的微任务</li><li>执行所有类型为check的宏任务, 然后执行所有的微任务</li><li>执行所有的close, 执行所有的微任务</li></ul><p>到这里, 完成一个事件循环, 回到timer阶段.</p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="一个例子">一个例子<a class="hash-link" href="#一个例子" title="标题的直接链接">​</a></h3><div class="language-js codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-js codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;timer1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;promise1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;timer2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;promise2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个在浏览器环境下会输出:</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">timer1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timer2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise2</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里先执行timer1这个宏任务, 然后清空所有的微任务(promise1), 然后执行<code>timer2</code>这个宏任务, 在执行所有的微任务(promise2)</p><p>但是在node(&lt; 10)中的输出结果是不一样的:</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">timer1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timer2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise2</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>先执行所有的同类型的宏任务, 然后再执行所有的微任务</p><p>当然这里还有几个细节:</p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="settimeout-和-setimmediate">setTimeout 和 setImmediate<a class="hash-link" href="#settimeout-和-setimmediate" title="标题的直接链接">​</a></h3><p>前文说道timer是在check之前的, 但是实际上, Node不能保证timer在预设的时间到了之后就会立即执行, 因为Node对timers的过期检测不一定靠谱, 而是会受到系统调度的影响. 比如下面的代码:</p><div class="language-js codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-js codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;timeout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setImmediate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;immediate&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然setTimeout延时是0, 但是Node会把0设置为1ms, 所以当node准备eventloop的时间大于1ms时, 进入timer阶段, setTimeout已经到期了, 就会执行setTimeout, 反之, 就会错过timers阶段, 先执行setImmediate</p><div class="codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-text codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token plain">immediate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timeout</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不过有一种情况, 顺序是固定:</p><div class="language-js codeBlockContainer_x9vG theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XBdA"><pre tabindex="0" class="prism-code language-js codeBlock_E3X_ thin-scrollbar"><code class="codeBlockLines_WzRP"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;test.txt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;readFile&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;timeout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setImmediate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;immediate&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_JJJj"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_lfBc" aria-hidden="true"><svg class="copyButtonIcon_fJbv" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YUzz" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在这种情况下, setTimeout和setImmediate是卸载I/O callcaks中的, 这就意味着我们处在<code>poll</code>阶段, 然后是<code>check</code>阶段, 所以这时无论settimerout怎么快, 都会先执行setImmediate.</p><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="poll-阶段">poll 阶段<a class="hash-link" href="#poll-阶段" title="标题的直接链接">​</a></h3><p>poll阶段主要有两个功能:</p><ul><li>获取新的I/O事件, 并执行这些I/O回调, 之后适当的条件下把node阻塞在这里</li><li>当有immediate或者已经超时的timers, 在这里执行他们的回调</li></ul><p>poll阶段用于获取并执行几乎所有的I/O事件回调, 是是的node event loop得以无限循环下去的重要阶段. 所以它的首要任务就是同步执行所有<code>poll queue</code>中的所有callbacks直到queue被清空或者已经执行的<code>callbacks</code>达到一定的上限, 然后结束poll阶段, 接下来会有几种情况:</p><ol><li>setImmediate的queue不为空, 则进入check阶段, 然后是close callbacks阶段...</li><li>setImmediate的queue为空, 但是timers的queue不为空, 则直接进入timers阶段, 然后又来到了poll阶段</li><li>setImmediate的queue为空, timers的queue也为空, 则会阻塞在这里, 因为已经无事可做了.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="pending-callback-阶段">pending callback 阶段<a class="hash-link" href="#pending-callback-阶段" title="标题的直接链接">​</a></h3><p>在libuv的event loop中, I/O callbacks阶段会执行pending callbacks. 绝大所述情况下, 在poll阶段, 所有的I/O回调都已经被执行, 但是在某些情况下, 会有一些回调被延迟到下一次循环执行. 也就是说, 在<code>I/O callbacks</code>阶段中执行的回调函数, 是上一次事件循环中被延迟执行的回调函数. </p><p>严格来说，<code>i/o callbacks</code>并不是处理文件<code>i/o的callback</code>而是处理一些系统调用错误，比如网络 stream, pipe, tcp, udp通信的错误callback。</p><h2 class="anchor anchorWithHideOnScrollNavbar_rm2F" id="参考链接">参考链接<a class="hash-link" href="#参考链接" title="标题的直接链接">​</a></h2><ul><li><a href="https://juejin.im/post/5c337ae06fb9a049bc4cd218#heading-12" target="_blank" rel="noopener noreferrer">浏览器与 Node 的事件循环(Event Loop)有何区别?</a></li><li><a href="https://www.jianshu.com/p/deedcbf68880" target="_blank" rel="noopener noreferrer">nodejs 中的 event loop</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/前端进阶/浏览器/浏览器-CDP"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">浏览器-CDP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/前端进阶/浏览器/浏览器-前端路由"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">浏览器-前端路由</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_a_w_ thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#浏览器中的-event-loop" class="table-of-contents__link toc-highlight">浏览器中的 Event-Loop</a><ul><li><a href="#js-调用栈" class="table-of-contents__link toc-highlight">JS 调用栈</a></li><li><a href="#同步任务和异步任务" class="table-of-contents__link toc-highlight">同步任务和异步任务</a></li><li><a href="#事件循环的进程模型" class="table-of-contents__link toc-highlight">事件循环的进程模型</a></li><li><a href="#一个简单的例子" class="table-of-contents__link toc-highlight">一个简单的例子</a></li></ul></li><li><a href="#node-中的-event-loop" class="table-of-contents__link toc-highlight">Node 中的 Event Loop</a><ul><li><a href="#六个阶段" class="table-of-contents__link toc-highlight">六个阶段</a></li><li><a href="#一个例子" class="table-of-contents__link toc-highlight">一个例子</a></li><li><a href="#settimeout-和-setimmediate" class="table-of-contents__link toc-highlight">setTimeout 和 setImmediate</a></li><li><a href="#poll-阶段" class="table-of-contents__link toc-highlight">poll 阶段</a></li><li><a href="#pending-callback-阶段" class="table-of-contents__link toc-highlight">pending callback 阶段</a></li></ul></li><li><a href="#参考链接" class="table-of-contents__link toc-highlight">参考链接</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 WIKI.JEIIZOU.SITE, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.82983e27.js"></script>
<script src="/assets/js/main.8393f512.js"></script>
</body>
</html>