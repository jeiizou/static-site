"use strict";(self.webpackChunkwiki_site=self.webpackChunkwiki_site||[]).push([[1890],{50158:(e,n,a)=>{a.d(n,{Zo:()=>k,kt:()=>m});var t=a(46393);function l(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function p(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){l(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,l=function(e,n){if(null==e)return{};var a,t,l={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(l[a]=e[a]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var i=t.createContext({}),s=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):p(p({},n),e)),a},k=function(e){var n=s(e.components);return t.createElement(i.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var a=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,k=o(e,["components","mdxType","originalType","parentName"]),u=s(a),m=l,d=u["".concat(i,".").concat(m)]||u[m]||c[m]||r;return a?t.createElement(d,p(p({ref:n},k),{},{components:a})):t.createElement(d,p({ref:n},k))}));function m(e,n){var a=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=a.length,p=new Array(r);p[0]=u;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:l,p[1]=o;for(var s=2;s<r;s++)p[s]=a[s];return t.createElement.apply(null,p)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},90078:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>p,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var t=a(39421),l=(a(46393),a(50158));const r={},p="Webpack-\u7684\u65b0\u7279\u6027",o={unversionedId:"\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack/Webpack-\u7684\u65b0\u7279\u6027",id:"\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack/Webpack-\u7684\u65b0\u7279\u6027",title:"Webpack-\u7684\u65b0\u7279\u6027",description:"webpack 5 \u57282020\u5e74\u768410\u6708\u6b63\u5f0f\u53d1\u5e03, \u6574\u4f53\u4e0a\u7684\u65b9\u5411\u6027\u53d8\u5316\u5982\u4e0b:",source:"@site/docs/02-\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack/Webpack-\u7684\u65b0\u7279\u6027.md",sourceDirName:"02-\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack",slug:"/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack/Webpack-\u7684\u65b0\u7279\u6027",permalink:"/docs/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack/Webpack-\u7684\u65b0\u7279\u6027",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Webpack-\u6982\u89c8",permalink:"/docs/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/Webpack/Webpack-\u6982\u89c8"},next:{title:"\u539f\u7406-SourceMap",permalink:"/docs/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u5de5\u7a0b/\u539f\u7406-SourceMap"}},i={},s=[{value:"\u7f16\u8bd1\u65f6\u65b0\u7279\u6027",id:"\u7f16\u8bd1\u65f6\u65b0\u7279\u6027",level:2},{value:"\u5185\u7f6e\u9759\u6001\u8d44\u6e90\u6784\u5efa\u80fd\u529b -- asset modules",id:"\u5185\u7f6e\u9759\u6001\u8d44\u6e90\u6784\u5efa\u80fd\u529b----asset-modules",level:3},{value:"\u5185\u7f6eFileSystem Cache\u80fd\u529b\u52a0\u901f\u4e8c\u6b21\u6784\u5efa",id:"\u5185\u7f6efilesystem-cache\u80fd\u529b\u52a0\u901f\u4e8c\u6b21\u6784\u5efa",level:3},{value:"\u5185\u7f6eWebAssembly\u7f16\u8bd1\u4ee5\u53ca\u5f02\u6b65\u52a0\u8f7d\u80fd\u529b (sync/async)",id:"\u5185\u7f6ewebassembly\u7f16\u8bd1\u4ee5\u53ca\u5f02\u6b65\u52a0\u8f7d\u80fd\u529b-syncasync",level:3},{value:"\u5185\u7f6e web worker \u6784\u5efa\u80fd\u529b",id:"\u5185\u7f6e-web-worker-\u6784\u5efa\u80fd\u529b",level:3},{value:"\u8fd0\u884c\u65f6\u65b0\u7279\u6027",id:"\u8fd0\u884c\u65f6\u65b0\u7279\u6027",level:2},{value:"\u79fb\u9664\u4e86<code>Node.js polyfill</code>.",id:"\u79fb\u9664\u4e86nodejs-polyfill",level:3},{value:"\u65b0\u589e\u4e86<code>Prepack</code>",id:"\u65b0\u589e\u4e86prepack",level:3},{value:"\u6df1\u5ea6\u7684<code>tree shaking</code>",id:"\u6df1\u5ea6\u7684tree-shaking",level:3},{value:"\u66f4\u53cb\u597d\u7684Long Term Cache\u652f\u6301\u6027, chunkid\u4e0d\u53d8",id:"\u66f4\u53cb\u597d\u7684long-term-cache\u652f\u6301\u6027-chunkid\u4e0d\u53d8",level:3},{value:"\u652f\u6301 Top Level Await, \u4ece\u6b64\u544a\u522b async",id:"\u652f\u6301-top-level-await-\u4ece\u6b64\u544a\u522b-async",level:3},{value:"\u6a21\u5757\u8054\u90a6",id:"\u6a21\u5757\u8054\u90a6",level:2},{value:"NPM \u6a21\u5757\u5171\u4eab\u673a\u5236",id:"npm-\u6a21\u5757\u5171\u4eab\u673a\u5236",level:3},{value:"UMD \u6a21\u5757\u5171\u4eab\u673a\u5236",id:"umd-\u6a21\u5757\u5171\u4eab\u673a\u5236",level:3},{value:"\u5fae\u524d\u7aef\u65b9\u5f0f\u5171\u4eab\u6a21\u5757",id:"\u5fae\u524d\u7aef\u65b9\u5f0f\u5171\u4eab\u6a21\u5757",level:3},{value:"\u6a21\u5757\u8054\u90a6\u65b9\u5f0f",id:"\u6a21\u5757\u8054\u90a6\u65b9\u5f0f",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}],k={toc:s};function c(e){let{components:n,...r}=e;return(0,l.kt)("wrapper",(0,t.Z)({},k,r,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"webpack-\u7684\u65b0\u7279\u6027"},"Webpack-\u7684\u65b0\u7279\u6027"),(0,l.kt)("p",null,"webpack 5 \u57282020\u5e74\u768410\u6708\u6b63\u5f0f\u53d1\u5e03, \u6574\u4f53\u4e0a\u7684\u65b9\u5411\u6027\u53d8\u5316\u5982\u4e0b:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6301\u4e45\u5316\u786c\u76d8\u7f13\u5b58\u63d0\u9ad8\u6784\u5efa\u6027\u80fd"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u66f4\u597d\u7684\u7b97\u6cd5\u6539\u8fdb\u957f\u671f\u7f13\u5b58"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u66f4\u597d\u7684Tree Shaking\u80fd\u529b\u548c\u4ee3\u7801\u7684\u751f\u6210\u903b\u8f91\u6765\u4f18\u5316\u4ea7\u7269\u7684\u5927\u5c0f"),(0,l.kt)("li",{parentName:"ul"},"\u6539\u5584web\u5e73\u53f0\u7684\u517c\u5bb9\u6027\u80fd\u529b"),(0,l.kt)("li",{parentName:"ul"},"\u6e05\u9664\u5185\u90e8\u7ed3\u6784\u4e2d\u4e00\u4e9b\u5947\u602a\u7684state"),(0,l.kt)("li",{parentName:"ul"},"\u5f15\u5165\u4e00\u4e9b\u91cd\u5927\u7684\u53d8\u66f4\u4e3a\u672a\u6765\u7684\u7279\u6027\u505a\u51c6\u5907")),(0,l.kt)("p",null,"\u4e0b\u9762\u5c31\u6765\u4e00\u4e00\u4ecb\u7ecdwebpakc5\u4e2d\u7684\u4e00\u4e9b\u65b0\u7279\u6027"),(0,l.kt)("h2",{id:"\u7f16\u8bd1\u65f6\u65b0\u7279\u6027"},"\u7f16\u8bd1\u65f6\u65b0\u7279\u6027"),(0,l.kt)("h3",{id:"\u5185\u7f6e\u9759\u6001\u8d44\u6e90\u6784\u5efa\u80fd\u529b----asset-modules"},"\u5185\u7f6e\u9759\u6001\u8d44\u6e90\u6784\u5efa\u80fd\u529b -- asset modules"),(0,l.kt)("p",null,"\u5728webpack5\u4e4b\u524d, \u6211\u4eec\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528\u5404\u79cd\u6587\u4ef6\u7c7b\u578b\u7684loader\u6765\u5904\u7406\u5e38\u89c1\u7684\u9759\u6001\u8d44\u6e90, \u6bd4\u5982:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"raw-loader: \u5c06\u6587\u4ef6\u5904\u7406\u6210\u5b57\u7b26\u4e32\u5bfc\u5165"),(0,l.kt)("li",{parentName:"ul"},"file-loader: \u5c06\u6587\u4ef6\u6253\u5305\u5bfc\u51fa"),(0,l.kt)("li",{parentName:"ul"},"url-loader: \u5f53\u6587\u4ef6\u5927\u5c0f\u8fbe\u5230\u8981\u6c42\u7684\u5927\u5c0f\u7684\u65f6\u5019, \u5c31\u53ef\u4ee5\u5c06\u5176\u5904\u7406\u6210base64\u7684URIS, \u5185\u7f6efile-loader")),(0,l.kt)("p",null,"\u800c\u73b0\u5728webpack5\u63d0\u4f9b\u4e86\u5185\u7f6e\u7684\u9759\u6001\u8d44\u6e90\u6784\u5efa\u80fd\u529b, \u53ef\u4ee5\u4e0d\u9700\u8981\u5b89\u88c5\u989d\u5916\u7684loader, \u4ec5\u9700\u8981\u7b80\u5355\u7684\u914d\u7f6e\u5c31\u80fd\u5b9e\u73b0\u9759\u6001\u8d44\u6e90\u7684\u6253\u5305\u548c\u5206\u76ee\u5f55\u5b58\u653e."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// webpack.config.js\nmodule.exports = {\n    ...,\n    module: {\n      rules: [\n          {\n            test: /\\.(png|jpg|svg|gif)$/,\n            type: 'asset/resource',\n            generator: {\n                // [ext]\u524d\u9762\u81ea\u5e26\".\"\n                filename: 'assets/[hash:8].[name][ext]',\n            },\n        },\n      ],\n    },\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"asset/source"),": \u7c7b\u4f3c\u4e8e raw-loader"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"asset/inline"),": \u7c7b\u4f3c\u4e8e url-loader"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"asset/resource"),": \u7c7b\u4f3c\u4e8e file-loader"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"asset"),": \u9ed8\u8ba4\u4f1a\u6839\u636e\u6587\u4ef6\u5927\u5c0f\u6765\u9009\u62e9\u4f7f\u7528\u54ea\u79cd\u7c7b\u578b, \u5f53\u6587\u4ef6\u5c0f\u4e8e8kb\u7684\u65f6\u5019\u4f1a\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"asset/inline"),"\u6a21\u5f0f, \u5426\u5219\u4f1a\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"asset/resource"),"\u6a21\u5f0f.")),(0,l.kt)("h3",{id:"\u5185\u7f6efilesystem-cache\u80fd\u529b\u52a0\u901f\u4e8c\u6b21\u6784\u5efa"},"\u5185\u7f6eFileSystem Cache\u80fd\u529b\u52a0\u901f\u4e8c\u6b21\u6784\u5efa"),(0,l.kt)("p",null,"webpack5\u4e4b\u524d, \u6211\u4eec\u4f1a\u4f7f\u7528cache-loader\u7f13\u5b58\u4e00\u4e9b\u6027\u80fd\u5f00\u9500\u6bd4\u8f83\u5927\u7684loader, \u6216\u8005\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"hard-source-webpack-plugin"),"\u4e3a\u6a21\u5757\u63d0\u4f9b\u4e00\u4e9b\u4e2d\u95f4\u7f13\u5b58. \u5728webpack5\u4e4b\u540e, \u9ed8\u8ba4\u5c31\u96c6\u6210\u4e86\u4e00\u79cd\u81ea\u5e26\u7684\u7f13\u5b58\u80fd\u529b."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// webpack.config.js\nmodule.exports = {\n    ...,\n    cache: {\n        type: 'filesystem',\n        // \u53ef\u9009\u914d\u7f6e\n        buildDependencies: {\n            config: [__filename],  // \u5f53\u6784\u5efa\u4f9d\u8d56\u7684config\u6587\u4ef6\uff08\u901a\u8fc7 require \u4f9d\u8d56\uff09\u5185\u5bb9\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u7f13\u5b58\u5931\u6548\n        },\n        name: '',  // \u914d\u7f6e\u4ee5name\u4e3a\u9694\u79bb\uff0c\u521b\u5efa\u4e0d\u540c\u7684\u7f13\u5b58\u6587\u4ef6\uff0c\u5982\u751f\u6210PC\u6216mobile\u4e0d\u540c\u7684\u914d\u7f6e\u7f13\u5b58\n        ...,\n    },\n}\n")),(0,l.kt)("p",null,"\u751f\u4ea7\u73af\u5883\u4e0b\u9ed8\u8ba4\u7684\u7f13\u5b58\u5b58\u653e\u76ee\u5f55\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"node_modules/.cache/webpack.default-production"),"."),(0,l.kt)("p",null,"\u5982\u679c\u4f60\u76f4\u63a5\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"webpack compiler"),"\u5b9e\u4f8b\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"run"),"\u65b9\u6cd5\u6765\u6267\u884c\u5b9a\u5236\u5316\u6784\u5efa\u64cd\u4f5c\u7684\u65f6\u5019, \u9700\u8981\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"compiler.close"),"\u53bb\u8f93\u51fa\u7f13\u5b58\u6587\u4ef6."),(0,l.kt)("h3",{id:"\u5185\u7f6ewebassembly\u7f16\u8bd1\u4ee5\u53ca\u5f02\u6b65\u52a0\u8f7d\u80fd\u529b-syncasync"},"\u5185\u7f6eWebAssembly\u7f16\u8bd1\u4ee5\u53ca\u5f02\u6b65\u52a0\u8f7d\u80fd\u529b (sync/async)"),(0,l.kt)("p",null,"webAssembly \u88ab\u8bbe\u8ba1\u4e3a\u4e00\u79cd\u9762\u5411web\u7684\u4e8c\u8fdb\u5236\u7684\u683c\u5f0f\u6587\u4ef6, \u4ee5\u5176\u66f4\u63a5\u8fd1\u4e8e\u673a\u5668\u7801\u800c\u62e5\u6709\u66f4\u5c0f\u7684\u6587\u4ef6\u4f53\u79ef\u548c\u66f4\u5feb\u7684\u6267\u884c\u5c0f\u8def."),(0,l.kt)("p",null,"webpack5\u662f\u62d3\u5c55\u4e86webpack4\u7684wasm\u7684\u52a0\u8f7d\u80fd\u529b, \u53ef\u4ee5\u8fdb\u884c\u5f02\u6b65\u52a0\u8f7d."),(0,l.kt)("p",null,"\u5728webpack5\u4e4b\u524d, \u662f\u9700\u8981\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"wasm-loader"),"\u53bb\u914d\u7f6ewasm\u6587\u4ef6\u7684\u5904\u7406\u7684, \u57285\u91cc\u9762\u5c31\u4e0d\u9700\u8981\u4e86:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// webpack.config.js\nmodule.exports = {\n    ...,\n    experiments: {\n        asyncWebAssembly: true,\n    },\n    module: {\n        rules: [\n            ...,\n           {\n                test: /\\.wasm$/,\n                type: 'webassembly/async',\n            },\n         ],\n    },\n}\n")),(0,l.kt)("p",null,"\u8981\u7528\u7684\u65f6\u5019, \u5c31\u76f4\u63a5\u5f15\u5165:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import { sum } from './program.wasm'\nconsole.log(sum(1, 2))\n")),(0,l.kt)("h3",{id:"\u5185\u7f6e-web-worker-\u6784\u5efa\u80fd\u529b"},"\u5185\u7f6e web worker \u6784\u5efa\u80fd\u529b"),(0,l.kt)("p",null,"web worker \u4e3aweb\u540e\u53f0\u7ebf\u7a0b\u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u6cd5. \u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u4efb\u52a1\u4e8c\u4e0d\u5e72\u6270\u7528\u6237\u754c\u9762. \u901a\u5e38, \u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e9b\u52a0\u89e3\u5bc6\u6216\u8005\u56fe\u7247\u5904\u7406\u7b49\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u7b97\u6cd5\u81f3\u4e8e\u5b50\u7ebf\u7a0b\u4e2d, \u5f53\u6267\u884c\u5b8c\u6210\u540e\u518d\u548c\u4e3b\u7ebf\u7a0b\u901a\u4fe1."),(0,l.kt)("p",null,"\u5728webpack5\u4e4b\u524d, \u9700\u8981\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"worker-loader"),"\u6765\u5904\u7406:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// webpack.config.js\nmodule.exports = {\n    ...,\n     module: {\n        rules: [\n            {\n                test: /\\.worker\\.js$/,\n                use: { loader: 'worker-loader' },\n            },\n        ],\n    },\n}\n")),(0,l.kt)("p",null,"\u7136\u540e\u5728\u4f7f\u7528\u7684\u65f6\u5019, \u5c31\u80fd\u76f4\u63a5\u6784\u9020\u4e00\u4e2aworker\u5bf9\u8c61:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// master.js\nimport Worker from './calc.worker.js';\nconst worker = new Worker();\nworker.onmessage = e => {\n  console.log(e.data.value);\n};\n")),(0,l.kt)("p",null,"\u5728webpack5\u4e2d, \u5c31\u4e0d\u9700\u8981\u6dfb\u52a0loader\u7684\u5904\u7406\u65b9\u5f0f, \u5e76\u4e14\u4e0d\u9700\u8981\u9488\u5bf9worker\u914d\u7f6e\u7279\u5b9a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"work.js"),"\u4e4b\u7c7b\u7684\u6587\u4ef6\u540d. \u76f4\u63a5\u501f\u52a9URL\u5c31\u884c\u4e86."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'// master.js\nconst worker = new Worker(new URL(\'./calc.js\', import.meta.url), {\n    name: "calc"\n  /* webpackEntryOptions: { filename: "workers/[name].js" } */\n});\nworker.onmessage = e => {\n  console.log(e.data.value);\n};\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5728new URL()\u4e2d\u4e0d\u80fd\u4f7f\u7528.worker.js\u547d\u540d\u6587\u4ef6\uff0c\u5426\u5219\u4f1a\u4f18\u5148\u88ab worker-loader \u89e3\u6790\u800c\u5bfc\u81f4\u6700\u7ec8\u4f60\u7684 worker \u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c")),(0,l.kt)("h2",{id:"\u8fd0\u884c\u65f6\u65b0\u7279\u6027"},"\u8fd0\u884c\u65f6\u65b0\u7279\u6027"),(0,l.kt)("h3",{id:"\u79fb\u9664\u4e86nodejs-polyfill"},"\u79fb\u9664\u4e86",(0,l.kt)("inlineCode",{parentName:"h3"},"Node.js polyfill"),"."),(0,l.kt)("p",null,"\u9700\u8981\u81ea\u5df1\u914d\u7f6e\u5bf9\u5e94\u7684nodejs\u7684process"),(0,l.kt)("h3",{id:"\u65b0\u589e\u4e86prepack"},"\u65b0\u589e\u4e86",(0,l.kt)("inlineCode",{parentName:"h3"},"Prepack")),(0,l.kt)("p",null,"\u4f1a\u5728\u7f16\u8bd1\u9636\u6bb5\u751f\u6210\u4f18\u5316\u540e\u4ee3\u7801"),(0,l.kt)("h3",{id:"\u6df1\u5ea6\u7684tree-shaking"},"\u6df1\u5ea6\u7684",(0,l.kt)("inlineCode",{parentName:"h3"},"tree shaking")),(0,l.kt)("p",null,"\u80fd\u591f\u5728\u6253\u5305\u7684\u8fc7\u7a0b\u4e2d\u79fb\u9664js\u4e0a\u4e0b\u6587\u4e2d\u6ca1\u6709\u88ab\u5f15\u7528\u5230\u7684\u53d8\u91cf, \u6765\u51cf\u5c11\u6253\u5305\u540e\u7684\u4f53\u79ef. \u7279\u522b\u662f\u80fd\u591f\u652f\u6301\u6df1\u5c42\u5d4c\u5957\u7684export\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"tree shaking")),(0,l.kt)("h3",{id:"\u66f4\u53cb\u597d\u7684long-term-cache\u652f\u6301\u6027-chunkid\u4e0d\u53d8"},"\u66f4\u53cb\u597d\u7684Long Term Cache\u652f\u6301\u6027, chunkid\u4e0d\u53d8"),(0,l.kt)("p",null,"webpack5\u4e4b\u524d, \u6587\u4ef6\u6253\u5305\u540e\u7684\u540d\u79f0\u662f\u6839\u636eID\u987a\u5e8f\u6392\u5217\u7684, \u4e00\u65e6\u540e\u7eed\u6709\u4e86\u4e00\u4e2a\u6587\u4ef6\u8fdb\u884c\u6539\u52a8, \u5c31\u4f1a\u9020\u6210\u540e\u9762\u7684\u6587\u4ef6\u6253\u5305\u51fa\u6765\u7684\u6587\u4ef6\u540d\u4ea7\u751f\u53d8\u5316. \u5373\u4f7f\u6587\u4ef6\u5185\u5bb9\u6ca1\u6709\u4ea7\u751f\u6539\u53d8. \u4e5f\u4f1a\u9020\u6210\u8d44\u6e90\u7f13\u5b58\u7684\u5931\u8d25."),(0,l.kt)("p",null,"webpack5\u6709\u4e86\u66f4\u597d\u7684\u957f\u671f\u7f13\u5b58\u80fd\u529b\u652f\u6301, \u5176\u901a\u8fc7hash\u751f\u6210\u7b97\u6cd5, \u4e3a\u6253\u5305\u540e\u7684modules\u548cchunks\u8ba1\u7b97\u51fa\u4e86\u4e00\u4e2a\u77ed\u7684\u6570\u5b57ID, \u8fd9\u6837\u5373\u4fbf\u4e2d\u95f4\u5220\u9664\u4e86\u67d0\u4e2a\u6587\u4ef6, \u4e5f\u4e0d\u4f1a\u9020\u6210\u5927\u91cf\u7684\u6587\u4ef6\u7f13\u5b58\u5931\u6548."),(0,l.kt)("p",null,"\u5e76\u4e14, webpack5\u4f7f\u7528\u4e86\u771f\u5b9e\u7684contenthash\u6765\u652f\u6301\u66f4\u53cb\u597d\u7684long term cache. \u610f\u601d\u662f\u5982\u679c\u4f60\u7684\u903b\u8f91\u91cc\u9762\u53ea\u662f\u5220\u9664\u4e86\u6ce8\u91ca\u6216\u8005\u6539\u4e86\u4e00\u4e2a\u53d8\u91cf\u540d\u79f0, \u672c\u8d28\u4e0a\u4f60\u7684\u4ee3\u7801\u903b\u8f91\u662f\u6ca1\u6709\u53d8\u5316\u7684, \u6240\u4ee5\u5bf9\u4e8e\u538b\u7f29\u540e\u7684\u6587\u4ef6\u8fd9\u4e9b\u5185\u5bb9\u7684\u53d8\u66f4\u4e0d\u4f1a\u5bfc\u81f4",(0,l.kt)("inlineCode",{parentName:"p"},"contenthash"),"\u53d8\u5316."),(0,l.kt)("h3",{id:"\u652f\u6301-top-level-await-\u4ece\u6b64\u544a\u522b-async"},"\u652f\u6301 Top Level Await, \u4ece\u6b64\u544a\u522b async"),(0,l.kt)("p",null,"webpack5 \u652f\u6301\u9876\u7ea7\u4f5c\u7528\u57df\u7684await\u5173\u952e\u5b57, \u5373\u5141\u8bb8\u5f00\u53d1\u8005\u5728async\u51fd\u6570\u5916\u90e8\u4f7f\u7528await\u5b57\u6bb5. "),(0,l.kt)("p",null,"\u539f\u578b\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"import"),"\u4ed6\u4eec\u7684\u6a21\u5757\u4f1a\u7b49\u5f85\u5b83\u4eec\u5f00\u59cb\u6267\u884c\u5b83\u7684\u4ee3\u7801. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// webpack.config.js\nmodule.exports = {\n    ...,\n    experiments: {\n        topLevelAwait: true,\n    },\n}\n")),(0,l.kt)("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u4e48\u5199\u4e86:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u5f00\u542f top level await \u4e4b\u524d\nimport i18n from 'XXX/i18n-utils'\n\n(async () => {\n  // \u56fd\u9645\u5316\u6587\u6848\u5f02\u6b65\u521d\u59cb\u5316\u903b\u8f91\n  await i18n.init({/* ... */})\n  root.render(<AppContainer />)\n})()\n\n// \u5f00\u542f top level await \u4e4b\u540e\nimport i18n from 'XXX/i18n-utils'\n\nawait i18n.init({/* ... */})\nroot.render(<AppContainer />)\n")),(0,l.kt)("p",null,"\u6211\u4eec\u4e5f\u997f\u53ef\u4ee5\u7528\u8fd9\u4e2a\u903b\u8f91\u7528\u6765\u5f02\u6b65\u5bfc\u51fa\u6216\u8005\u5f15\u5165\u6a21\u5757:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// src/Home/index.jsx\nimport React from 'react';\n\nconst Test = () => {\n  return <div>123</div>;\n};\n\nlet Home = null;\nawait new Promise(resolve => {\n  Home = Test;\n  resolve();\n});\n\nexport default Home;\n\n// src/index.jsx\nimport Home from './Home'\n")),(0,l.kt)("p",null,"\u4e3a\u4e86eslint\u8bed\u6cd5\u68c0\u6d4b\u7684\u652f\u6301, \u8fd8\u9700\u8981\u6dfb\u52a0babel\u63d2\u4ef6",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/plugin-syntax-top-level-await")),(0,l.kt)("p",null,"\u4e0d\u540c\u4e8e\u5176\u4ed6es6\u7684\u8bed\u6cd5, \u8fd9\u4e2a\u63d2\u4ef6\u7684\u4f5c\u7528\u662f\u8ba9babel\u80fd\u89e3\u6790\u8fd9\u4e2a\u8bed\u6cd5, \u7136\u540e\u6254\u7ed9\u540e\u7eed\u7684webpack\u53bb\u5904\u7406."),(0,l.kt)("h2",{id:"\u6a21\u5757\u8054\u90a6"},"\u6a21\u5757\u8054\u90a6"),(0,l.kt)("h3",{id:"npm-\u6a21\u5757\u5171\u4eab\u673a\u5236"},"NPM \u6a21\u5757\u5171\u4eab\u673a\u5236"),(0,l.kt)("p",null,"\u6b63\u5e38\u7684\u6a21\u5757\u5171\u4eab\u673a\u5236, \u5c31\u662f\u628a\u4f9d\u8d56\u5b89\u88c5\u5230\u9879\u76ee, \u7136\u540e\u8fdb\u884cwebpack\u6253\u5305\u6784\u5efa\u4e0a\u7ebf."),(0,l.kt)("p",null,"\u5bf9\u4e8e\u4e24\u4e2a\u4e0d\u540c\u7684\u9879\u76ee, \u9700\u8981\u5171\u4eab\u4e00\u4e2a\u6a21\u5757\u7684\u65f6\u5019, \u6700\u5e38\u89c1\u7684\u529e\u6cd5\u5c31\u662f\u5c06\u5176\u62bd\u6210\u901a\u7528\u4f9d\u8d56\u5e76\u5206\u522b\u5b89\u88c5\u5728\u5404\u81ea\u7684\u9879\u76ee\u4e2d. "),(0,l.kt)("p",null,"Monorepo\u53ef\u4ee5\u4e00\u5b9a\u7a0b\u5ea6\u7684\u89e3\u51b3\u91cd\u590d\u5b89\u88c5\u548c\u4fee\u6539\u56f0\u96be\u7684\u95ee\u9898, \u4f46\u4f9d\u7136\u9700\u8981\u8d70\u672c\u5730\u7f16\u8bd1."),(0,l.kt)("h3",{id:"umd-\u6a21\u5757\u5171\u4eab\u673a\u5236"},"UMD \u6a21\u5757\u5171\u4eab\u673a\u5236"),(0,l.kt)("p",null,"\u771f\u6b63Runtime\u7684\u65b9\u5f0f\u53ef\u80fd\u662fUMD\u65b9\u5f0f\u5171\u4eab\u4ee3\u7801\u6a21\u5757, \u5373\u5c06\u6a21\u5757\u7528webpack umd\u6a21\u5f0f\u6253\u5305, \u7136\u540e\u8f93\u51fa\u7684\u5176\u4ed6\u9879\u76ee\u4e2d."),(0,l.kt)("p",null,"\u5bf9\u4e8e\u4e0d\u540c\u7684\u9879\u76ee, \u76f4\u63a5\u5229\u7528UMD\u5305\u590d\u7528\u4e00\u4e2a\u6a21\u5757, \u4f46\u8fd9\u79cd\u6280\u672f\u65b9\u6848\u7684\u95ee\u9898\u5728\u4e8e\u5305\u4f53\u79ef\u65e0\u6cd5\u8fbe\u5230\u672c\u5730\u7f16\u8bd1\u65f6\u7684\u4f18\u5316\u6548\u679c, \u5e76\u4e14\u5e93\u4e4b\u95f4\u5bb9\u6613\u51b2\u7a81."),(0,l.kt)("h3",{id:"\u5fae\u524d\u7aef\u65b9\u5f0f\u5171\u4eab\u6a21\u5757"},"\u5fae\u524d\u7aef\u65b9\u5f0f\u5171\u4eab\u6a21\u5757"),(0,l.kt)("p",null,"\u5fae\u524d\u7aef: micro-frontedns(MFE)\u4e5f\u662f\u4e00\u79cd\u6bd4\u8f83\u706b\u70ed\u7684\u6a21\u5757\u5171\u4eab\u7ba1\u7406\u65b9\u5f0f, \u5fae\u524d\u7aef\u5c31\u662f\u8981\u89e3\u51b3\u591a\u9879\u76ee\u5e76\u5b58\u7684\u95ee\u9898, \u591a\u9879\u76ee\u5e76\u5b58\u7684\u6700\u5927\u95ee\u9898\u5c31\u662f\u6a21\u5757\u5171\u4eab, \u4e0d\u80fd\u6709\u51b2\u7a81. "),(0,l.kt)("p",null,"\u5fae\u524d\u7aef\u8fd8\u8981\u8003\u8651\u6837\u5f0f\u51b2\u7a81, \u751f\u547d\u5468\u671f\u7ba1\u7406, \u6240\u4ee5\u672c\u6587\u5c31\u53ea\u805a\u7126\u5728\u8d44\u6e90\u52a0\u8f7d\u65b9\u5f0f\u4e0a. \u5fae\u524d\u7aef\u4e00\u822c\u6709\u4e24\u79cd\u6253\u5305\u65b9\u5f0f:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5b50\u5e94\u7528\u72ec\u7acb\u6253\u5305, \u6a21\u5757\u89e3\u8026, \u4f46\u662f\u65e0\u6cd5\u62bd\u53d6\u516c\u5171\u4f9d\u8d56"),(0,l.kt)("li",{parentName:"ol"},"\u6574\u4f53\u5e94\u7528\u4e00\u8d77\u6253\u5305, \u80fd\u5f88\u597d\u7684\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898, \u4f46\u662f\u6253\u5305\u901f\u5ea6\u975e\u5e38\u6162.")),(0,l.kt)("h3",{id:"\u6a21\u5757\u8054\u90a6\u65b9\u5f0f"},"\u6a21\u5757\u8054\u90a6\u65b9\u5f0f"),(0,l.kt)("p",null,"\u6a21\u5757\u8054\u90a6(Module Federation)\u662fwebpack5\u7684\u5185\u7f6e\u6838\u5fc3\u7279\u70b9\u4e4b\u4e00."),(0,l.kt)("p",null,"\u8fd9\u4e2a\u65b9\u6848\u662f\u76f4\u63a5\u5c06\u4e00\u4e2a\u5e94\u7528\u7684\u5305\u5e94\u7528\u4e8e\u53e6\u4e00\u4e2a\u5e94\u7528, \u540c\u65f6\u5177\u5907\u6574\u4f53\u5e94\u7528\u4e00\u8d77\u6253\u5305\u7684\u516c\u5171\u4f9d\u8d56\u62bd\u53d6\u80fd\u529b."),(0,l.kt)("p",null,'\u8ba9\u5e94\u7528\u5177\u5907\u6a21\u5757\u5316\u8f93\u51fa\u80fd\u529b, \u5176\u5b9e\u662f\u65b0\u589e\u4e86\u4e00\u79cd\u65b0\u7684\u5e94\u7528\u5f62\u6001, \u5373"\u4e2d\u5fc3\u5e94\u7528"\u7684\u6982\u5ff5. \u8fd9\u4e2a\u4e2d\u5fc3\u5e94\u7528\u7528\u4e8e\u5728\u7ebf\u52a8\u6001\u7684\u5206\u53d1Runtime\u5b50\u6a21\u5757, \u5e76\u4e0d\u76f4\u63a5\u63d0\u4f9b\u7ed9\u7528\u6237\u4f7f\u7528. '),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image",src:a(38087).Z,width:"655",height:"636"})),(0,l.kt)("p",null,"\u6a21\u5757\u8054\u90a6\u7684\u4f7f\u7528\u5982\u4e0b:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5f15\u5165\u8fdc\u7a0bJS\u6587\u4ef6"),(0,l.kt)("li",{parentName:"ol"},"\u914d\u7f6ewebpack\u63d2\u4ef6"),(0,l.kt)("li",{parentName:"ol"},"\u6a21\u5757\u4f7f\u7528")),(0,l.kt)("p",null,"\u9996\u5148, \u5f15\u5165\u8fdc\u7a0b\u5e93\u7684\u5165\u53e3\u6587\u4ef6, \u6bd4\u5982\u6211\u4eec\u73b0\u5728\u6709app1, app2\u4e24\u4e2a\u5e94\u7528, \u7aef\u53e3\u5206\u522b\u4e3a3001, 3002. app1\u60f3\u8981\u5f15\u7528app2\u4e2d\u7684JS, \u76f4\u63a5\u7528script\u6807\u7b7e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'<head>\n  <script src="http://localhost:3002/remoteEntry.js"><\/script>\n</head>\n')),(0,l.kt)("p",null,"\u7b2c\u4e8c\u6b65, \u5728app1\u4e2d\u8fdb\u884cwebpack\u914d\u7f6e\u5bf9\u5e94\u7684\u63d2\u4ef6\u9009\u9879:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const ModuleFederationPlugin = require("webpack/lib/container/ModuleFederationPlugin");\n   \nmodule.exports = {\n //....\n plugins: [\n  new ModuleFederationPlugin({\n   name: "app1",\n   library: { type: "var", name: "app1" },\n   remotes: {\n    app2: "app2",\n   },\n   shared: ["react", "react-dom"],\n  }),\n ],\n};\n')),(0,l.kt)("p",null,"\u5176\u4e2d, app2\u7684webpack\u914d\u7f6e\u5927\u81f4\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'plugins: [\n  new ModuleFederationPlugin({\n   name: "app2",\n   library: { type: "var", name: "app2" },\n   filename: "remoteEntry.js",\n   exposes: {\n    "./Button": "./src/Button",\n   },\n   shared: ["react", "react-dom"],\n  })\n],\n')),(0,l.kt)("p",null,"\u53c2\u6570\u89e3\u91ca\u5982\u4e0b: "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"name"),": \u5f53\u524d\u5e94\u7528\u540d\u79f0, \u5168\u5c40\u552f\u4e00"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"library"),": UMD\u6807\u51c6\u5bfc\u51fa\uff0c\u548cname\u4fdd\u6301\u4e00\u81f4\u5373\u53ef\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"remotes"),": \u5176\u4ed6\u9879\u76ee\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"name"),"\u6620\u5c04\u5230\u5f53\u524d\u9879\u76ee\u4e2d"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"filename"),":\u8fdc\u7a0b\u5e94\u7528\u65f6\u88ab\u5176\u4ed6\u5e94\u7528\u5f15\u5165\u7684js\u6587\u4ef6\u540d\u79f0\u3002\u5bf9\u5e94\u4e0a\u9762\u7684 remoteEntry.js"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"exposes"),": \u8868\u793a\u5bfc\u51fa\u7684\u6a21\u5757, \u53ea\u6709\u5728\u8fd9\u91cc\u58f0\u660e\u7684\u6a21\u5757\u624d\u53ef\u4ee5\u4f5c\u4e3a\u8fdc\u7a0b\u7684\u4f9d\u8d56\u88ab\u4f7f\u7528"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"shared"),": \u5171\u4eab\u7684\u4f9d\u8d56\u5305",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u914d\u7f6e\u4e86\u8fd9\u4e2a\u5c5e\u6027, webpack\u5728\u52a0\u8f7d\u7684\u65f6\u5019\u56de\u5148\u5224\u65ad\u672c\u5730\u5e94\u7528\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684\u5305, \u5982\u679c\u4e0d\u5b58\u5728, \u5219\u52a0\u8f7d\u8fdc\u7a0b\u5e94\u7528\u7684\u4f9d\u8d56\u5305"),(0,l.kt)("li",{parentName:"ul"},"\u4ee5app2\u6765\u8bf4, \u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u8fdc\u7a0b\u5305, \u800c\u4e14\u88abapp1\u6d88\u8d39, webpack\u4f1a\u5148\u67e5\u627eapp1\u662f\u5426\u5b58\u5728\u8fd9\u4e24\u4e2a\u5305, \u5982\u679c\u4e0d\u5b58\u5728\u5c31\u4f7f\u7528app2\u81ea\u5e26\u7684\u5305, app1\u91cc\u9762\u540c\u6837\u58f0\u660e\u4e86\u8fd9\u4e24\u4e2a\u53c2\u6570, \u56e0\u4e3aapp1\u662f\u672c\u5730\u5e94\u7528, \u6240\u4ee5\u4f1a\u76f4\u63a5\u7528app1\u7684\u4f9d\u8d56")))),(0,l.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/348612482"},"Webpack5 \u65b0\u7279\u6027\u4e1a\u52a1\u843d\u5730\u5b9e\u6218")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://www.jb51.net/article/190299.htm"},"webpack5 \u8054\u90a6\u6a21\u5757\u4ecb\u7ecd\u8be6\u89e3"))))}c.isMDXComponent=!0},38087:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/20210305142051-3ba3476b5048e80f2a9374771b8ae1d9.jpg"}}]);