"use strict";(self.webpackChunkwiki_site=self.webpackChunkwiki_site||[]).push([[8213],{50158:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var a=t(46393);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},p=Object.keys(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var o=a.createContext({}),d=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=d(e.components);return a.createElement(o.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,p=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=d(t),u=l,s=m["".concat(o,".").concat(u)]||m[u]||k[u]||p;return t?a.createElement(s,r(r({ref:n},c),{},{components:t})):a.createElement(s,r({ref:n},c))}));function u(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var p=t.length,r=new Array(p);r[0]=m;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i.mdxType="string"==typeof e?e:l,r[1]=i;for(var d=2;d<p;d++)r[d]=t[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},62750:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>k,frontMatter:()=>p,metadata:()=>i,toc:()=>d});var a=t(39421),l=(t(46393),t(50158));const p={},r="Vue-Compiler",i={unversionedId:"\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE/Vue-Compiler",id:"\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE/Vue-Compiler",title:"Vue-Compiler",description:"\u7f16\u8bd1\u4f18\u5316\u4e3b\u8981\u6709:",source:"@site/docs/02-\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE/Vue-Compiler.md",sourceDirName:"02-\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE",slug:"/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE/Vue-Compiler",permalink:"/docs/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE/Vue-Compiler",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Svelte\u5feb\u901f\u5165\u95e8",permalink:"/docs/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/Svelte\u5feb\u901f\u5165\u95e8"},next:{title:"Vue-Router\u6e90\u7801\u89e3\u6790",permalink:"/docs/\u524d\u7aef\u8fdb\u9636/\u524d\u7aef\u6846\u67b6/VUE/Vue-Router\u6e90\u7801\u89e3\u6790"}},o={},d=[{value:"Block Tree \u548c PatchFlags",id:"block-tree-\u548c-patchflags",level:2},{value:"Block",id:"block",level:3},{value:"\u8282\u70b9\u4e0d\u7a33\u5b9a: Block-Tree",id:"\u8282\u70b9\u4e0d\u7a33\u5b9a-block-tree",level:3},{value:"v-if block",id:"v-if-block",level:3},{value:"v-for block",id:"v-for-block",level:3},{value:"\u4e0d\u7a33\u5b9a\u7684Fragment",id:"\u4e0d\u7a33\u5b9a\u7684fragment",level:3},{value:"\u7a33\u5b9a\u7684 Fragment",id:"\u7a33\u5b9a\u7684-fragment",level:3},{value:"\u9759\u6001\u63d0\u5347",id:"\u9759\u6001\u63d0\u5347",level:2},{value:"\u5143\u7d20\u4e0d\u4f1a\u88ab\u63d0\u5347\u7684\u60c5\u51b5",id:"\u5143\u7d20\u4e0d\u4f1a\u88ab\u63d0\u5347\u7684\u60c5\u51b5",level:3},{value:"\u9759\u6001\u63d0\u5347Props",id:"\u9759\u6001\u63d0\u5347props",level:2},{value:"\u9884\u5b57\u7b26\u4e32\u5316",id:"\u9884\u5b57\u7b26\u4e32\u5316",level:2},{value:"Cache Event handler \u4e8b\u4ef6\u76d1\u542c\u7f13\u5b58",id:"cache-event-handler-\u4e8b\u4ef6\u76d1\u542c\u7f13\u5b58",level:2},{value:"v-once",id:"v-once",level:2},{value:"SSR\u4f18\u5316",id:"ssr\u4f18\u5316",level:2}],c={toc:d};function k(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"vue-compiler"},"Vue-Compiler"),(0,l.kt)("p",null,"\u7f16\u8bd1\u4f18\u5316\u4e3b\u8981\u6709:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"diff\u7b97\u6cd5\u4f18\u5316"),(0,l.kt)("li",{parentName:"ul"},"\u9759\u6001\u63d0\u5347"),(0,l.kt)("li",{parentName:"ul"},"\u4e8b\u4ef6\u76d1\u542c\u7f13\u5b58"),(0,l.kt)("li",{parentName:"ul"},"SSR\u4f18\u5316")),(0,l.kt)("h2",{id:"block-tree-\u548c-patchflags"},"Block Tree \u548c PatchFlags"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Block Tree"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"PatchFlags"),"\u662fvue3\u5229\u7528\u7f16\u8bd1\u4fe1\u606f\u5728Diff\u9636\u6bb5\u8fdb\u884c\u7684\u4f18\u5316. "),(0,l.kt)("p",null,"\u5728tempalte\u4e2d, \u4f1a\u628a\u6a21\u677f\u5185\u5bb9\u5206\u4e3a\u9759\u6001\u8282\u70b9\u548c\u52a8\u6001\u8282\u70b9. \u6bd4\u5982\u8fd9\u6bb5\u6a21\u677f\u4e2d:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'<div>\n    <p class="foo">bar</p>\n</div>\n')),(0,l.kt)("p",null,"\u8fd9\u8fd9\u5c31\u662f\u4e00\u4e2a\u9759\u6001vDom, \u5b83\u5728\u7ec4\u4ef6\u7684\u66f4\u65b0\u9636\u6bb5\u662f\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u7684. \u5982\u679c\u80fd\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"diff"),"\u9636\u6bb5\u8df3\u8fc7\u8fd9\u90e8\u5206\u7684\u6bd4\u8f83, \u5c31\u80fd\u907f\u514d\u65e0\u6548\u7684vdom\u6811\u7684\u904d\u5386\u548c\u6bd4\u5bf9. \u8fd9\u5c31\u662f\u65e9\u8d77\u7684\u4f18\u5316\u601d\u8def: \u8df3\u8fc7\u9759\u6001\u5185\u5bb9, \u53ea\u6bd4\u8f83\u52a8\u6001\u5185\u5bb9."),(0,l.kt)("p",null,"\u9759\u6001\u7c7b\u578b\u7684\u679a\u4e3e\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export const enum PatchFlags {\n  TEXT = 1,// \u52a8\u6001\u7684\u6587\u672c\u8282\u70b9\n  CLASS = 1 << 1,  // 2 \u52a8\u6001\u7684 class\n  STYLE = 1 << 2,  // 4 \u52a8\u6001\u7684 style\n  PROPS = 1 << 3,  // 8 \u52a8\u6001\u5c5e\u6027\uff0c\u4e0d\u5305\u62ec\u7c7b\u540d\u548c\u6837\u5f0f\n  FULL_PROPS = 1 << 4,  // 16 \u52a8\u6001 key\uff0c\u5f53 key \u53d8\u5316\u65f6\u9700\u8981\u5b8c\u6574\u7684 diff \u7b97\u6cd5\u505a\u6bd4\u8f83\n  HYDRATE_EVENTS = 1 << 5,  // 32 \u8868\u793a\u5e26\u6709\u4e8b\u4ef6\u76d1\u542c\u5668\u7684\u8282\u70b9\n  STABLE_FRAGMENT = 1 << 6,   // 64 \u4e00\u4e2a\u4e0d\u4f1a\u6539\u53d8\u5b50\u8282\u70b9\u987a\u5e8f\u7684 Fragment\n  KEYED_FRAGMENT = 1 << 7, // 128 \u5e26\u6709 key \u5c5e\u6027\u7684 Fragment\n  UNKEYED_FRAGMENT = 1 << 8, // 256 \u5b50\u8282\u70b9\u6ca1\u6709 key \u7684 Fragment\n  NEED_PATCH = 1 << 9,   // 512\n  DYNAMIC_SLOTS = 1 << 10,  // \u52a8\u6001 solt\n  HOISTED = -1,  // \u7279\u6b8a\u6807\u5fd7\u662f\u8d1f\u6574\u6570\u8868\u793a\u6c38\u8fdc\u4e0d\u4f1a\u7528\u4f5c diff\n  BAIL = -2 // \u4e00\u4e2a\u7279\u6b8a\u7684\u6807\u5fd7\uff0c\u6307\u4ee3\u5dee\u5f02\u7b97\u6cd5\n}\n")),(0,l.kt)("h3",{id:"block"},"Block"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"<div>\n    <p>foo</p>\n    <p>{{ bar }}</p>\n</div>\n")),(0,l.kt)("p",null,"\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d, \u53ea\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"<p>{{ bar }}</p>"),"\u662f\u52a8\u6001\u7684, \u56e0\u6b64\u53ea\u9700\u8981\u9776\u5411\u66f4\u65b0\u8be5\u6587\u672c\u8282\u70b9\u5c31\u53ef\u4ee5\u4e86, \u8fd9\u5728\u5305\u542b\u5927\u91cf\u9759\u6001\u8282\u70b9\u5185\u5bb9\u800c\u53ea\u6709\u5c11\u91cf\u52a8\u6001\u5185\u5bb9\u7684\u573a\u666f\u4e0b\u80fd\u63d0\u6210\u5f88\u5927\u7684\u6027\u80fd. "),(0,l.kt)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\u5bf9\u5e94\u7684vDom\u5927\u6982\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const vnode = {\n    tag: 'div',\n    children: [\n        { tag: 'p', children: 'foo' },\n        { tag: 'p', children: ctx.bar },  // \u8fd9\u662f\u52a8\u6001\u8282\u70b9\n    ]\n}\n")),(0,l.kt)("p",null,"vue3\u7684compiler\u53ef\u4ee5\u5206\u6790\u6a21\u677f\u5e76\u4e14\u63d0\u53d6\u6709\u6548\u4fe1\u606f: \u90a3\u4e9b\u8282\u70b9\u662f\u52a8\u6001\u8282\u70b9, \u4ee5\u53ca\u5b83\u4e3a\u4ec0\u4e48\u662f\u52a8\u6001\u7684, \u6709\u4e86\u8fd9\u4e9b\u4fe1\u606f, \u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u521b\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u7684\u8fc7\u7a0b\u4e2d\u4e3a\u52a8\u6001\u7684\u8282\u70b9\u6253\u6807\u8bb0, \u4e5f\u5c31\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"patchFlags"),"."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"patchFlags"),"\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\u4e00\u4e2a\u6570\u5b57\u6807\u8bb0, \u628a\u8fd9\u4e9b\u6570\u5b57\u8d4b\u4e88\u4e0d\u540c\u542b\u4e49:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"1: \u4ee3\u8868\u8282\u70b9\u6709\u52a8\u6001\u7684textContent"),(0,l.kt)("li",{parentName:"ul"},"2: \u4ee3\u8868\u5143\u7d20\u6709\u52a8\u6001\u7684class"),(0,l.kt)("li",{parentName:"ul"},"3: ...")),(0,l.kt)("p",null,"\u7136\u540e\u628a\u8fd9\u4e9b\u6807\u8bb0\u6302\u5230\u5bf9\u5e94\u7684vdom\u5c5e\u6027\u4e0a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const vnode = {\n    tag: 'div',\n    children: [\n        { tag: 'p', children: 'foo' },\n        { tag: 'p', children: ctx.bar, patchFlag: 1 /* \u52a8\u6001\u7684 textContent */ },\n    ]\n}\n")),(0,l.kt)("p",null,"\u6709\u4e86\u8fd9\u4e2a\u4fe1\u606f, \u6211\u4eec\u5c31\u53ef\u4ee5\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u7684\u521b\u5efa\u9636\u6bb5\u628a\u52a8\u6001\u8282\u70b9\u63d0\u53d6\u51fa\u6765, \u901a\u8fc7\u5224\u65ad\u8282\u70b9\u5c5e\u6027\u4e0a\u5e26\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"patchFlag"),", \u5c31\u628a\u8fd9\u4e2a\u8282\u70b9\u63d0\u53d6\u51fa\u6765\u653e\u5728\u4e00\u4e2a\u6570\u7ec4\u4e2d:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const vnode = {\n    tag: 'div',\n    children: [\n        { tag: 'p', children: 'foo' },\n        { tag: 'p', children: ctx.bar, patchFlag: 1 /* \u52a8\u6001\u7684 textContent */ },\n    ],\n    dynamicChildren: [\n        { tag: 'p', children: ctx.bar, patchFlag: 1 /* \u52a8\u6001\u7684 textContent */ },\n    ]\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"dynamicChildren"),"\u5c31\u662f\u7528\u6765\u5b58\u50a8\u4e00\u4e2a\u8282\u70b9\u4e0b\u6240\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"\u5b50\u4ee3"),"\u52a8\u6001\u8282\u70b9\u7684\u6570\u7ec4. "),(0,l.kt)("p",null,"\u6bd4\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const vnode = {\n    tag: 'div',\n    children: [\n        { tag: 'section', children: [\n            { tag: 'p', children: ctx.bar, patchFlag: 1 /* \u52a8\u6001\u7684 textContent */ },\n        ]},\n    ],\n    dynamicChildren: [\n        { tag: 'p', children: ctx.bar, patchFlag: 1 /* \u52a8\u6001\u7684 textContent */ },\n    ]\n}\n")),(0,l.kt)("p",null,"\u5b83\u6536\u96c6\u7684\u662f\u6240\u6709\u5b50\u5b59\u8282\u70b9\u4e2d\u7684\u52a8\u6001\u8282\u70b9\u4fe1\u606f. \u8fd9\u4e9b\u8282\u70b9\u4fe1\u606f\u4f1a\u4fdd\u5b58\u5728'\u9876\u5c42'\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u4e2d."),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a, \u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u5c31\u662f\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),", \u53ea\u4e0d\u8fc7\u5b83\u6709\u4e00\u4e9b\u7279\u6b8a\u5c5e\u6027. "),(0,l.kt)("p",null,"\u73b0\u5728, \u6211\u4eec\u5df2\u7ecf\u62ff\u5230\u4e86\u6240\u6709\u7684\u52a8\u6001\u8282\u70b9\u6570\u7ec4, \u56e0\u6b64\u5728diff\u7684\u65f6\u5019\u5c31\u53ea\u9700\u8981\u904d\u5386\u8fd9\u4e2a\u6570\u7ec4\u8fdb\u884c\u66f4\u65b0\u5373\u53ef. "),(0,l.kt)("p",null,"\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u9776\u5411\u66f4\u65b0."),(0,l.kt)("h3",{id:"\u8282\u70b9\u4e0d\u7a33\u5b9a-block-tree"},"\u8282\u70b9\u4e0d\u7a33\u5b9a: Block-Tree"),(0,l.kt)("p",null,"\u4e00\u4e2aBlock\u662f\u65e0\u6cd5\u6784\u6210Tree\u7684, \u8fd9\u5c31\u610f\u5473\u7740\u5728\u4e00\u9897vdom\u6811\u79cd, \u4f1a\u6709\u591a\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u8282\u70b9\u5145\u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u7684\u89d2\u8272, \u8fdb\u800c\u6784\u6210\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Block Tree"),". \u90a3\u4e48\u4ec0\u4e48\u60c5\u51b5\u4e0b, \u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u8282\u70b9\u4f1a\u5145\u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"block"),"\u7684\u89d2\u8272\u5462?"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n  <section v-if="foo">\n    <p>{{ a }}</p>\n  </section>\n  <div v-else>\n    <p>{{ a }}</p>\n  </div>\n</div>\n')),(0,l.kt)("p",null,"\u5047\u8bbe\u53ea\u8981\u6700\u5916\u5c42\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"div"),"\u6807\u7b7e\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),", \u90a3\u4e48",(0,l.kt)("inlineCode",{parentName:"p"},"foo"),"\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"true"),"\u7684\u65f6\u5019, \u6536\u96c6\u5230\u7684\u8282\u70b9\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"cosnt block = {\n    tag: 'div',\n    dynamicChildren: [\n        { tag: 'p', children: ctx.a, patchFlag: 1 }\n    ]\n}\n")),(0,l.kt)("p",null,"\u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"foo"),"\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"false"),"\u7684\u65f6\u5019, ",(0,l.kt)("inlineCode",{parentName:"p"},"block"),"\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"cosnt block = {\n    tag: 'div',\n    dynamicChildren: [\n        { tag: 'p', children: ctx.a, patchFlag: 1 }\n    ]\n}\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u53d1\u73b0, \u65e0\u8bba",(0,l.kt)("inlineCode",{parentName:"p"},"foo"),"\u4e3a\u771f\u8fd8\u662f\u5047, ",(0,l.kt)("inlineCode",{parentName:"p"},"block"),"\u7684\u5185\u5bb9\u662f\u4e0d\u53d8\u7684, \u8fd9\u610f\u5473\u7740\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"diff"),"\u9636\u6bb5\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55\u7684\u66f4\u65b0. "),(0,l.kt)("p",null,"\u8fd9\u4e2a\u95ee\u9898\u7684\u672c\u8d28\u5728\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"dynamaicChildren"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"diff"),"\u662f\u5ffd\u7565\u5c42\u7ea7\u7684. "),(0,l.kt)("h3",{id:"v-if-block"},"v-if block"),(0,l.kt)("p",null,"\u90a3\u4e48, \u5982\u679c\u8ba9\u4f7f\u7528\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"v-if/v-else-if/v-else"),"\u7b49\u6307\u4ee4\u7684\u5143\u7d20\u4e5f\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u5462?"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n  <section v-if="foo">\n    <p>{{ a }}</p>\n  </section>\n  <section v-else> \x3c!-- \u5373\u4f7f\u8fd9\u91cc\u662f section --\x3e\n       <div> \x3c!-- \u8fd9\u4e2a div \u6807\u7b7e\u5728 diff \u8fc7\u7a0b\u4e2d\u88ab\u5ffd\u7565 --\x3e\n            <p>{{ a }}</p>\n        </div>\n  </section >\n</div>\n')),(0,l.kt)("p",null,"\u4ee5\u8fd9\u6bb5\u6a21\u677f\u4e3a\u4f8b, \u5c06\u4e24\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"section"),"\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"block"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Block(Div)\n    - Block(Section v-if)\n    - Block(Section v-else)\n")),(0,l.kt)("p",null,"\u7236\u7ea7\u7684Block, \u4f1a\u6536\u96c6\u5b50\u4ee3\u52a8\u6001\u8282\u70b9\u4e4b\u5916, \u4e5f\u4f1a\u6536\u96c6\u5b50Block. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"cosnt block = {\n    tag: 'div',\n    dynamicChildren: [\n        { tag: 'section', { key: 0 }, dynamicChildren: [...]}, /* Block(Section v-if) */\n        { tag: 'section', { key: 1 }, dynamicChildren: [...]}  /* Block(Section v-else) */\n    ]\n}\n")),(0,l.kt)("p",null,"\u8fd9\u6837\u5f53v-if\u5224\u65ad\u53d8\u5316\u7684\u65f6\u5019, \u6e32\u67d3\u5668\u5c31\u4f1a\u77e5\u9053\u8fd9\u662f\u4e24\u4e2a\u4e0d\u540c\u7684block, \u8fdb\u884c\u66ff\u6362\u64cd\u4f5c, \u8fd9\u6837\u5c31\u89e3\u51b3\u4e86DOM\u7ed3\u6784\u4e0d\u7a33\u5b9a\u5f15\u8d77\u7684\u95ee\u9898. \u8fd9\u5c31\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"Block Tree"),"."),(0,l.kt)("h3",{id:"v-for-block"},"v-for block"),(0,l.kt)("p",null,"\u540c\u7406, ",(0,l.kt)("inlineCode",{parentName:"p"},"v-for"),"\u4e5f\u4f1a\u5f15\u8d77DOM\u7ed3\u6784\u7684\u4e0d\u7a33\u5b9a, \u4f46\u662f\u5b83\u7684\u60c5\u51b5\u5c31\u7a0d\u5fae\u590d\u6742\u4e00\u4e9b. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'<div>\n    <p v-for="item in list">{{ item }}</p>\n    <i>{{ foo }}</i>\n    <i>{{ bar }}</i>\n</div>\n')),(0,l.kt)("p",null,"\u5047\u5982",(0,l.kt)("inlineCode",{parentName:"p"},"list"),"\u7531",(0,l.kt)("inlineCode",{parentName:"p"},"[1, 2]"),"\u53d8\u4e3a\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"[1]"),", \u6309\u7167\u4e4b\u524d\u7684\u601d\u8def, \u6700\u5916\u5c42\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"div"),"\u4f5c\u4e3a\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"block"),", \u90a3\u4e48\u5b83\u66f4\u65b0\u524d\u540e\u5bf9\u5e94\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Block Tree"),"\u5e94\u8be5\u662f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u524d\nconst prevBlock = {\n    tag: 'div',\n    dynamicChildren: [\n        { tag: 'p', children: 1, 1 /* TEXT */ },\n        { tag: 'p', children: 2, 1 /* TEXT */ },\n        { tag: 'i', children: ctx.foo, 1 /* TEXT */ },\n        { tag: 'i', children: ctx.bar, 1 /* TEXT */ },\n    ]\n}\n\n// \u540e\nconst nextBlock = {\n    tag: 'div',\n    dynamicChildren: [\n        { tag: 'p', children: item, 1 /* TEXT */ },\n        { tag: 'i', children: ctx.foo, 1 /* TEXT */ },\n        { tag: 'i', children: ctx.bar, 1 /* TEXT */ },\n    ]\n}\n")),(0,l.kt)("p",null,"\u5176\u4e2d, ",(0,l.kt)("inlineCode",{parentName:"p"},"prevBlock"),"\u6709\u56db\u4e2a\u52a8\u6001\u8282\u70b9, ",(0,l.kt)("inlineCode",{parentName:"p"},"nextBlock"),"\u4e2d\u6709\u4e09\u4e2a\u52a8\u6001\u8282\u70b9, \u8fd9\u65f6\u5019\u5982\u4f55\u8fdb\u884cDiff. \u8fd9\u91cc\u662f\u65e0\u6cd5\u4f7f\u7528\u4f20\u7edf\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Diff"),"\u64cd\u4f5c\u7684, \u56e0\u4e3a\u4f20\u7edf\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Diff"),"\u7684\u524d\u7f6e\u6761\u4ef6\u662f\u540c\u5c42\u8282\u70b9\u4e4b\u95f4\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Diff"),", \u7136",(0,l.kt)("inlineCode",{parentName:"p"},"dynamicChildren"),"\u5185\u7684\u8282\u70b9\u672a\u5fc5\u662f\u540c\u5c42\u7ea7\u7684. "),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a, \u6211\u4eec\u53ea\u9700\u8981\u8ba9",(0,l.kt)("inlineCode",{parentName:"p"},"v-for"),"\u4f5c\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684block\u5c31\u53ef\u4ee5\u4e86:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const block = {\n    tag: 'div',\n    dynamicChildren: [\n        // \u8fd9\u662f\u4e00\u4e2a Block \u54e6\uff0c\u5b83\u6709 dynamicChildren\n        { tag: Fragment, dynamicChildren: [/*.. v-for \u7684\u8282\u70b9 ..*/] }\n        { tag: 'i', children: ctx.foo, 1 /* TEXT */ },\n        { tag: 'i', children: ctx.bar, 1 /* TEXT */ },\n    ]\n}\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Fragment"),", \u5e76\u8ba9\u4ed6\u5145\u5f53\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u7684\u89d2\u8272, \u89e3\u51b3\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"v-for"),"\u5143\u7d20\u6240\u5728\u5c42\u7ea7\u7684\u7ed3\u6784\u7a33\u5b9a\u6027\u95ee\u9898."),(0,l.kt)("h3",{id:"\u4e0d\u7a33\u5b9a\u7684fragment"},"\u4e0d\u7a33\u5b9a\u7684Fragment"),(0,l.kt)("p",null,"\u6211\u4eec\u6765\u770b\u4e0b",(0,l.kt)("inlineCode",{parentName:"p"},"Fragment"),"\u8fd9\u4e2a\u5143\u7d20\u672c\u8eab:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"{ tag: Fragment, dynamicChildren: [/*.. v-for \u7684\u8282\u70b9 ..*/] }\n")),(0,l.kt)("p",null,"\u5bf9\u4e8e\u8fd9\u6837\u7684\u6a21\u677f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<p v-for="item in list">{{ item }}</p>\n')),(0,l.kt)("p",null,"\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"list"),"\u4ece",(0,l.kt)("inlineCode",{parentName:"p"},"[1,2]"),"\u53d8\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"[1]"),"\u7684\u524d\u540e, block\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u524d\nconst prevBlock = {\n    tag: Fragment,\n    dynamicChildren: [\n        { tag: 'p', children: item, 1 /* TEXT */ },\n        { tag: 'p', children: item, 2 /* TEXT */ }\n    ]\n}\n\n// \u540e\nconst prevBlock = {\n    tag: Fragment,\n    dynamicChildren: [\n        { tag: 'p', children: item, 1 /* TEXT */ }\n    ]\n}\n")),(0,l.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b, \u6211\u4eec\u53d1\u73b0\u7ed3\u6784\u4ecd\u7136\u662f\u4e0d\u7a33\u5b9a\u7684(\u7ed3\u6784\u4e0d\u7a33\u5b9a\u4ece\u7ed3\u679c\u4e0a\u770b\u6307\u7684\u662f\u66f4\u65b0\u524d\u540e\u4e00\u4e2a block \u7684 dynamicChildren \u4e2d\u6536\u96c6\u7684\u52a8\u6001\u8282\u70b9\u6570\u91cf\u6216\u987a\u5e8f\u7684\u4e0d\u4e00\u81f4). \u8fd9\u79cd\u4e0d\u7a33\u5b9a\u4f1a\u5bfc\u81f4\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u8fdb\u884c\u9776\u5411Diff, \u6240\u4ee5\u53ea\u80fd\u9000\u56de\u5230\u4f20\u7edf\u7684Diff, \u4e5f\u5c31\u662fDiff Fragment\u7684children\u800c\u4e0d\u662fdynamicChildren."),(0,l.kt)("p",null,"\u6ce8\u610f, Fragment\u7684\u5b50\u8282\u70b9\u8fd8\u53ef\u4ee5\u662fBlock."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const block = {\n    tag: Fragment,\n    children: [\n        { tag: 'p', children: item, dynamicChildren: [/*...*/], 1 /* TEXT */ },\n        { tag: 'p', children: item, dynamicChildren: [/*...*/], 1 /* TEXT */ }\n    ]\n}\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u5c31\u53c8\u8981\u56de\u590d\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"Block-tree"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Diff"),"\u6a21\u5f0f."),(0,l.kt)("h3",{id:"\u7a33\u5b9a\u7684-fragment"},"\u7a33\u5b9a\u7684 Fragment"),(0,l.kt)("p",null,"\u6240\u8c13\u7684\u7a33\u5b9a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Fragment"),", \u6307\u7684\u662f:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"v-for\u7684\u8868\u8fbe\u5f0f\u662f\u5e38\u91cf")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<p v-for="n in 10"></p>\n\x3c!-- \u6216\u8005 --\x3e\n<p v-for="s in \'abc\'"></p>\n')),(0,l.kt)("p",null,"\u7531\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"10"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"abc"),"\u662f\u5e38\u91cf, \u6240\u4ee5\u8fd9\u91cc\u662f\u7a33\u5b9a\u7684, \u4e0d\u9700\u8981\u56de\u9000\u5230\u4f20\u7edf\u7684diff. \u80fd\u5e26\u6765\u4e00\u5b9a\u7684\u6027\u80fd\u4f18\u52bf."),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u591a\u4e2a\u6839\u5143\u7d20")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<template>\n    <div></div>\n    <p></p>\n    <i></i>\n</template>\n")),(0,l.kt)("p",null,"\u8fd9\u4e5f\u662f\u4e00\u4e2a\u7a33\u5b9a\u7684Fragment. "),(0,l.kt)("p",null,"\u5373\u4fbf\u662f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n    <div v-if="condition"></div>\n    <p></p>\n    <i></i>\n</template>\n')),(0,l.kt)("p",null,"\u5b83\u4e5f\u662f\u7a33\u5b9a\u7684, \u56e0\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"v-if"),"\u672c\u8eab\u662f\u4e00\u4e2a\u7a33\u5b9a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"block"),". "),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u63d2\u69fd\u51fa\u53e3")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'<Comp>\n    <p v-if="ok"></p>\n    <i v-else></i>\n</Comp>\n')),(0,l.kt)("p",null,"\u7ec4\u4ef6\u5185\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"children"),"\u5c06\u4f5c\u4e3a\u63d2\u69fd\u7684\u5185\u5bb9, \u5728\u7ecf\u8fc7\u7f16\u8bd1\u4ee5\u540e, \u5e94\u8be5\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u89d2\u8272\u7684\u5185\u5bb9, \u81ea\u7136\u4f1a\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),", \u53ef\u4ee5\u4fdd\u8bc1\u7ed3\u6784\u7684\u7a33\u5b9a. "),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"<template v-for>"))),(0,l.kt)("p",null,"\u5982\u4e0b\u6a21\u677f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n    <template v-for="item in list">\n        <p>{{ item.name }}</P>\n        <p>{{ item.age }}</P>\n    </template>\n</template> \n')),(0,l.kt)("p",null,"\u5bf9\u4e8e\u5e26\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"v-for"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"template"),"\u5143\u7d20\u672c\u8eab\u6765\u8bf4, \u5b83\u662f\u4e00\u4e2a\u4e0d\u7a33\u5b9a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Fragment"),", \u56e0\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"list"),"\u4e0d\u662f\u5e38\u91cf, \u9664\u6b64\u4e4b\u5916, ",(0,l.kt)("inlineCode",{parentName:"p"},"template"),"\u5143\u7d20\u672c\u8eab\u4e0d\u6e32\u67d3\u4efb\u4f55\u771f\u5b9e\u7684DOM, \u56e0\u6b64\u5982\u679c\u5b83\u542b\u6709\u591a\u4e2a\u5143\u7d20, \u8fd9\u4e9b\u5143\u7d20\u8282\u70b9\u4e5f\u4f1a\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Fragment"),"\u5b58\u5728, \u8fd9\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Fragment"),"\u4e5f\u662f\u7a33\u5b9a\u7684. "),(0,l.kt)("h2",{id:"\u9759\u6001\u63d0\u5347"},"\u9759\u6001\u63d0\u5347"),(0,l.kt)("p",null,"vue3\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"compiler"),"\u662f\u652f\u6301",(0,l.kt)("inlineCode",{parentName:"p"},"hoistStatic"),"\u7684. \u5982\u4e0b\u6a21\u677f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <p>text</p>\n</div>\n")),(0,l.kt)("p",null,"\u5728\u6ca1\u6709\u88ab\u63d0\u5347\u7684\u60c5\u51b5\u4e0b, \u5176\u6e32\u67d3\u51fd\u6570\u76f8\u5f53\u4e8e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function render() {\n    return (openBlock(), createBlock('div', null, [\n        createVNode('p', null, 'text')\n    ]))\n}\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u77e5\u9053",(0,l.kt)("inlineCode",{parentName:"p"},"p"),"\u6807\u7b7e\u662f\u9759\u6001\u7684, \u5b83\u662f\u4e0d\u4f1a\u6539\u53d8\u7684. \u5f00\u542f\u9759\u6001\u63d0\u5347\u540e, \u6e32\u67d3\u51fd\u6570\u53d8\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const hoist1 = createVNode('p', null, 'text')\n\nfunction render() {\n    return (openBlock(), createBlock('div', null, [\n        hoist1\n    ]))\n}\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u51cf\u5c11\u7684\u6027\u80fd\u7684\u6d88\u8017. \u9759\u6001\u63d0\u5347\u662f\u4ee5\u6811\u4e3a\u5355\u4f4d\u7684. \u5982\u4e0b\u6a21\u677f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"<div>\n  <section>\n    <p>\n      <span>abc</span>\n    </p>\n  </section >\n</div>\n")),(0,l.kt)("p",null,"\u9664\u4e86\u6839\u8282\u70b9\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"div"),"\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"block"),"\u4e0d\u53ef\u88ab\u63d0\u5347, \u6574\u4e2a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"section"),"\u5143\u7d20\u4ee5\u53ca\u5b50\u5b59\u53ca\u8bf6\u70b9\u90fd\u4f1a\u88ab\u63d0\u5347, \u56e0\u4e3a\u4ed6\u4eec\u6574\u4e2a\u6811\u90fd\u662f\u9759\u6001\u7684. "),(0,l.kt)("h3",{id:"\u5143\u7d20\u4e0d\u4f1a\u88ab\u63d0\u5347\u7684\u60c5\u51b5"},"\u5143\u7d20\u4e0d\u4f1a\u88ab\u63d0\u5347\u7684\u60c5\u51b5"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5143\u7d20\u5e26\u6709\u52a8\u6001\u7684key")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div :key="foo"></div>\n')),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a\u4e00\u4e2a\u5143\u7d20\u62e5\u6709\u4efb\u4f55\u52a8\u6001\u7ed1\u5b9a\u90fd\u4e0d\u5e94\u8be5\u88ab\u63d0\u5347, ",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u662f\u4f5c\u4e3a\u7279\u6b8a\u7684\u4e00\u79cd\u7ed1\u5b9a, \u5176\u610f\u4e49\u662f\u4e0d\u540c\u7684. \u666e\u901a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"props"),"\u5982\u679c\u662f\u52a8\u6001\u7684, \u90a3\u4e48\u53ea\u9700\u8981\u4f53\u73b0\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"patchFlags"),"\u5373\u53ef:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n    <p :foo="bar"></p>\n</div>\n')),(0,l.kt)("p",null,"\u8f6c\u4e3arender:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render(ctx) {\n    return (openBlock(), createBlock('div', null, [\n        createVNode('p', { foo: ctx }, null, PatchFlags.PROPS, ['foo'])\n    ]))\n}\n")),(0,l.kt)("p",null,"\u5bf9\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u6765\u8bf4, \u672c\u8eab\u5177\u6709\u7279\u6b8a\u610f\u4e49, \u5b83\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u7684\u552f\u4e00\u6807\u8bc6, \u5982\u679c\u4e24\u4e2a\u5143\u7d20\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u4e0d\u540c, \u5c31\u9700\u8981\u5b8c\u5168\u7684\u66ff\u6362."),(0,l.kt)("p",null,"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u7684\u503c\u662f\u52a8\u6001\u53ef\u53d8\u7684, \u5bf9\u4e8e\u8fd9\u6837\u7684\u5143\u7d20\u5e94\u8be5\u59cb\u7ec8\u53c2\u4e0e\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"diff"),"\u4e2d, \u5e76\u4e14\u4e0d\u80fd\u7b80\u5355\u7684\u6253",(0,l.kt)("inlineCode",{parentName:"p"},"patchFlags"),", \u9700\u8981\u628a\u62e5\u6709\u52a8\u6001",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u7684\u5143\u7d20\u4e5f\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n    <div :key="foo"></div>\n</div>\n')),(0,l.kt)("p",null,"\u5176\u6e32\u67d3\u51fd\u6570\u5e94\u8be5\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render(ctx) {\n    return (openBlock(), createBlock('div', null, [\n        (openBlock(), createBlock('div', { key: ctx.foo }))\n    ]))\n}\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528ref\u7684\u5143\u7d20")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'<div ref="domRef"></div>\n')),(0,l.kt)("p",null,"\u5982\u679c\u4e00\u4e2a\u5143\u7d20\u4f7f\u7528\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"ref"),", \u65e0\u8bba\u662f\u5426\u7ed1\u5b9a\u4e86\u52a8\u6001\u503c, \u8fd9\u4e2a\u5143\u7d20\u90fd\u4e0d\u4f1a\u88ab\u9759\u6001\u63d0\u5347, \u8fd9\u662f\u56e0\u4e3a\u5728\u6bcf\u4e00\u6b21",(0,l.kt)("inlineCode",{parentName:"p"},"patch"),"\u7684\u65f6\u5019\u90fd\u9700\u8981\u8bbe\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"ref"),"\u7684\u503c."),(0,l.kt)("p",null,"\u4e3a\u4ec0\u4e48\u5462? \u770b\u4e0b\u9762\u8fd9\u4e2a\u573a\u666f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n    <div>\n        <p ref="domRef"></p>\n    </div>\n</template>\n<script>\nexport default {\n    setup() {\n        const refP1 = ref(null)\n        const refP2 = ref(null)\n        const useP1 = ref(true)\n\n        return {\n            domRef: useP1 ? refP1 : refP2\n        }\n    }\n}\n<\/script>\n')),(0,l.kt)("p",null,"\u5982\u4e0a\u4ee3\u7801\u6240\u793a, p\u6807\u7b7e\u4f7f\u7528\u4e86\u975e\u52a8\u6001\u7684ref\u5c5e\u6027, \u503c\u4e3a\u5b57\u7b26\u4e32",(0,l.kt)("inlineCode",{parentName:"p"},"domRef"),", \u7136setup\u8fd4\u56de\u4e86\u540c\u540d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"domRef"),"\u5c5e\u6027, \u4ed6\u4eec\u4e4b\u95f4\u4f1a\u5efa\u7acb\u8054\u7cfb:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5f53userp1\u4e3atrue, refp1.value\u5f15\u7528p\u5143\u7d20"),(0,l.kt)("li",{parentName:"ul"},"\u53cd\u4e4b, refp2.value\u5f15\u7528p\u5143\u7d20")),(0,l.kt)("p",null,"\u867d\u7136",(0,l.kt)("inlineCode",{parentName:"p"},"ref"),"\u662f\u9759\u6001\u7684, \u4f46\u5f88\u663e\u7136\u5728\u66f4\u65b0\u7684\u8fc7\u7a0b\u4e2d\u7531\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"useP1"),"\u7684\u53d8\u5316, \u6211\u4eec\u4e0d\u5f97\u4e0d\u66f4\u65b0",(0,l.kt)("inlineCode",{parentName:"p"},"domRef"),", \u6240\u4ee5\u53ea\u8981\u4e00\u4e2a\u5143\u7d20\u4f7f\u7528\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"ref"),", \u5b83\u5c31\u4e0d\u4f1a\u88ab\u9759\u6001\u63d0\u5347, \u5e76\u4e14\u8fd9\u4e2a\u5143\u7d20\u5bf9\u5e94\u7684VNode\u4e5f\u4f1a\u88ab\u6536\u96c6\u5230\u7236Block\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"dynamicChildren"),"\u4e2d."),(0,l.kt)("p",null,"\u4f46\u7531\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"p"),"\u6807\u7b7e\u9664\u4e86\u9700\u8981\u66f4\u65b0",(0,l.kt)("inlineCode",{parentName:"p"},"ref"),"\u5916, \u5e76\u4e0d\u9700\u8981\u66f4\u65b0\u5176\u4ed6\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"props"),", \u6240\u4ee5\u5728\u771f\u5b9e\u7684\u6e32\u67d3\u51fd\u6570\u4e2d, \u4f1a\u4e3a\u5b83\u6253\u4e0a\u4e00\u4e2a\u7279\u6b8a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"PatchFlag"),", \u53eb\u505a: ",(0,l.kt)("inlineCode",{parentName:"p"},"PatchFlags.NEED_PATCH"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render() {\n    return (openBlock(), createBlock('div', null, [\n        createVNode('p', { ref: 'domRef' }, null, PatchFlags.NEED_PATCH)\n    ]))\n}\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u4ee4\u7684\u5143\u7d20")),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a\u4e00\u4e2a\u5143\u7d20\u5982\u679c\u4f7f\u7528\u9664",(0,l.kt)("inlineCode",{parentName:"p"},"v-pre/v-cloak"),"\u4e4b\u5916\u7684\u6240\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"Vue"),"\u539f\u751f\u63d0\u4f9b\u7684\u6307\u4ee4, \u90fd\u4e0d\u4f1a\u88ab\u63d0\u5347, \u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u4ee4\u4e5f\u4e0d\u4f1a\u88ab\u63d0\u5347, \u6bd4\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<p v-custom></p>\n")),(0,l.kt)("p",null,"\u548c\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u4e00\u6837, \u4f1a\u4e3a\u8fd9\u6bb5\u6a21\u677f\u5bf9\u5e94\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u6253\u4e0a",(0,l.kt)("inlineCode",{parentName:"p"},"NEED_PATCH"),"\u6807\u5fd7. "),(0,l.kt)("p",null,"\u987a\u4fbf\u8bb2\u4e00\u4e0b\u624b\u5199\u6e32\u67d3\u51fd\u6570\u65f6\u5982\u4f55\u5e94\u7528\u81ea\u5b9a\u4e49\u6307\u4ee4, \u81ea\u5b9a\u4e49\u6307\u4ee4\u662f\u4e00\u79cd\u8fd0\u884c\u65f6\u6307\u4ee4, \u4e0e\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u7c7b\u4f3c, \u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u5bf9\u8c61\u4e5f\u6709\u5b83\u81ea\u5df1\u751f\u547d\u5468\u671f:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"beforeMount"),(0,l.kt)("li",{parentName:"ul"},"mounted"),(0,l.kt)("li",{parentName:"ul"},"beforeUpdate"),(0,l.kt)("li",{parentName:"ul"},"updated"),(0,l.kt)("li",{parentName:"ul"},"beforeUnmount"),(0,l.kt)("li",{parentName:"ul"},"unmounted")),(0,l.kt)("p",null,"\u7f16\u5199\u4e00\u4e2a\u81ea\u5b9a\u4e49\u6307\u4ee4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const myDir: Directive = {\n  beforeMount(el, binds) {\n    console.log(el)\n    console.log(binds.value)\n    console.log(binds.oldValue)\n    console.log(binds.arg)\n    console.log(binds.modifiers)\n    console.log(binds.instance)\n  }\n}\n")),(0,l.kt)("p",null,"\u4f7f\u7528\u8be5\u6307\u4ee4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const App = {\n  setup() {\n    return () => {\n      return h('div', [\n        // \u8c03\u7528 withDirectives \u51fd\u6570\n        withDirectives(h('h1', 'hahah'), [\n          // \u56db\u4e2a\u53c2\u6570\u5206\u522b\u662f\uff1a\u6307\u4ee4\u3001\u503c\u3001\u53c2\u6570\u3001\u4fee\u9970\u7b26\n          [myDir, 10, 'arg', { foo: true }]\n        ])\n      ])\n    }\n  }\n}\n")),(0,l.kt)("p",null,"\u4e00\u4e2a\u5143\u7d20\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u6307\u4ee4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const App = {\n  setup() {\n    return () => {\n      return h('div', [\n        // \u8c03\u7528 withDirectives \u51fd\u6570\n        withDirectives(h('h1', 'hahah'), [\n          // \u56db\u4e2a\u53c2\u6570\u5206\u522b\u662f\uff1a\u6307\u4ee4\u3001\u503c\u3001\u53c2\u6570\u3001\u4fee\u9970\u7b26\n          [myDir, 10, 'arg', { foo: true }],\n          [myDir2, 10, 'arg', { foo: true }],\n          [myDir3, 10, 'arg', { foo: true }]\n        ])\n      ])\n    }\n  }\n}\n")),(0,l.kt)("h2",{id:"\u9759\u6001\u63d0\u5347props"},"\u9759\u6001\u63d0\u5347Props"),(0,l.kt)("p",null,"\u9759\u6001\u8282\u70b9\u7684\u63d0\u5347\u4ee5\u6811\u4e3a\u5355\u4f4d, \u5982\u679c\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u5b58\u5728\u975e\u9759\u6001\u7684\u5b50\u4ee3\u8282\u70b9, \u90a3\u4e48\u8be5",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u5c31\u4e0d\u662f\u9759\u6001\u7684, \u4e5f\u5c31\u4e0d\u4f1a\u88ab\u63d0\u5347. \u4f46\u8fd9\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Vnode"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"props"),"\u5374\u53ef\u80fd\u662f\u9759\u6001\u7684, \u8fd9\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"props"),"\u8fdb\u884c\u63d0\u5347, \u8fd9\u540c\u6837\u53ef\u4ee5\u8282\u7ea6",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u5bf9\u8c61\u7684\u521b\u5efa\u5f00\u9500, \u5185\u5b58\u5360\u7528\u7b49. \u4f8b\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n    <p foo="bar" a=b>{{ text }}</p>\n</div>\n')),(0,l.kt)("p",null,"\u5728\u8fd9\u6bb5\u6a21\u677f\u4e2d, ",(0,l.kt)("inlineCode",{parentName:"p"},"p"),"\u6807\u7b7e\u6709\u52a8\u6001\u7684\u6587\u672c\u5185\u5bb9, \u56e0\u6b64\u4e0d\u53ef\u4ee5\u88ab\u63d0\u5347, \u4f46",(0,l.kt)("inlineCode",{parentName:"p"},"p"),"\u6807\u7b7e\u7684\u6240\u6709\u5c5e\u6027\u90fd\u662f\u9759\u6001\u7684, \u56e0\u6b64\u53ef\u4ee5\u63d0\u5347\u5b83\u7684\u5c5e\u6027, \u7ecf\u8fc7\u63d0\u5347\u4ee5\u540e\u5176\u6e32\u67d3\u51fd\u6570\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const hoistProp = { foo: 'bar', a: 'b' }\n\nrender(ctx) {\n    return (openBlock(), createBlock('div', null, [\n        createVNode('p', hoistProp, ctx.text)\n    ]))\n}\n")),(0,l.kt)("p",null,"\u5373\u4f7f\u52a8\u6001\u7ed1\u5b9a\u7684\u5c5e\u6027\u503c, \u4f46\u5982\u679c\u503c\u662f\u5e38\u91cf, \u90a3\u4e48\u4e5f\u4f1a\u88ab\u63d0\u5347."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<p :foo=\"10\" :bar=\"'abc' + 'def'\">{{ text }}</p>\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"abc+def"),"\u5c31\u662f\u5e38\u91cf, \u4e5f\u53ef\u4ee5\u88ab\u63d0\u5347."),(0,l.kt)("h2",{id:"\u9884\u5b57\u7b26\u4e32\u5316"},"\u9884\u5b57\u7b26\u4e32\u5316"),(0,l.kt)("p",null,"\u9759\u6001\u63d0\u5347\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),"\u8282\u70b9\u6216\u8005\u8282\u70b9\u6570\u672c\u8eab\u662f\u9759\u6001\u7684, \u90a3\u4e48\u80fd\u591f\u5c06\u5176\u9884\u5148\u5b57\u7b26\u4e32\u5316\u5462? \u5982\u4e0b\u6a21\u677f\u6240\u793a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <p></p>\n    <p></p>\n    ...20 \u4e2a p \u6807\u7b7e\n    <p></p>\n</div>\n")),(0,l.kt)("p",null,"\u5047\u5982\u6807\u7b7e\u4e2d\u6709\u5927\u91cf\u8fde\u7eed\u7684\u9759\u6001\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"p"),"\u6807\u7b7e, \u5f53\u91c7\u7528\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"hoist"),"\u4f18\u5316\u4e4b\u540e, \u7ed3\u679c\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"cosnt hoist1 = createVNode('p', null, null, PatchFlags.HOISTED)\ncosnt hoist2 = createVNode('p', null, null, PatchFlags.HOISTED)\n// ... 20 \u4e2a hoistx \u53d8\u91cf\ncosnt hoist20 = createVNode('p', null, null, PatchFlags.HOISTED)\n\nrender() {\n    return (openBlock(), createBlock('div', null, [\n        hoist1, hoist2, ...20 \u4e2a\u53d8\u91cf, hoist20\n    ]))\n}\n")),(0,l.kt)("p",null,"\u9884\u5b57\u7b26\u4e32\u5316\u4f1a\u5c06\u8fd9\u4e9b\u9759\u6001\u8282\u70b9\u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32\u5e76\u751f\u6210\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Static"),"\u7c7b\u578b\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"VNode"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const hoistStatic = createStaticVNode('<p></p><p></p><p></p>...20\u4e2a...<p></p>')\n\nrender() {\n    return (openBlock(), createBlock('div', null, [\n       hoistStatic\n    ]))\n}\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u7684\u4f18\u52bf\u5728\u4e8e:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u751f\u6210\u4ee3\u7801\u7684\u4f53\u79ef\u51cf\u5c0f\u4e86"),(0,l.kt)("li",{parentName:"ul"},"\u51cf\u5c11\u4e86\u521b\u5efaVNode\u7684\u5f00\u9500"),(0,l.kt)("li",{parentName:"ul"},"\u51cf\u5c11\u4e86\u5185\u5b58\u7684\u5360\u7528")),(0,l.kt)("p",null,"\u9759\u6001\u8282\u70b9\u5728\u8fd0\u884c\u65f6\u4f1a\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"innerHTML"),"\u6765\u521b\u5efa\u771f\u5b9e\u8282\u70b9, \u56e0\u6b64\u5e76\u975e\u6240\u6709\u9759\u6001\u8282\u70b9\u90fd\u662f\u53ef\u4ee5\u9884\u5b57\u7b26\u4e32\u5316\u7684. "),(0,l.kt)("p",null,"\u53ef\u4ee5\u9884\u5b57\u7b26\u4e32\u5316\u7684\u9759\u6001\u8282\u70b9\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u975e\u8868\u683c\u7c7b\u6807\u7b7e: caption, thread, tr, th, tbody, td, tfoot, colgroup, col"),(0,l.kt)("li",{parentName:"ul"},"\u6807\u7b7e\u7684\u5c5e\u6027\u5fc5\u987b\u662f: \u6807\u51c6\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"html attribute"),",\u6216\u8005",(0,l.kt)("inlineCode",{parentName:"li"},"data-/aria-"),"\u7c7b\u5c5e\u6027")),(0,l.kt)("p",null,"\u5f53\u4e00\u4e2a\u8282\u70b9\u6ee1\u8db3\u8fd9\u4e9b\u6761\u4ef6\u7684\u65f6\u5019, \u8bf4\u660e\u8fd9\u4e2a\u8282\u70b9\u662f\u53ef\u4ee5\u9884\u5b57\u7b26\u4e32\u5316\u7684, \u4f46\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u8282\u70b9, \u90a3\u4e48\u4e5f\u4e0d\u4f1a\u5c06\u5176\u5b57\u7b26\u4e32\u5316, \u53ef\u5b57\u7b26\u4e32\u5316\u7684\u8282\u70b9\u5fc5\u987b\u8fde\u7eed\u5e76\u4e14\u8fbe\u5230\u4e00\u5b9a\u7684\u6570\u91cf\u624d\u884c:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u8282\u70b9\u6ca1\u6709\u5c5e\u6027, \u90a3\u4e48\u5fc5\u987b\u6709\u8fde\u7eed20\u4e2a\u53ca\u4ee5\u4e0a\u7684\u9759\u6001\u8282\u70b9\u5b58\u5728\u624d\u884c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <p></p>\n    <p></p>\n    ... 20 \u4e2a p \u6807\u7b7e\n    <p></p>\n</div>\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6216\u8005\u5728\u8fd9\u4e9b\u8fde\u7eed\u7684\u8282\u70b9\u4e2d\u67095\u4e2a\u53ca\u4ee5\u4e0a\u7684\u8282\u70b9\u662f\u6709\u5c5e\u6027\u7ed1\u5b9a\u7684\u8282\u70b9:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n    <p id="a"></p>\n    <p id="b"></p>\n    <p id="c"></p>\n    <p id="d"></p>\n    <p id="e"></p>\n</div>\n')),(0,l.kt)("p",null,"\u8fd9\u4e9b\u8282\u70b9\u4e0d\u4e00\u5b9a\u8981\u5144\u5f1f\u8282\u70b9, \u7236\u5b50\u8282\u70b9\u4e5f\u53ef\u4ee5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n    <p id="a">\n        <p id="b">\n            <p id="c">\n                <p id="d">\n                    <p id="e"></p>\n                </p>\n            </p>\n        </p>\n    </p>\n</div>\n')),(0,l.kt)("p",null,"\u9884\u5b57\u7b26\u4e32\u5316\u4f1a\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u8ba1\u7b97\u5c5e\u6027\u7684\u503c, \u6bd4\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <p :id=\"'id-' + 1\">\n        <p :id=\"'id-' + 2\">\n            <p :id=\"'id-' + 3\">\n                <p :id=\"'id-' + 4\">\n                    <p :id=\"'id-' + 5\"></p>\n                </p>\n            </p>\n        </p>\n    </p>\n</div>\n")),(0,l.kt)("p",null,"\u5b57\u7b26\u4e32\u5316\u4e4b\u540e: "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const hoistStatic = createStaticVNode(\'<p id="id-1"></p><p id="id-2"></p>.....<p id="id-5"></p>\'\uff09\n')),(0,l.kt)("h2",{id:"cache-event-handler-\u4e8b\u4ef6\u76d1\u542c\u7f13\u5b58"},"Cache Event handler \u4e8b\u4ef6\u76d1\u542c\u7f13\u5b58"),(0,l.kt)("p",null,"\u5982\u4e0b\u6a21\u677f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<Comp @change="a + b" />\n')),(0,l.kt)("p",null,"\u8fd9\u6bb5\u6a21\u677f\u5982\u679c\u624b\u5199\u6e32\u67d3\u51fd\u6570\u7684\u8bdd\u76f8\u5f53\u4e8e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render(ctx) {\n    return h(Comp, {\n        onChange: () => (ctx.a + ctx.b)\n    })\n}\n")),(0,l.kt)("p",null,"\u5f88\u663e\u7136, \u6bcf\u6b21",(0,l.kt)("inlineCode",{parentName:"p"},"render"),"\u51fd\u6570\u6267\u884c\u7684\u65f6\u5019, ",(0,l.kt)("inlineCode",{parentName:"p"},"Comp"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"props"),"\u90fd\u662f\u65b0\u7684\u5bf9\u8c61, ",(0,l.kt)("inlineCode",{parentName:"p"},"onChange"),"\u4e5f\u662f\u65b0\u7684\u51fd\u6570, \u8fd9\u5c31\u4f1a\u5bfc\u81f4",(0,l.kt)("inlineCode",{parentName:"p"},"Comp"),"\u7ec4\u4ef6\u7684\u66f4\u65b0. "),(0,l.kt)("p",null,"\u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"Vue3 Compiler"),"\u5f00\u542f",(0,l.kt)("inlineCode",{parentName:"p"},"prefixIdentifiers"),"\u4ee5\u53ca",(0,l.kt)("inlineCode",{parentName:"p"},"cacheHandlers"),"\u7684\u65f6\u5019, \u8fd9\u6bb5\u6a21\u677f\u4f1a\u88ab\u7f16\u8bd1\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render(ctx, cache) {\n    return h(Comp, {\n        onChange: cache[0] || (cache[0] = ($event) => (ctx.a + ctx.b))\n    })\n}\n")),(0,l.kt)("p",null,"\u8fd9\u6837\u5373\u4f7f\u591a\u6b21\u8c03\u7528\u6e32\u67d3\u51fd\u6570\u4e5f\u4e0d\u4f1a\u89e6\u53d1",(0,l.kt)("inlineCode",{parentName:"p"},"Comp"),"\u7ec4\u4ef6\u7684\u66f4\u65b0, \u56e0\u4e3a\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"Vue"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"patch"),"\u9636\u6bb5\u5bf9\u6bd4\u7684\u65f6\u5019, ",(0,l.kt)("inlineCode",{parentName:"p"},"props"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"onChange"),"\u7684\u5f15\u7528\u662f\u6ca1\u6709\u53d8\u5316\u7684. "),(0,l.kt)("p",null,"\u5982\u4e0a\u4ee3\u7801\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"render"),"\u51fd\u6570\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"cache"),"\u5bf9\u8c61\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"Vue"),"\u5185\u90e8\u5728\u8c03\u7528\u6e32\u67d3\u51fd\u6570\u5f0f\u6ce8\u5165\u7684\u4e00\u4e2a\u6570\u7ec4, \u60f3\u4e0b\u9762\u8fd9\u79cd:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render.call(ctx, ctx, [])\n")),(0,l.kt)("p",null,"\u5f53\u7136\u6211\u4eec\u4e0d\u4f9d\u8d56\u7f16\u8bd1\u4e5f\u80fd\u5199\u51fa\u7c7b\u4f3c\u5177\u5907cache\u80fd\u529b\u7684\u4ee3\u7801:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const Comp = {\n    setup() {\n        // \u5728 setup \u4e2d\u5b9a\u4e49 handler\n        const handleChange = () => {/* ... */}\n        return () => {\n            return h(AnthorComp, {\n                onChange: handleChange  // \u5f15\u7528\u4e0d\u53d8\n            })\n        }\n    }\n}\n")),(0,l.kt)("h2",{id:"v-once"},"v-once"),(0,l.kt)("p",null,'\u8fd9\u5728vue2\u4e2d\u4e5f\u6709\u652f\u6301, \u8fd9\u662f\u4e00\u4e2a\u5f88"\u6307\u4ee4"\u7684\u6307\u4ee4, \u56e0\u4e3a\u5b83\u5c31\u662f\u7ed9\u7f16\u8bd1\u5668\u770b\u7684, \u5f53\u7f16\u8bd1\u5668\u9047\u5230',(0,l.kt)("inlineCode",{parentName:"p"},"v-once"),"\u7684\u65f6\u5019, \u4f1a\u5229\u7528\u6211\u4eec\u521a\u521a\u8bb2\u8fc7\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"cache"),"\u6765\u7f13\u5b58\u5168\u90e8\u6216\u8005\u4e00\u90e8\u5206\u6e32\u67d3\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c, \u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u6a21\u677f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <div v-once>{{ foo }}</div>\n</div>\n")),(0,l.kt)("p",null,"\u4f1a\u88ab\u7f16\u8bd1\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render(ctx, cache) {\n    return (openBlock(), createBlock('div', null, [\n        cache[1] || (cache[1] = h(\"div\", null, ctx.foo, 1 /* TEXT */))\n    ]))\n}\n")),(0,l.kt)("p",null,"\u8fd9\u6837\u5c31\u7f13\u5b58\u4e86\u8fd9\u6bb5",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),", \u65e2\u7136",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u5df2\u7ecf\u88ab\u7f13\u5b58\u4e86, \u540e\u7eed\u7684\u66f4\u65b0\u5c31\u90fd\u4f1a\u8bfb\u53d6\u7f13\u5b58\u7684\u5185\u5bb9, \u800c\u4e0d\u4f1a\u91cd\u65b0\u521b\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u5bf9\u8c61\u4e86, \u540c\u65f6\u5728Diff\u7684\u8fc7\u7a0b\u4e2d\u4e5f\u5c31\u4e0d\u9700\u8981\u8fd9\u6bb5",(0,l.kt)("inlineCode",{parentName:"p"},"vnode"),"\u53c2\u4e0e\u4e86. \u901a\u5e38\u770b\u5230\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u66f4\u63a5\u8fd1\u5982\u4e0b\u5185\u5bb9:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"render(ctx, cache) {\n    return (openBlock(), createBlock('div', null, [\n        cache[1] || (\n            setBlockTracking(-1), // \u963b\u6b62\u8fd9\u6bb5 VNode \u88ab Block \u6536\u96c6\n            cache[1] = h(\"div\", null, ctx.foo, 1 /* TEXT */),\n            setBlockTracking(1), // \u6062\u590d\n            cache[1] // \u6574\u4e2a\u8868\u8fbe\u5f0f\u7684\u503c\n        )\n    ]))\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"openBlock()")," \u548c",(0,l.kt)("inlineCode",{parentName:"p"},"createBlock()"),"\u51fd\u6570\u7528\u6765\u521b\u5efa\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Block"),"\u3002\u800c ",(0,l.kt)("inlineCode",{parentName:"p"},"setBlockTracking(-1)")," \u5219\u7528\u6765\u6682\u505c\u6536\u96c6\u7684\u52a8\u4f5c."),(0,l.kt)("p",null,"\u6240\u4ee5\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"v-once"),"\u7f16\u8bd1\u751f\u6210\u4ee3\u7801\u4e2d\u4f60\u4f1a\u770b\u5230\u5b83, \u8fd9\u6837\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"v-once"),"\u5305\u88f9\u7684\u5185\u5bb9\u5c31\u4e0d\u4f1a\u88ab\u6536\u96c6\u5230\u7236Block\u4e2d, \u4e5f\u5c31\u4e0d\u53c2\u4e0eDiff\u4e86. "),(0,l.kt)("p",null,"\u6240\u4ee5, ",(0,l.kt)("inlineCode",{parentName:"p"},"v-once"),"\u7684\u6027\u80fd\u63d0\u5347\u6765\u81ea\u4e24\u4e2a\u65b9\u9762:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"VNode\u7684\u521b\u5efa\u5f00\u9500"),(0,l.kt)("li",{parentName:"ol"},"\u65e0\u7528\u7684Diff\u5f00\u9500. ")),(0,l.kt)("h2",{id:"ssr\u4f18\u5316"},"SSR\u4f18\u5316"),(0,l.kt)("p",null,"\u5f53\u9759\u6001\u5185\u5bb9\u8fbe\u5230\u4e00\u5b9a\u91cf\u7ea7\u7684\u65f6\u5019, \u4f1a\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"createStaticVnode"),"\u65b9\u6cd5\u5728\u5ba2\u6237\u7aef\u53bb\u751f\u6210\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"static node"),", \u8fd9\u4e9b\u9759\u6001\u7684node, \u4f1a\u88ab\u76f4\u63a5",(0,l.kt)("inlineCode",{parentName:"p"},"innerHtml"),", \u5c31\u4e0d\u9700\u8981\u521b\u5efa\u5bf9\u8c61, \u7136\u540e\u6839\u636e\u5bf9\u8c61\u6e32\u67d3."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <div>\n        <span>\u4f60\u597d</span>\n    </div>\n    ...  // \u5f88\u591a\u4e2a\u9759\u6001\u5c5e\u6027\n    <div>\n        <span>{{ message }}</span>\n    </div>\n</div>\n")),(0,l.kt)("p",null,"\u7f16\u8bd1\u540e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import { mergeProps as _mergeProps } from "vue"\nimport { ssrRenderAttrs as _ssrRenderAttrs, ssrInterpolate as _ssrInterpolate } from "@vue/server-renderer"\n\nexport function ssrRender(_ctx, _push, _parent, _attrs, $props, $setup, $data, $options) {\n  const _cssVars = { style: { color: _ctx.color }}\n  _push(`<div${\n    _ssrRenderAttrs(_mergeProps(_attrs, _cssVars))\n  }><div><span>\u4f60\u597d</span>...<div><span>\u4f60\u597d</span><div><span>${\n    _ssrInterpolate(_ctx.message)\n  }</span></div></div>`)\n}\n')))}k.isMDXComponent=!0}}]);