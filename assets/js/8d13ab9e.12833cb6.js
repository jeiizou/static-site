"use strict";(self.webpackChunkwiki_site=self.webpackChunkwiki_site||[]).push([[1019],{50158:(n,e,t)=>{t.d(e,{Zo:()=>u,kt:()=>m});var a=t(46393);function l(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function s(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){l(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function i(n,e){if(null==n)return{};var t,a,l=function(n,e){if(null==n)return{};var t,a,l={},r=Object.keys(n);for(a=0;a<r.length;a++)t=r[a],e.indexOf(t)>=0||(l[t]=n[t]);return l}(n,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(a=0;a<r.length;a++)t=r[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(l[t]=n[t])}return l}var o=a.createContext({}),c=function(n){var e=a.useContext(o),t=e;return n&&(t="function"==typeof n?n(e):s(s({},e),n)),t},u=function(n){var e=c(n.components);return a.createElement(o.Provider,{value:e},n.children)},p={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(n,e){var t=n.components,l=n.mdxType,r=n.originalType,o=n.parentName,u=i(n,["components","mdxType","originalType","parentName"]),d=c(t),m=l,k=d["".concat(o,".").concat(m)]||d[m]||p[m]||r;return t?a.createElement(k,s(s({ref:e},u),{},{components:t})):a.createElement(k,s({ref:e},u))}));function m(n,e){var t=arguments,l=e&&e.mdxType;if("string"==typeof n||l){var r=t.length,s=new Array(r);s[0]=d;var i={};for(var o in e)hasOwnProperty.call(e,o)&&(i[o]=e[o]);i.originalType=n,i.mdxType="string"==typeof n?n:l,s[1]=i;for(var c=2;c<r;c++)s[c]=t[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},47362:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var a=t(39421),l=(t(46393),t(50158));const r={},s="\u8bed\u6cd5\u7279\u6027-Decorators",i={unversionedId:"\u524d\u7aef\u57fa\u7840/JavsScript/1-8-\u8bed\u6cd5\u7279\u6027-\u88c5\u9970\u5668",id:"\u524d\u7aef\u57fa\u7840/JavsScript/1-8-\u8bed\u6cd5\u7279\u6027-\u88c5\u9970\u5668",title:"\u8bed\u6cd5\u7279\u6027-Decorators",description:"Decorator\u7684\u5386\u53f2",source:"@site/docs/01-\u524d\u7aef\u57fa\u7840/01-JavsScript/1-8-\u8bed\u6cd5\u7279\u6027-\u88c5\u9970\u5668.md",sourceDirName:"01-\u524d\u7aef\u57fa\u7840/01-JavsScript",slug:"/\u524d\u7aef\u57fa\u7840/JavsScript/1-8-\u8bed\u6cd5\u7279\u6027-\u88c5\u9970\u5668",permalink:"/docs/\u524d\u7aef\u57fa\u7840/JavsScript/1-8-\u8bed\u6cd5\u7279\u6027-\u88c5\u9970\u5668",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u8bed\u6cd5\u7279\u6027-MutationObserver",permalink:"/docs/\u524d\u7aef\u57fa\u7840/JavsScript/1-7-\u8bed\u6cd5\u7279\u6027-MutationObserver"},next:{title:"\u8bed\u6cd5\u7279\u6027-ES~ES11\u7279\u6027\u6c47\u603b",permalink:"/docs/\u524d\u7aef\u57fa\u7840/JavsScript/1-9-\u8bed\u6cd5\u7279\u6027-ES~ES11\u7279\u6027\u6c47\u603b"}},o={},c=[{value:"Decorator\u7684\u5386\u53f2",id:"decorator\u7684\u5386\u53f2",level:2},{value:"\u4ec0\u4e48\u662f Decorators",id:"\u4ec0\u4e48\u662f-decorators",level:2},{value:"Decorator Function",id:"decorator-function",level:3},{value:"\u88c5\u9970\u5668\u7684\u4f5c\u7528",id:"\u88c5\u9970\u5668\u7684\u4f5c\u7528",level:2},{value:"\u80fd\u529b1: \u66ff\u6362\u88c5\u9970\u5b9e\u4f53",id:"\u80fd\u529b1-\u66ff\u6362\u88c5\u9970\u5b9e\u4f53",level:3},{value:"\u80fd\u529b2: \u5411\u5176\u4ed6\u4eba\u516c\u5f00\u5bf9\u88c5\u9970\u5b9e\u4f53\u7684\u8bbf\u95ee",id:"\u80fd\u529b2-\u5411\u5176\u4ed6\u4eba\u516c\u5f00\u5bf9\u88c5\u9970\u5b9e\u4f53\u7684\u8bbf\u95ee",level:3},{value:"\u80fd\u529b3: \u5904\u7406\u88c5\u9970\u5b9e\u4f53\u53ca\u5176\u5bb9\u5668",id:"\u80fd\u529b3-\u5904\u7406\u88c5\u9970\u5b9e\u4f53\u53ca\u5176\u5bb9\u5668",level:3},{value:"\u6c47\u603b",id:"\u6c47\u603b",level:3},{value:"Decorators \u7684\u8bed\u6cd5\u548c\u8bed\u4e49",id:"decorators-\u7684\u8bed\u6cd5\u548c\u8bed\u4e49",level:2},{value:"\u8868\u8fbe\u5f0f\u8bed\u6cd5",id:"\u8868\u8fbe\u5f0f\u8bed\u6cd5",level:3},{value:"\u88c5\u9970\u5668\u7684\u6267\u884c\u987a\u5e8f",id:"\u88c5\u9970\u5668\u7684\u6267\u884c\u987a\u5e8f",level:3},{value:"\u88c5\u9970\u5668\u521d\u59cb\u5316\u5668\u8fd0\u884c\u7684\u65f6\u673a",id:"\u88c5\u9970\u5668\u521d\u59cb\u5316\u5668\u8fd0\u884c\u7684\u65f6\u673a",level:3},{value:"\u4ece\u88c5\u9970\u5668\u4e2d\u66b4\u9732\u6570\u636e",id:"\u4ece\u88c5\u9970\u5668\u4e2d\u66b4\u9732\u6570\u636e",level:2},{value:"\u5c06\u66b4\u9732\u6570\u636e\u5b58\u50a8\u5728\u5468\u8fb9\u8303\u56f4\u5185",id:"\u5c06\u66b4\u9732\u6570\u636e\u5b58\u50a8\u5728\u5468\u8fb9\u8303\u56f4\u5185",level:3},{value:"\u901a\u8fc7\u5de5\u5382\u51fd\u6570\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e",id:"\u901a\u8fc7\u5de5\u5382\u51fd\u6570\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e",level:3},{value:"\u901a\u8fc7\u7c7b\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e",id:"\u901a\u8fc7\u7c7b\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e",level:3},{value:"\u7c7b\u88c5\u9970\u5668",id:"\u7c7b\u88c5\u9970\u5668",level:2},{value:"\u4f8b\u5b50: \u6536\u96c6\u5b9e\u4f8b",id:"\u4f8b\u5b50-\u6536\u96c6\u5b9e\u4f8b",level:3},{value:"1. \u7528<code>.prototype</code>\u624b\u52a8\u8bbe\u7f6e<code>instanceof</code>:",id:"1-\u7528prototype\u624b\u52a8\u8bbe\u7f6einstanceof",level:4},{value:"2. \u7528<code>Symbol.hasInstance</code>",id:"2-\u7528symbolhasinstance",level:4},{value:"3. \u901a\u8fc7\u5b50\u7c7b\u542f\u7528<code>instanceof</code>",id:"3-\u901a\u8fc7\u5b50\u7c7b\u542f\u7528instanceof",level:4},{value:"\u7c7b\u65b9\u6cd5\u88c5\u9970\u5668",id:"\u7c7b\u65b9\u6cd5\u88c5\u9970\u5668",level:2},{value:"\u4f8b\u5b50: \u8ddf\u8e2a\u65b9\u6cd5\u8c03\u7528",id:"\u4f8b\u5b50-\u8ddf\u8e2a\u65b9\u6cd5\u8c03\u7528",level:3},{value:"\u4f8b\u5b50: \u5c06\u65b9\u6cd5\u7ed1\u5b9a\u5230\u5b9e\u4f8b",id:"\u4f8b\u5b50-\u5c06\u65b9\u6cd5\u7ed1\u5b9a\u5230\u5b9e\u4f8b",level:3},{value:"\u4f8b\u5b50: \u5c06\u51fd\u6570\u5e94\u7528\u4e8e\u65b9\u6cd5",id:"\u4f8b\u5b50-\u5c06\u51fd\u6570\u5e94\u7528\u4e8e\u65b9\u6cd5",level:3},{value:"\u7c7b\u7684getter\u88c5\u9970\u5668/setter\u88c5\u9970\u5668",id:"\u7c7b\u7684getter\u88c5\u9970\u5668setter\u88c5\u9970\u5668",level:2},{value:"\u4f8b\u5b50: \u5ef6\u8fdf\u8ba1\u7b97\u503c",id:"\u4f8b\u5b50-\u5ef6\u8fdf\u8ba1\u7b97\u503c",level:3},{value:"\u7c7b\u5b57\u6bb5\u88c5\u9970\u5668",id:"\u7c7b\u5b57\u6bb5\u88c5\u9970\u5668",level:2},{value:"\u4f8b\u5b50: \u66f4\u6539\u5b57\u6bb5\u7684\u521d\u59cb\u5316\u503c",id:"\u4f8b\u5b50-\u66f4\u6539\u5b57\u6bb5\u7684\u521d\u59cb\u5316\u503c",level:3},{value:"\u4f8b\u5b50: \u53ea\u8bfb\u5b57\u6bb5",id:"\u4f8b\u5b50-\u53ea\u8bfb\u5b57\u6bb5",level:3},{value:"\u4f8b\u5b50: \u4f9d\u8d56\u6ce8\u5165, \u5b9e\u4f8b\u516c\u5171\u5b57\u6bb5.",id:"\u4f8b\u5b50-\u4f9d\u8d56\u6ce8\u5165-\u5b9e\u4f8b\u516c\u5171\u5b57\u6bb5",level:3},{value:"\u4f8b\u5b50: &quot;\u670b\u53cb&quot;\u53ef\u89c1\u6027",id:"\u4f8b\u5b50-\u670b\u53cb\u53ef\u89c1\u6027",level:3},{value:"\u4f8b\u5b50: \u679a\u4e3e",id:"\u4f8b\u5b50-\u679a\u4e3e",level:3},{value:"\u81ea\u52a8\u8bbf\u95ee\u5668",id:"\u81ea\u52a8\u8bbf\u95ee\u5668",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981",id:"\u4e3a\u4ec0\u4e48\u9700\u8981",level:3},{value:"\u7c7b\u81ea\u52a8\u8bbf\u95ee\u88c5\u9970\u5668",id:"\u7c7b\u81ea\u52a8\u8bbf\u95ee\u88c5\u9970\u5668",level:2},{value:"\u4f8b\u5b50: \u53ea\u8bfb\u81ea\u52a8\u8bbf\u95ee\u5668",id:"\u4f8b\u5b50-\u53ea\u8bfb\u81ea\u52a8\u8bbf\u95ee\u5668",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}],u={toc:c};function p(n){let{components:e,...t}=n;return(0,l.kt)("wrapper",(0,a.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u8bed\u6cd5\u7279\u6027-decorators"},"\u8bed\u6cd5\u7279\u6027-Decorators"),(0,l.kt)("h2",{id:"decorator\u7684\u5386\u53f2"},"Decorator\u7684\u5386\u53f2"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"2014\u5e744\u670810\u65e5, Decorators\u5728TC39\u4e0a\u5457\u63d0\u51fa. \u8fd9\u4e2a\u63d0\u6848\u88ab\u6dfb\u52a0\u5230TC39\u7684stage0\u9636\u6bb5"),(0,l.kt)("li",{parentName:"ul"},"2014\u5e7410\u670822\u65e5, Angular\u56e2\u961f\u5ba3\u5e03Angular2.0\u4f1a\u4f7f\u7528AtScript\u5e76\u4e14\u7f16\u8bd1\u5230js\u548cDart. \u4ed6\u4eec\u8ba1\u5212\u5728AtScript\u4e2d\u652f\u6301:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e09\u79cd\u7c7b\u578b\u6ce8\u91ca:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7c7b\u578b\u6ce8\u91ca"),(0,l.kt)("li",{parentName:"ul"},"\u5b57\u6bb5\u6811\u6ce8\u91ca\u663e\u5f0f\u58f0\u660e"),(0,l.kt)("li",{parentName:"ul"},"\u5143\u6570\u636e\u6ce8\u91ca, \u5177\u6709\u548c\u88c5\u9970\u5668\u76f8\u540c\u7684\u8bed\u6cd5, \u4f46\u662f\u53ea\u6dfb\u52a0\u5143\u6570\u636e, \u4e0d\u6539\u5e26\u6ce8\u91ca\u7684\u6784\u9020\u7684\u5de5\u4f5c\u65b9\u5f0f"))),(0,l.kt)("li",{parentName:"ul"},"\u8fd0\u884c\u65f6\u7684\u7c7b\u578b\u68c0\u67e5"),(0,l.kt)("li",{parentName:"ul"},"type introspection: \u7c7b\u578b\u5185\u7701"))),(0,l.kt)("li",{parentName:"ul"},"2015\u5e741\u670828\u65e5, angular\u548cts\u56e2\u961f\u4ea4\u6362\u4e86\u4e00\u4e9b\u60f3\u6cd5, 3\u67085\u65e5, angular\u548cts\u56e2\u961f\u5ba3\u5e03angular\u4eceAtScript\u76f4\u63a5\u5207\u6362\u5230\u4f7f\u7528TpeScript, Typescript\u4f1a\u652f\u6301\u4e00\u4e9bAtScript\u7684\u7279\u6027(\u5c24\u5176\u662f\u88c5\u9970\u5668\u7684\u90e8\u5206)"),(0,l.kt)("li",{parentName:"ul"},"2015\u5e743\u670824\u65e5, decorator \u63d0\u6848\u88ab\u63a8\u8fdb\u5230stage1,"),(0,l.kt)("li",{parentName:"ul"},"2015\u5e747\u670820\u65e5, ts1.5\u53d1\u5e03, \u5e76\u4e14\u652f\u6301\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"experimentalDecorators"),"\u5f00\u542fstage1\u4e0b\u7684\u88c5\u9970\u5668\u8d8a\u53d1"),(0,l.kt)("li",{parentName:"ul"},"2016\u5e747\u670828\u65e5, decorator \u88ab\u63a8\u8fdb\u5230stage2."),(0,l.kt)("li",{parentName:"ul"},"2022\u5e743\u670828\u65e5, decorator \u88ab\u63a8\u8fdb\u5230stage3.")),(0,l.kt)("h2",{id:"\u4ec0\u4e48\u662f-decorators"},"\u4ec0\u4e48\u662f Decorators"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Decorators"),"\u53ef\u4ee5\u8ba9\u6211\u4eec\u6539\u53d8\u4f7f\u7528js\u7684\u6784\u9020\u51fd\u6570(class\u6216\u8005\u5176\u6210\u5458\u65b9\u6cd5), \u6bd4\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class C {\n  @trace\n  toString() {\n    return 'C';\n  }\n}\n")),(0,l.kt)("p",null,"\u5b9e\u73b0",(0,l.kt)("inlineCode",{parentName:"p"},"trace"),"\u53ea\u9700\u8981\u5199\u4e00\u4e2a\u51fd\u6570:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function trace(decoratedMethod) {\n  // Returns a function that replaces `decoratedMethod`.\n}\n")),(0,l.kt)("p",null,"\u4e0a\u9762\u7684class C\u7b49\u4ef7\u4e8e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class C {\n  toString() {\n    return 'C';\n  }\n}\nC.prototype.toString = trace(C.prototype.toString);\n")),(0,l.kt)("p",null,"\u6362\u53e5\u8bdd\u8bf4, \u4e00\u4e2aDecorators\u5c31\u662f\u4e00\u4e2a\u80fd\u591f\u7528\u6765\u5f53\u4e00\u4e2a\u6784\u9020\u5668\u7684\u51fd\u6570."),(0,l.kt)("p",null,"\u7f16\u5199\u548c\u4f7f\u7528Decorators\u662f\u5143\u7f16\u7a0b\u7684\u4e00\u79cd:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6211\u4eec\u4e0d\u5199\u76f4\u63a5\u5904\u7406\u6570\u636e\u7684\u4ee3\u7801(\u7f16\u7a0b)"),(0,l.kt)("li",{parentName:"ul"},"\u6211\u4eec\u5199\u7684\u4ee3\u7801\u4f1a\u7528\u4e8e\u5904\u7406\u7528\u6237\u4ee3\u7801(\u5143\u7f16\u7a0b)")),(0,l.kt)("h3",{id:"decorator-function"},"Decorator Function"),(0,l.kt)("p",null,"\u88c5\u9970\u5668\u51fd\u6570\u5728TS\u7684\u4e2d\u7c7b\u578b\u58f0\u660e\u5927\u6982\u662f\u8fd9\u6837\u7684:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type Decorator = (\n  value: DecoratedValue, // only fields differ\n  context: {\n    kind: string;\n    name: string | symbol;\n    addInitializer(initializer: () => void): void;\n\n    // Don\u2019t always exist:\n    static: boolean;\n    private: boolean;\n    access: {get: () => unknown, set: (value: unknown) => void};\n  }\n) => void | ReplacementValue; // only fields differ\n")),(0,l.kt)("p",null,"\u4e00\u4e2a\u88c5\u9970\u5668\u51fd\u6570, \u4e00\u822c\u6765\u8bf4\u662f\u4e00\u4e2a\u51fd\u6570"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"value: \u88c5\u9970\u5668\u88c5\u9970\u7684\u51fd\u6570(\u7c7b\u6216\u6210\u5458)"),(0,l.kt)("li",{parentName:"ul"},"context\u5bf9\u8c61:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9644\u52a0\u7684value\u7684\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u7b80\u5355\u7684api, \u7528\u4e8e\u8fdb\u884c\u5143\u7f16\u7a0b")))),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"kind"),"\u5c5e\u6027\u544a\u8bc9\u88c5\u9970\u5668\u662f\u7528\u5728\u54ea\u4e2aJS\u6784\u9020\u5668\u4e0a, \u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u7528\u540c\u6837\u7684\u88c5\u9970\u5668\u6765\u5e94\u7528\u5230\u591a\u4e2a\u76ee\u6807\u7684\u6784\u9020\u5668."),(0,l.kt)("p",null,"\u5f53\u524d\u6765\u8bf4, \u53cc\u65f6\u671f\u53ef\u4ee5\u7528\u5728:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"class"),(0,l.kt)("li",{parentName:"ul"},"method"),(0,l.kt)("li",{parentName:"ul"},"getter"),(0,l.kt)("li",{parentName:"ul"},"setter"),(0,l.kt)("li",{parentName:"ul"},"accessor(\u4e00\u4e2a\u65b0\u7684\u7c7b\u6210\u5458, \u7a0d\u540e\u4ecb\u7ecd)"),(0,l.kt)("li",{parentName:"ul"},"filed")),(0,l.kt)("p",null,"\u5176\u7c7b\u578b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type Decorator =\n  | ClassDecorator\n  | ClassMethodDecorator\n  | ClassGetterDecorator\n  | ClassSetterDecorator\n  | ClassAutoAccessorDecorator\n  | ClassFieldDecorator\n;\n")),(0,l.kt)("h2",{id:"\u88c5\u9970\u5668\u7684\u4f5c\u7528"},"\u88c5\u9970\u5668\u7684\u4f5c\u7528"),(0,l.kt)("p",null,"\u6bcf\u4e2a\u88c5\u9970\u5668\u90fd\u53ef\u4ee5\u6709\u56db\u4e2a\u65b9\u9762\u7684\u4f5c\u7528:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5b83\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u53c2\u6570\u503c\u6765\u66f4\u6539\u4fee\u9970\u7684\u5b9e\u4f53\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5b83\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56de\u517c\u5bb9\u7684\u503c\u6765\u66ff\u6362\u4fee\u9970\u7684\u5b9e\u4f53.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Compatible"),", \u88c5\u9970\u5668\u5fc5\u987b\u8fd4\u56de\u76f8\u540c\u7c7b\u578b\u7684\u503c, \u6bd4\u5982class\u7684\u88c5\u9970\u5668\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u53ef\u6784\u9020\u7684\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u88c5\u9970\u5668\u4e0d\u60f3\u66ff\u6362\u88c5\u9970\u503c\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u4e0d\u8fd4\u56de\u4efb\u4f55\u5185\u5bb9\u6765\u663e\u5f0f\u6216\u9690\u5f0f\u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"li"},"undefined")))),(0,l.kt)("li",{parentName:"ul"},"\u5411\u5176\u4ed6\u4eba\u5c55\u793a\u5bf9\u88c5\u9970\u5b9e\u4f53\u7684\u8bbf\u95ee\u6743\u9650\u3002\u4e0a\u4e0b\u6587",(0,l.kt)("inlineCode",{parentName:"li"},"access"),"\u4f7f\u5b83\u80fd\u591f\u901a\u8fc7\u5176\u65b9\u6cd5",(0,l.kt)("inlineCode",{parentName:"li"},".get()"),"\u548c",(0,l.kt)("inlineCode",{parentName:"li"},".set()"),"\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5904\u7406\u4fee\u9970\u5b9e\u4f53\u53ca\u5176\u5bb9\u5668\uff08\u5982\u679c\u5b83\u6709\u4e00\u4e2a\uff09\uff0c\u5728\u4e24\u8005\u90fd\u5b58\u5728\u4e4b\u540e\uff1a\u8be5\u529f\u80fd\u7531context.addInitializer\u63d0\u4f9b\u3002\u5b83\u5141\u8bb8\u88c5\u9970\u5668\u6ce8\u518c\u4e00\u4e2a\u521d\u59cb\u503c\u8bbe\u5b9a\u9879\u2014\u2014\u4e00\u4e2a\u5728\u4e00\u5207\u5c31\u7eea\u65f6\u8c03\u7528\u7684\u56de\u8c03\uff08\u7a0d\u540e\u5c06\u89e3\u91ca\u66f4\u591a\u7ec6\u8282\uff09\u3002")),(0,l.kt)("h3",{id:"\u80fd\u529b1-\u66ff\u6362\u88c5\u9970\u5b9e\u4f53"},"\u80fd\u529b1: \u66ff\u6362\u88c5\u9970\u5b9e\u4f53"),(0,l.kt)("p",null,"\u4e3e\u4f8b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function replaceMethod() {\n  return function () { // (A)\n    return `How are you, ${this.name}?`;\n  }\n}\n\nclass Person {\n  constructor(name) {\n    this.name = name;\n  }\n  @replaceMethod\n  hello() { // (B)\n    return `Hi ${this.name}!`;\n  }\n}\n\nconst robin = new Person('Robin');\nassert.equal(\n  robin.hello(), 'How are you, Robin?'\n);\n")),(0,l.kt)("p",null,"\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d, \u88c5\u9970\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"@replaceMethod"),"\u628a",(0,l.kt)("inlineCode",{parentName:"p"},"hello"),"\u65b9\u6cd5\u66ff\u6210\u4e86\u81ea\u5df1\u8fd4\u56de\u7684\u51fd\u6570."),(0,l.kt)("h3",{id:"\u80fd\u529b2-\u5411\u5176\u4ed6\u4eba\u516c\u5f00\u5bf9\u88c5\u9970\u5b9e\u4f53\u7684\u8bbf\u95ee"},"\u80fd\u529b2: \u5411\u5176\u4ed6\u4eba\u516c\u5f00\u5bf9\u88c5\u9970\u5b9e\u4f53\u7684\u8bbf\u95ee"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"let acc;\nfunction exposeAccess(_value, {access}) {\n  acc = access;\n}\n\nclass Color {\n  @exposeAccess\n  name = 'green'\n}\n\nconst green = new Color();\nassert.equal(\n  green.name, 'green'\n);\n// Using `acc` to get and set `green.name`\nassert.equal(\n  acc.get.call(green), 'green'\n);\nacc.set.call(green, 'red');\nassert.equal(\n  green.name, 'red'\n);\n")),(0,l.kt)("p",null,"\u88c5\u9970\u5c06\u4e00\u4e2a\u5bf9\u8c61\u5b58\u50a8\u5728\u53d8\u91cface\u4e2d, \u8be5\u53d8\u91cf\u5141\u8bb8\u6211\u4eec\u8bbf\u95ee",(0,l.kt)("inlineCode",{parentName:"p"},"green"),"\u7684\u5b9e\u4f8b\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"color")),(0,l.kt)("h3",{id:"\u80fd\u529b3-\u5904\u7406\u88c5\u9970\u5b9e\u4f53\u53ca\u5176\u5bb9\u5668"},"\u80fd\u529b3: \u5904\u7406\u88c5\u9970\u5b9e\u4f53\u53ca\u5176\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function collect(_value, {name, addInitializer}) {\n  addInitializer(function () { // (A)\n    if (!this.collectedMethodKeys) {\n      this.collectedMethodKeys = new Set();\n    }\n    this.collectedMethodKeys.add(name);\n  });\n}\n\nclass C {\n  @collect\n  toString() {}\n  @collect\n  [Symbol.iterator]() {}\n}\nconst inst = new C();\nassert.deepEqual(\n  inst.collectedMethodKeys,\n  new Set(['toString', Symbol.iterator])\n);\n")),(0,l.kt)("p",null,"\u521d\u59cb\u5316\u88c5\u9970\u5668\u5fc5\u987b\u662f\u666e\u901a\u51fd\u6570(\u975e\u7bad\u5934), \u56e0\u4e3athis\u9700\u8981\u8bbf\u95ee\u9690\u5f0f\u91c7\u7eb3\u6570. \u7bad\u5934\u51fd\u6570\u4e0d\u63d0\u4f9b\u8fd9\u79cd\u8bbf\u95ee, \u4ed6\u4eec\u7684this\u662f\u9759\u6001\u4f5c\u7528\u57df\u7684."),(0,l.kt)("h3",{id:"\u6c47\u603b"},"\u6c47\u603b"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u88c5\u9970\u5668\u7c7b\u578b"),(0,l.kt)("th",{parentName:"tr",align:null},"(input) => output"),(0,l.kt)("th",{parentName:"tr",align:null},".access"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Class"),(0,l.kt)("td",{parentName:"tr",align:null},"(func) => func2"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2013")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Method"),(0,l.kt)("td",{parentName:"tr",align:null},"(func) => func2"),(0,l.kt)("td",{parentName:"tr",align:null},"{get}")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Getter"),(0,l.kt)("td",{parentName:"tr",align:null},"(func) => func2"),(0,l.kt)("td",{parentName:"tr",align:null},"{get}")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Setter"),(0,l.kt)("td",{parentName:"tr",align:null},"(func) => func2"),(0,l.kt)("td",{parentName:"tr",align:null},"{set}")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Auto-accessor"),(0,l.kt)("td",{parentName:"tr",align:null},"({get,set}) => {get,set,init}"),(0,l.kt)("td",{parentName:"tr",align:null},"{get,set}")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Field"),(0,l.kt)("td",{parentName:"tr",align:null},"() => (initValue)=>initValue2"),(0,l.kt)("td",{parentName:"tr",align:null},"{get,set}")))),(0,l.kt)("p",null,"\u5176\u4e2d\u6bcf\u4e2a\u51fd\u6570\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"this"),"\u7684\u503c\u5982\u4e0b:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"this is \u2192"),(0,l.kt)("th",{parentName:"tr",align:null},"undefined"),(0,l.kt)("th",{parentName:"tr",align:null},"Class"),(0,l.kt)("th",{parentName:"tr",align:null},"Instance"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Decorator               function"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Static                  initializer"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Non-static              initializer"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Static field decorator  result"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Non-static field        decorator result"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714")))),(0,l.kt)("h2",{id:"decorators-\u7684\u8bed\u6cd5\u548c\u8bed\u4e49"},"Decorators \u7684\u8bed\u6cd5\u548c\u8bed\u4e49"),(0,l.kt)("h3",{id:"\u8868\u8fbe\u5f0f\u8bed\u6cd5"},"\u8868\u8fbe\u5f0f\u8bed\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"@(<<expr>>)\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u8fde\u7eed\u4f7f\u7528\u591a\u4e2a\u88c5\u9970\u5668:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"@myFunc\n@myFuncFactory('arg1', 'arg2')\n\n@libraryModule.prop\n@someObj.method(123)\n\n@(wrap(dict['prop'])) // arbitrary expression\n\nclass MyClass {}\n")),(0,l.kt)("h3",{id:"\u88c5\u9970\u5668\u7684\u6267\u884c\u987a\u5e8f"},"\u88c5\u9970\u5668\u7684\u6267\u884c\u987a\u5e8f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@"),"\u8bc4\u4f30: \u5728\u7c7b\u5b9a\u4e49\u7684\u6267\u884c\u671f\u95f4\u7b26\u53f7\u540e\u7684\u8868\u8fbe\u5f0f, \u4ee5\u53ca\u8ba1\u7b97\u7684\u5c5e\u6027\u952e\u548c\u9759\u6001\u5b57\u6bb5. \u7ed3\u679c\u5fc5\u987b\u662f\u4e00\u4e2a\u51fd\u6570, \u4ed6\u4eec\u5b58\u50a8\u5728\u4e34\u65f6\u4f4d\u7f6e\u4ee5\u4fbf\u7a0d\u540e\u8c03\u7528"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u8c03\u7528"),": \u88c5\u9970\u5668\u51fd\u6570\u5728\u7c7b\u5b9a\u4e49\u7684\u6267\u884c\u671f\u95f4\u88ab\u8c03\u7528, \u5728\u65b9\u6cd5\u88ab\u8bc4\u4f30\u4e4b\u540e, \u6784\u9020\u51fd\u6570\u548c\u539f\u578b\u88ab\u7ec4\u88c5\u4e4b\u524d. \u5176\u6267\u884c\u7ed3\u679c\u518d\u6b21\u88ab\u5b58\u50a8\u5728\u4e34\u65f6\u7684\u4f4d\u7f6e"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u5e94\u7528"),": \u8c03\u7528\u6240\u6709\u88c5\u9970\u5668\u51fd\u6570\u540e, \u4f7f\u7528\u4ed6\u4eec\u7684\u7ed3\u679c, \u5f71\u54cd\u6784\u9020\u51fd\u6570\u548c\u539f\u578b. ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function decorate(str) {\n  console.log(`EVALUATE @decorate(): ${str}`);\n  return () => console.log(`APPLY @decorate(): ${str}`); // (A)\n}\nfunction log(str) {\n  console.log(str);\n  return str;\n}\n\n@decorate('class')\nclass TheClass {\n\n  @decorate('static field')\n  static staticField = log('static field value');\n\n  @decorate('prototype method')\n  [log('computed key')]() {}\n\n  @decorate('instance field')\n  instanceField = log('instance field value');\n    // This initializer only runs if we instantiate the class\n}\n\n// Output:\n// EVALUATE @decorate(): class\n// EVALUATE @decorate(): static field\n// EVALUATE @decorate(): prototype method\n// computed key\n// EVALUATE @decorate(): instance field\n// APPLY @decorate(): prototype method\n// APPLY @decorate(): static field\n// APPLY @decorate(): instance field\n// APPLY @decorate(): class\n// static field value\n")),(0,l.kt)("h3",{id:"\u88c5\u9970\u5668\u521d\u59cb\u5316\u5668\u8fd0\u884c\u7684\u65f6\u673a"},"\u88c5\u9970\u5668\u521d\u59cb\u5316\u5668\u8fd0\u884c\u7684\u65f6\u673a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7c7b\u88c5\u9970\u5668\u521d\u59cb\u5316\u5668\u5728\u7c7b\u88ab\u5b8c\u5168\u5b9a\u4e49\u5e76\u4e14\u6240\u6709\u9759\u6001\u5b57\u6bb5\u90fd\u88ab\u521d\u59cb\u5316\u4e4b\u540e\u8fd0\u884c"),(0,l.kt)("li",{parentName:"ul"},"\u975e\u9759\u6001\u7c7b\u5143\u7d20\u7684\u521d\u59cb\u5316\u5668\u5728\u5b9e\u4f8b\u5316\u671f\u95f4\u8fd0\u884c, \u5728\u5b9e\u4f8b\u5b57\u6bb5\u88ab\u521d\u59cb\u5316\u4e4b\u524d"),(0,l.kt)("li",{parentName:"ul"},"\u9759\u6001\u7c7b\u5143\u7d20\u88c5\u9970\u5668\u7684\u521d\u59cb\u5316\u5668\u5728\u7c7b\u5b9a\u4e49\u671f\u95f4\u8fd0\u884c,\u5728\u5b9a\u4e49\u9759\u6001\u5b57\u6bb5\u4e4b\u524d\u4f46\u5728\u5b9a\u4e49\u5176\u4ed6\u6240\u6709\u7c7b\u5143\u7d20\u4e4b\u540e")),(0,l.kt)("h2",{id:"\u4ece\u88c5\u9970\u5668\u4e2d\u66b4\u9732\u6570\u636e"},"\u4ece\u88c5\u9970\u5668\u4e2d\u66b4\u9732\u6570\u636e"),(0,l.kt)("h3",{id:"\u5c06\u66b4\u9732\u6570\u636e\u5b58\u50a8\u5728\u5468\u8fb9\u8303\u56f4\u5185"},"\u5c06\u66b4\u9732\u6570\u636e\u5b58\u50a8\u5728\u5468\u8fb9\u8303\u56f4\u5185"),(0,l.kt)("p",null,"\u6bd4\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const classes = new Set(); // (A)\n\nfunction collect(value, {kind, addInitializer}) {\n  if (kind === 'class') {\n    classes.add(value);\n  }\n}\n\n@collect\nclass A {}\n@collect\nclass B {}\n@collect\nclass C {}\n\nassert.deepEqual(\n  classes, new Set([A, B, C])\n);\n")),(0,l.kt)("h3",{id:"\u901a\u8fc7\u5de5\u5382\u51fd\u6570\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e"},"\u901a\u8fc7\u5de5\u5382\u51fd\u6570\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function createClassCollector() {\n  const classes = new Set();\n  function collect(value, {kind, addInitializer}) {\n    if (kind === 'class') {\n      classes.add(value);\n    }\n  }\n  return {\n    classes,\n    collect,\n  };\n}\n\nconst {classes, collect} = createClassCollector();\n\n@collect\nclass A {}\n@collect\nclass B {}\n@collect\nclass C {}\n\nassert.deepEqual(\n  classes, new Set([A, B, C])\n);\n")),(0,l.kt)("h3",{id:"\u901a\u8fc7\u7c7b\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e"},"\u901a\u8fc7\u7c7b\u7ba1\u7406\u66b4\u9732\u7684\u6570\u636e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class ClassCollector {\n  classes = new Set();\n  install = (value, {kind}) => { // (A)\n    if (kind === 'class') {\n      this.classes.add(value); // (B)\n    }\n  };\n}\n\nconst collector = new ClassCollector();\n\n@collector.install\nclass A {}\n@collector.install\nclass B {}\n@collector.install\nclass C {}\n")),(0,l.kt)("h2",{id:"\u7c7b\u88c5\u9970\u5668"},"\u7c7b\u88c5\u9970\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type ClassDecorator = (\n  value: Function,\n  context: {\n    kind: 'class';\n    name: string | undefined;\n    addInitializer(initializer: () => void): void;\n  }\n) => Function | void;\n")),(0,l.kt)("p",null,"\u7c7b\u88c5\u9970\u5668\u7684\u80fd\u529b:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6539\u53d8\u88c5\u9970\u7c7b\u7684\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u8fd4\u56de\u53ef\u8c03\u7528\u7684\u503c\u6765\u66ff\u6362\u88c5\u9970\u7c7b"),(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u518c\u521d\u59cb\u5316\u5668, \u5728\u88c5\u9970\u7c7b\u5b8c\u5168\u8bbe\u7f6e\u540e\u8c03\u7528"),(0,l.kt)("li",{parentName:"ul"},"\u5f97\u4e0d\u5230context.access, \u56e0\u4e3a\u7d2f\u4e0d\u662f\u5176\u4ed6\u8bed\u8a00\u7ed3\u6784\u7684\u6210\u5458(\u4f8b\u5982: \u65b9\u6cd5\u662f\u7c7b\u7684\u6210\u5458)")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u6536\u96c6\u5b9e\u4f8b"},"\u4f8b\u5b50: \u6536\u96c6\u5b9e\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class InstanceCollector {\n  instances = new Set();\n  install = (value, {kind}) => {\n    if (kind === 'class') {\n      const _this = this;\n      return function (...args) { // (A)\n        const inst = new value(...args); // (B)\n        _this.instances.add(inst);\n        return inst;\n      };\n    }\n  };\n}\n\nconst collector = new InstanceCollector();\n\n@collector.install\nclass MyClass {}\n\nconst inst1 = new MyClass();\nconst inst2 = new MyClass();\nconst inst3 = new MyClass();\n\nassert.deepEqual(\n  collector.instances, new Set([inst1, inst2, inst3])\n);\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u88c5\u9970\u5668\u6536\u96c6\u7ed9\u5b9a\u7c7b\u7684\u6240\u6709\u5b9e\u4f8b."),(0,l.kt)("p",null,"\u6ce8\u610f: \u6211\u4eec\u4e0d\u80fd\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"A"),"\u884c\u8fd4\u56de\u7bad\u5934\u51fd\u6570, \u56e0\u4e3a\u7bad\u5934\u51fd\u6570\u4e0d\u80fd\u88ab\u65b0\u8c03\u7528. "),(0,l.kt)("p",null,"\u8fd9\u4e2a\u4f8b\u5b50\u7684\u7f3a\u70b9\u5728\u4e8e\u5b83\u7834\u574f\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"instanceof")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"assert.equal(\n  inst1 instanceof MyClass,\n  false\n);\n")),(0,l.kt)("p",null,"\u6211\u4eec\u6709\u4e00\u4e9b\u65b9\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898:"),(0,l.kt)("h4",{id:"1-\u7528prototype\u624b\u52a8\u8bbe\u7f6einstanceof"},"1. \u7528",(0,l.kt)("inlineCode",{parentName:"h4"},".prototype"),"\u624b\u52a8\u8bbe\u7f6e",(0,l.kt)("inlineCode",{parentName:"h4"},"instanceof"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function countInstances(value) {\n  const _this = this;\n  let instanceCount = 0;\n  // The wrapper must be new-callable\n  const wrapper = function (...args) {\n    instanceCount++;\n    const instance = new value(...args);\n    // Change the instance\n    instance.count = instanceCount;\n    return instance;\n  };\n  wrapper.prototype = value.prototype; // (A)\n  return wrapper;\n}\n\n@countInstances\nclass MyClass {}\n\nconst inst1 = new MyClass();\nassert.ok(inst1 instanceof MyClass);\nassert.equal(inst1.count, 1);\n\nconst inst2 = new MyClass();\nassert.ok(inst2 instanceof MyClass);\nassert.equal(inst2.count, 2);\n")),(0,l.kt)("p",null,"\u56e0\u4e3a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"inst instanceof C\nC.prototype.isPrototypeOf(inst) // \u7b49\u4ef7\u4e8e\n")),(0,l.kt)("p",null,"\u8fd9\u4e24\u8005\u662f\u7b49\u4ef7\u7684"),(0,l.kt)("h4",{id:"2-\u7528symbolhasinstance"},"2. \u7528",(0,l.kt)("inlineCode",{parentName:"h4"},"Symbol.hasInstance")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function countInstances(value) {\n  const _this = this;\n  let instanceCount = 0;\n  // The wrapper must be new-callable\n  const wrapper = function (...args) {\n    instanceCount++;\n    const instance = new value(...args);\n    // Change the instance\n    instance.count = instanceCount;\n    return instance;\n  };\n  // Property is ready-only, so we can\u2019t use assignment\n  Object.defineProperty( // (A)\n    wrapper, Symbol.hasInstance,\n    {\n      value: function (x) {\n        return x instanceof value; \n      }\n    }\n  );\n  return wrapper;\n}\n\n@countInstances\nclass MyClass {}\n\nconst inst1 = new MyClass();\nassert.ok(inst1 instanceof MyClass);\nassert.equal(inst1.count, 1);\n\nconst inst2 = new MyClass();\nassert.ok(inst2 instanceof MyClass);\nassert.equal(inst2.count, 2);\n")),(0,l.kt)("h4",{id:"3-\u901a\u8fc7\u5b50\u7c7b\u542f\u7528instanceof"},"3. \u901a\u8fc7\u5b50\u7c7b\u542f\u7528",(0,l.kt)("inlineCode",{parentName:"h4"},"instanceof")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function countInstances(value) {\n  const _this = this;\n  let instanceCount = 0;\n  // The wrapper must be new-callable\n  return class extends value { // (A)\n    constructor(...args) {\n      super(...args);\n      instanceCount++;\n      // Change the instance\n      this.count = instanceCount;\n    }\n  };\n}\n\n@countInstances\nclass MyClass {}\n\nconst inst1 = new MyClass();\nassert.ok(inst1 instanceof MyClass);\nassert.equal(inst1.count, 1);\n\nconst inst2 = new MyClass();\nassert.ok(inst2 instanceof MyClass);\nassert.equal(inst2.count, 2);\n")),(0,l.kt)("h2",{id:"\u7c7b\u65b9\u6cd5\u88c5\u9970\u5668"},"\u7c7b\u65b9\u6cd5\u88c5\u9970\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type ClassMethodDecorator = (\n  value: Function,\n  context: {\n    kind: 'method';\n    name: string | symbol;\n    static: boolean;\n    private: boolean;\n    access: { get: () => unknown };\n    addInitializer(initializer: () => void): void;\n  }\n) => Function | void;\n")),(0,l.kt)("p",null,"\u65b9\u6cd5\u88c5\u9970\u5668:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7\u6539\u53d8\u88c5\u9970\u7684\u65b9\u6cd5"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\u6765\u66ff\u6362\u88c5\u9970\u65b9\u6cd5"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u6ce8\u518c\u521d\u59cb\u503c\u8bbe\u5b9a\u9879"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"context.access"),"\u53ea\u80fd\u83b7\u53d6\u5c5e\u6027\u7684\u503c, \u4e0d\u652f\u6301\u8bbe\u7f6e")),(0,l.kt)("p",null,"\u6784\u9020\u51fd\u6570\u4e0d\u80fd\u88ab\u88c5\u9970, \u4ed6\u4eec\u53ea\u662f\u770b\u8d77\u6765\u50cf\u65b9\u6cd5, \u4f46\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u65b9\u6cd5"),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u8ddf\u8e2a\u65b9\u6cd5\u8c03\u7528"},"\u4f8b\u5b50: \u8ddf\u8e2a\u65b9\u6cd5\u8c03\u7528"),(0,l.kt)("p",null,"\u88c5\u9970\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"@trace"),"\u53ef\u4ee5\u7528\u6765\u8ddf\u8e2a\u65b9\u6cd5\u7684\u8c03\u7528\u548c\u7ed3\u679c\u8bb0\u5f55:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function trace(value, {kind, name}) {\n  if (kind === 'method') {\n    return function (...args) {\n      console.log(`CALL ${name}: ${JSON.stringify(args)}`);\n      const result = value.apply(this, args);\n      console.log('=> ' + JSON.stringify(result));\n      return result;\n    };\n  }\n}\n\nclass StringBuilder {\n  #str = '';\n  @trace\n  add(str) {\n    this.#str += str;\n  }\n  @trace\n  toString() {\n    return this.#str;\n  }\n}\n\nconst sb = new StringBuilder();\nsb.add('Home');\nsb.add('page');\nassert.equal(\n  sb.toString(), 'Homepage'\n);\n\n// Output:\n// CALL add: [\"Home\"]\n// => undefined\n// CALL add: [\"page\"]\n// => undefined\n// CALL toString: []\n// => \"Homepage\"\n")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u5c06\u65b9\u6cd5\u7ed1\u5b9a\u5230\u5b9e\u4f8b"},"\u4f8b\u5b50: \u5c06\u65b9\u6cd5\u7ed1\u5b9a\u5230\u5b9e\u4f8b"),(0,l.kt)("p",null,"\u901a\u5e38\u6211\u4eec\u63d0\u53d6\u65b9\u6cd5\u540e, this\u7684\u7ed1\u5b9a\u4f1a\u4e22\u5931, \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u88c5\u9970\u5668\u6765\u5f3a\u7ed1\u5b9a:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function bind(value, {kind, name, addInitializer}) {\n  if (kind === 'method') {\n    addInitializer(function () { // (B)\n      this[name] = value.bind(this); // (C)\n    });\n  }\n}\n\nclass Color2 {\n  #name;\n  constructor(name) {\n    this.#name = name;\n  }\n  @bind\n  toString() {\n    return `Color(${this.#name})`;\n  }\n}\n\nconst green2 = new Color2('green');\nconst toString2 = green2.toString;\nassert.equal(\n  toString2(), 'Color(green)'\n);\n\n// The own property green2.toString is different\n// from Color2.prototype.toString\nassert.ok(Object.hasOwn(green2, 'toString'));\nassert.notEqual(\n  green2.toString,\n  Color2.prototype.toString\n);\n")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u5c06\u51fd\u6570\u5e94\u7528\u4e8e\u65b9\u6cd5"},"\u4f8b\u5b50: \u5c06\u51fd\u6570\u5e94\u7528\u4e8e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { memoize } from 'lodash-es';\n\nfunction applyFunction(functionFactory) {\n  return (value, {kind}) => { // decorator function\n    if (kind === 'method') {\n      return functionFactory(value);\n    }\n  };\n}\n\nlet invocationCount = 0;\n\nclass Task {\n  @applyFunction(memoize)\n  expensiveOperation(str) {\n    invocationCount++;\n    // Expensive processing of `str` \ud83d\ude00\n    return str + str;\n  }\n}\n\nconst task = new Task();\nassert.equal(\n  task.expensiveOperation('abc'),\n  'abcabc'\n);\nassert.equal(\n  task.expensiveOperation('abc'),\n  'abcabc'\n);\nassert.equal(\n  invocationCount, 1\n);\n")),(0,l.kt)("h2",{id:"\u7c7b\u7684getter\u88c5\u9970\u5668setter\u88c5\u9970\u5668"},"\u7c7b\u7684getter\u88c5\u9970\u5668/setter\u88c5\u9970\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type ClassGetterDecorator = (\n  value: Function,\n  context: {\n    kind: 'getter';\n    name: string | symbol;\n    static: boolean;\n    private: boolean;\n    access: { get: () => unknown };\n    addInitializer(initializer: () => void): void;\n  }\n) => Function | void;\n\ntype ClassSetterDecorator = (\n  value: Function,\n  context: {\n    kind: 'setter';\n    name: string | symbol;\n    static: boolean;\n    private: boolean;\n    access: { set: (value: unknown) => void };\n    addInitializer(initializer: () => void): void;\n  }\n) => Function | void;\n")),(0,l.kt)("p",null,"getter\u548csetter\u88c5\u9970\u5668\u548c\u65b9\u6cd5\u88c5\u9970\u5668\u7684\u80fd\u529b\u662f\u7c7b\u4f3c\u7684."),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u5ef6\u8fdf\u8ba1\u7b97\u503c"},"\u4f8b\u5b50: \u5ef6\u8fdf\u8ba1\u7b97\u503c"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u4e00\u4e2a\u5ef6\u8fdf\u8ba1\u7b97\u503c\u7684\u5c5e\u6027, \u6211\u4eec\u901a\u8fc7:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7getter\u5b9e\u73b0\u8be5\u5c5e\u6027, \u8fd9\u6837\u8ba1\u7b97\u503c\u7684\u4ee3\u7801\u4f1a\u5728\u8bfb\u53d6\u5c5e\u6027\u7684\u65f6\u5019\u6267\u884c"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u88c5\u9970\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"@lazy"),"\u5305\u88c5\u539f\u59cb\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"getter"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class C {\n  @lazy\n  get value() {\n    console.log('COMPUTING');\n    return 'Result of computation';\n  }\n}\n\nfunction lazy(value, {kind, name, addInitializer}) {\n  if (kind === 'getter') {\n    return function () {\n      const result = value.call(this);\n      Object.defineProperty( // (A)\n        this, name,\n        {\n          value: result,\n          writable: false,\n        }\n      );\n      return result;\n    };\n  }\n}\n")),(0,l.kt)("h2",{id:"\u7c7b\u5b57\u6bb5\u88c5\u9970\u5668"},"\u7c7b\u5b57\u6bb5\u88c5\u9970\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type ClassFieldDecorator = (\n  value: undefined,\n  context: {\n    kind: 'field';\n    name: string | symbol;\n    static: boolean;\n    private: boolean;\n    access: { get: () => unknown, set: (value: unknown) => void };\n    addInitializer(initializer: () => void): void;\n  }\n) => (initialValue: unknown) => unknown | void;\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5b83\u4e0d\u80fd\u66f4\u6539\u6216\u8005\u66ff\u6362\u5b57\u6bb5(\u9700\u8981\u81ea\u52a8\u8bbf\u95ee\u5668\u6765\u5b9e\u73b0)"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56de\u539f\u59cb\u7684\u521d\u59cb\u5316\u503c\u5175\u8fd4\u56de\u65b0\u7684\u521d\u59cb\u5316\u503c\u7684\u51fd\u6570\u6765\u66f4\u6539\u521d\u59cb\u5316\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u6ce8\u518c\u521d\u59cb\u8bbe\u5b9a\u9879"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7\u516c\u5f00\u5176\u5b57\u6bb5\u7684\u8bbf\u95ee(\u5373\u4fbf\u5b83\u662f\u79c1\u6709\u7684) context.access")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u66f4\u6539\u5b57\u6bb5\u7684\u521d\u59cb\u5316\u503c"},"\u4f8b\u5b50: \u66f4\u6539\u5b57\u6bb5\u7684\u521d\u59cb\u5316\u503c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function twice() {\n  return initialValue => initialValue * 2;\n}\n\nclass C {\n  @twice\n  field = 3;\n}\n\nconst inst = new C();\nassert.equal(\n  inst.field, 6\n);\n")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u53ea\u8bfb\u5b57\u6bb5"},"\u4f8b\u5b50: \u53ea\u8bfb\u5b57\u6bb5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const readOnlyFieldKeys = Symbol('readOnlyFieldKeys');\n\n@readOnly\nclass Color {\n  @readOnly\n  name;\n  constructor(name) {\n    this.name = name;\n  }\n}\n\nconst blue = new Color('blue');\nassert.equal(blue.name, 'blue');\nassert.throws(\n  () => blue.name = 'brown',\n  /^TypeError: Cannot assign to read only property 'name'/\n);\n\nfunction readOnly(value, {kind, name}) {\n  if (kind === 'field') { // (A)\n    return function () {\n      if (!this[readOnlyFieldKeys]) {\n        this[readOnlyFieldKeys] = [];\n      }\n      this[readOnlyFieldKeys].push(name);\n    };\n  }\n  if (kind === 'class') { // (B)\n    return function (...args) {\n      const inst = new value(...args);\n      for (const key of inst[readOnlyFieldKeys]) {\n        Object.defineProperty(inst, key, {writable: false});\n      }\n      return inst;\n    }\n  }\n}\n")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u9996\u5148\u6536\u96c6\u53ea\u8bfb\u5b57\u6bb5\u7684\u6240\u6709\u952e(A)"),(0,l.kt)("li",{parentName:"ol"},"\u7b49\u5b9e\u4f8b\u5b8c\u5168\u8bbe\u7f6e\u5b8c\u6210, \u5e76\u4f7f\u6211\u4eec\u6536\u96c6\u9f50\u5bc6\u94a5\u7684\u5b57\u6bb5\u4e0d\u53ef\u5199(B)")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u4f9d\u8d56\u6ce8\u5165-\u5b9e\u4f8b\u516c\u5171\u5b57\u6bb5"},"\u4f8b\u5b50: \u4f9d\u8d56\u6ce8\u5165, \u5b9e\u4f8b\u516c\u5171\u5b57\u6bb5."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const {registry, inject} = createRegistry();\n\nclass Logger {\n  log(str) {\n    console.log(str);\n  }\n}\nclass Main {\n  @inject logger;\n  run() {\n    this.logger.log('Hello!');\n  }\n}\n\nregistry.register('logger', Logger);\nnew Main().run();\n\n// Output:\n// Hello!\n")),(0,l.kt)("p",null,"\u5176\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"createRegistry"),"\u5b9e\u73b0\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function createRegistry() {\n  const nameToClass = new Map();\n  const nameToInstance = new Map();\n  const registry = {\n    register(name, componentClass) {\n      nameToClass.set(name, componentClass);\n    },\n    getInstance(name) {\n      if (nameToInstance.has(name)) {\n        return nameToInstance.get(name);\n      }\n      const componentClass = nameToClass.get(name);\n      if (componentClass === undefined) {\n        throw new Error('Unknown component name: ' + name);\n      }\n      const inst = new componentClass();\n      nameToInstance.set(name, inst);\n      return inst;\n    },\n  }; \n  function inject (_value, {kind, name}) {\n    if (kind === 'field') {\n      return () => registry.getInstance(name);\n    }\n  }\n  return {registry, inject};\n}\n")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u670b\u53cb\u53ef\u89c1\u6027"},'\u4f8b\u5b50: "\u670b\u53cb"\u53ef\u89c1\u6027'),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u7c7b\u7684\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u79c1\u6709\u6765\u66f4\u6539\u67d0\u4e9b\u7c7b\u6210\u5458\u7684\u53ef\u89c1\u6027. \u4ee5\u9632\u5b83\u4eec\u88ab\u516c\u5f00\u8bbf\u95ee."),(0,l.kt)("p",null,'\u670b\u53cb\u53ef\u89c1\u6027\u6307\u7684\u662f\u5141\u8bb8\u4e00\u4e9b"\u670b\u53cb"\u6765\u8bbf\u95ee\u4e00\u4e9b\u79c1\u6709\u6210\u5458\u7c7b\u578b.'),(0,l.kt)("p",null,"\u6bd4\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const friendName = new Friend();\n\nclass ClassWithSecret {\n  @friendName.install #name = 'Rumpelstiltskin';\n  getName() {\n    return this.#name;\n  }\n}\n\n// Everyone who has access to `secret`, can access inst.#name\nconst inst = new ClassWithSecret();\nassert.equal(\n  friendName.get(inst), 'Rumpelstiltskin'\n);\nfriendName.set(inst, 'Joe');\nassert.equal(\n  inst.getName(), 'Joe'\n);\n")),(0,l.kt)("p",null,"\u5176\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"Friend"),"\u7684\u5b9e\u73b0\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class Friend {\n  #access = undefined;\n  #getAccessOrThrow() {\n    if (this.#access === undefined) {\n      throw new Error('The friend decorator wasn\u2019t used yet');\n    }\n    return this.#access;\n  }\n  // An instance property whose value is a function whose `this`\n  // is fixed (bound to the instance).\n  install = (_value, {kind, access}) => {\n    if (kind === 'field') {\n      if (this.#access) {\n        throw new Error('This decorator can only be used once');\n      }\n      this.#access = access;\n    }\n  }\n  get(inst) {\n    return this.#getAccessOrThrow().get.call(inst);\n  }\n  set(inst, value) {\n    return this.#getAccessOrThrow().set.call(inst, value);\n  }\n}\n")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u679a\u4e3e"},"\u4f8b\u5b50: \u679a\u4e3e"),(0,l.kt)("p",null,"\u6709\u5f88\u591a\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u679a\u4e3e, OOP\u98ce\u683c\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u7c7b\u548c\u9759\u6001\u5c5e\u6027:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class Color {\n  static red = new Color('red');\n  static green = new Color('green');\n  static blue = new Color('blue');\n  constructor(enumKey) {\n    this.enumKey = enumKey;\n  }\n  toString() {\n    return `Color(${this.enumKey})`;\n  }\n}\nassert.equal(\n  Color.green.toString(),\n  'Color(green)'\n);\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u88c5\u9970\u5668\u6765\u81ea\u52a8\u7684:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4ece\u679a\u4e3e\u952e\u521b\u5efa\u4e00\u4e2a\u6620\u5c04\u5230\u679a\u4e3e\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u5c06\u679a\u4e3e\u952e\u6dfb\u52a0\u5230\u679a\u4e3e\u503c--\u65e0\u9700\u5c06\u5b83\u4eec\u4f20\u9012\u7ed9\u6784\u9020\u51fd\u6570")),(0,l.kt)("p",null,"\u7c7b\u4f3c\u8fd9\u6837:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"function enumEntry(value, {kind, name}) {\n  if (kind === 'field') {\n    return function (initialValue) {\n      if (!Object.hasOwn(this, 'enumFields')) {\n        this.enumFields = new Map();\n      }\n      this.enumFields.set(name, initialValue);\n      initialValue.enumKey = name;\n      return initialValue;\n    };\n  }\n}\n\nclass Color {\n  @enumEntry static red = new Color();\n  @enumEntry static green = new Color();\n  @enumEntry static blue = new Color();\n  toString() {\n    return `Color(${this.enumKey})`;\n  }\n}\nassert.equal(\n  Color.green.toString(),\n  'Color(green)'\n);\nassert.deepEqual(\n  Color.enumFields,\n  new Map([\n    ['red', Color.red],\n    ['green', Color.green],\n    ['blue', Color.blue],\n  ])\n);\n")),(0,l.kt)("h2",{id:"\u81ea\u52a8\u8bbf\u95ee\u5668"},"\u81ea\u52a8\u8bbf\u95ee\u5668"),(0,l.kt)("p",null,"\u88c5\u9970\u5668\u63d0\u6848\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8bed\u8a00\u7279\u6027: \u81ea\u52a8\u8bbf\u95ee\u5668"),(0,l.kt)("p",null,"\u901a\u8fc7\u5c06\u5173\u952e\u8bcd\u653e\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"accessor"),"\u7c7b\u5b57\u6bb5\u4e4b\u524d\u6765\u521b\u5efa\u81ea\u52a8\u8bbf\u95ee\u5668. \u5b83\u60f3\u5b57\u6bb5\u4e00\u6837\u4f7f\u7528, \u4f46\u662f\u8fd0\u884c\u65f6\u6709\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class C {\n  static accessor myField1;\n  static accessor #myField2;\n  accessor myField3;\n  accessor #myField4;\n}\n")),(0,l.kt)("p",null,"\u5b57\u6bb5\u548c\u81ea\u52a8\u8bbf\u95ee\u5668\u6709\u4ec0\u4e48\u4e0d\u540c?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u5b57\u6bb5\u521b\u5efa:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5c5e\u6027"),(0,l.kt)("li",{parentName:"ul"},"\u4e13\u7528\u63d2\u69fd"))),(0,l.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u8bbf\u95ee\u5668\u4e3a\u6570\u636e\u521b\u5efa\u4e00\u4e2a\u79c1\u6709\u69fd, \u5e76\u4e14:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u516c\u5171",(0,l.kt)("inlineCode",{parentName:"li"},"getter-setter"),"\u5bf9"),(0,l.kt)("li",{parentName:"ul"},"\u79c1\u6709",(0,l.kt)("inlineCode",{parentName:"li"},"getter-setter"),"\u5bf9: \u79c1\u6709\u63d2\u69fd\u4e0d\u4f1a\u88ab\u7ee7\u627f, \u6240\u4ee5\u6c38\u8fdc\u4e0d\u4f1a\u4f4d\u4e8e\u539f\u578b\u4e2d.")))),(0,l.kt)("p",null,"\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u7c7b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class C {\n  accessor str = 'abc';\n}\nconst inst = new C();\n\nassert.equal(\n  inst.str, 'abc'\n);\ninst.str = 'def';\nassert.equal(\n  inst.str, 'def'\n);\n")),(0,l.kt)("p",null,"\u5b83\u5728\u5185\u90e8\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class C {\n  #str = 'abc';\n  get str() {\n    return this.#str;\n  }\n  set str(value) {\n    this.#str = value;\n  }\n}\n")),(0,l.kt)("h3",{id:"\u4e3a\u4ec0\u4e48\u9700\u8981"},"\u4e3a\u4ec0\u4e48\u9700\u8981"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4ed6\u4eec\u53ea\u5f71\u54cd\u521d\u59cb\u5316\u7684\u503c\u5b57\u6bb5"),(0,l.kt)("li",{parentName:"ol"},"\u4ed6\u4eec\u53ef\u4ee5\u5b8c\u5168\u53d6\u4ee3\u81ea\u52a8\u5b58\u53d6\u5668")),(0,l.kt)("p",null,"\u6bcf\u5f53\u88c5\u9970\u5668\u9700\u8981\u6bd4\u5b57\u6bb5\u66f4\u591a\u7684\u63a7\u5236\u80fd\u529b\u65f6, \u6211\u4eec\u5c31\u5fc5\u987b\u4f7f\u7528\u81ea\u52a8\u8bbf\u95ee\u5668, \u800c\u4e0d\u662f\u5b57\u6bb5"),(0,l.kt)("h2",{id:"\u7c7b\u81ea\u52a8\u8bbf\u95ee\u88c5\u9970\u5668"},"\u7c7b\u81ea\u52a8\u8bbf\u95ee\u88c5\u9970\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"type ClassAutoAccessorDecorator = (\n  value: {\n    get: () => unknown;\n    set: (value: unknown) => void;\n  },\n  context: {\n    kind: 'accessor';\n    name: string | symbol;\n    static: boolean;\n    private: boolean;\n    access: { get: () => unknown, set: (value: unknown) => void };\n    addInitializer(initializer: () => void): void;\n  }\n) => {\n  get?: () => unknown;\n  set?: (value: unknown) => void;\n  init?: (initialValue: unknown) => unknown;\n} | void;\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5b83\u80fd\u901a\u8fc7\u6c14\u53c2\u6570\u63a5\u53d7\u81ea\u52a8\u8bbf\u95ee\u5668\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"getter"),"\u548c",(0,l.kt)("inlineCode",{parentName:"li"},"setter")),(0,l.kt)("li",{parentName:"ul"},"\u5b83\u53ef\u4ee5\u901a\u8fc7\u53d1\u6325\u5e26\u6709\u65b9\u6cd5",(0,l.kt)("inlineCode",{parentName:"li"},".get()"),"\u6765\u66ff\u6362\u4fee\u9970\u7684\u81ea\u52a8\u8bbf\u95ee\u5668",(0,l.kt)("inlineCode",{parentName:"li"},".set()")),(0,l.kt)("li",{parentName:"ul"},"\u5b83\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u6765\u5f71\u54cd\u81ea\u52a8\u8bbf\u95ee\u5668\u7684\u521d\u59cb\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u5b83\u53ef\u4ee5\u6ce8\u518c\u521d\u59cb\u503c\u8bbe\u5b9a\u9879.")),(0,l.kt)("h3",{id:"\u4f8b\u5b50-\u53ea\u8bfb\u81ea\u52a8\u8bbf\u95ee\u5668"},"\u4f8b\u5b50: \u53ea\u8bfb\u81ea\u52a8\u8bbf\u95ee\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"const UNINITIALIZED = Symbol('UNINITIALIZED');\nfunction readOnly({get,set}, {name, kind}) {\n  if (kind === 'accessor') {\n    return {\n      init() {\n        return UNINITIALIZED;\n      },\n      get() {\n        const value = get.call(this);\n        if (value === UNINITIALIZED) {\n          throw new TypeError(\n            `Accessor ${name} hasn\u2019t been initialized yet`\n          );\n        }\n        return value;\n      },\n      set(newValue) {\n        const oldValue = get.call(this);\n        if (oldValue !== UNINITIALIZED) {\n          throw new TypeError(\n            `Accessor ${name} can only be set once`\n          );\n        }\n        set.call(this, newValue);\n      },\n    };\n  }\n}\n\nclass Color {\n  @readOnly\n  accessor name;\n  constructor(name) {\n    this.name = name;\n  }\n}\n\nconst blue = new Color('blue');\nassert.equal(blue.name, 'blue');\nassert.throws(\n  () => blue.name = 'yellow',\n  /^TypeError: Accessor name can only be set once$/\n);\n\nconst orange = new Color('orange');\nassert.equal(orange.name, 'orange');\n")),(0,l.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://2ality.com/2022/10/javascript-decorators.html"},"JavaScript metaprogramming with the 2022-03 decorators API"))))}p.isMDXComponent=!0}}]);