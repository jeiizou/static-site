"use strict";(self.webpackChunk_jeiiz_wiki_site=self.webpackChunk_jeiiz_wiki_site||[]).push([[2803],{50158:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>d});var r=t(46393);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=r.createContext({}),u=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=u(t),d=l,k=m["".concat(s,".").concat(d)]||m[d]||c[d]||o;return t?r.createElement(k,a(a({ref:n},p),{},{components:t})):r.createElement(k,a({ref:n},p))}));function d(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var o=t.length,a=new Array(o);a[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,a[1]=i;for(var u=2;u<o;u++)a[u]=t[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},39704:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var r=t(39421),l=(t(46393),t(50158));const o={},a="\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b",i={unversionedId:"\u524d\u7aef\u57fa\u7840/JavsScript/\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b",id:"\u524d\u7aef\u57fa\u7840/JavsScript/\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b",title:"\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b",description:"Ajax",source:"@site/docs/01-\u524d\u7aef\u57fa\u7840/01-JavsScript/04-\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b.md",sourceDirName:"01-\u524d\u7aef\u57fa\u7840/01-JavsScript",slug:"/\u524d\u7aef\u57fa\u7840/JavsScript/\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b",permalink:"/docs/\u524d\u7aef\u57fa\u7840/JavsScript/\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u539f\u7406-\u5bf9\u8c61,\u539f\u578b\u4e0e\u7ee7\u627f",permalink:"/docs/\u524d\u7aef\u57fa\u7840/JavsScript/\u539f\u7406-\u5bf9\u8c61,\u539f\u578b\u4e0e\u7ee7\u627f"},next:{title:"\u8bed\u6cd5\u7279\u6027-Proxy",permalink:"/docs/\u524d\u7aef\u57fa\u7840/JavsScript/\u8bed\u6cd5\u7279\u6027-Proxy"}},s={},u=[{value:"Ajax",id:"ajax",level:2},{value:"Promise",id:"promise",level:2},{value:"Promise \u6392\u7a0b",id:"promise-\u6392\u7a0b",level:3},{value:"Promise \u6a21\u5f0f",id:"promise-\u6a21\u5f0f",level:3},{value:"\u5e76\u53d1\u8fed\u4ee3",id:"\u5e76\u53d1\u8fed\u4ee3",level:3},{value:"\u5e76\u53d1\u9650\u5236",id:"\u5e76\u53d1\u9650\u5236",level:3},{value:"Generator",id:"generator",level:2},{value:"\u591a\u8fed\u4ee3\u5668",id:"\u591a\u8fed\u4ee3\u5668",level:3},{value:"\u5f02\u6b65\u8fed\u4ee3 Generator",id:"\u5f02\u6b65\u8fed\u4ee3-generator",level:3},{value:"Generator + Promise",id:"generator--promise",level:3},{value:"\u5e26\u6709 Promise \u7684 Generator \u8fd0\u884c\u671f",id:"\u5e26\u6709-promise-\u7684-generator-\u8fd0\u884c\u671f",level:3},{value:"Generator \u4e2d\u7684 Promise \u5e76\u53d1",id:"generator-\u4e2d\u7684-promise-\u5e76\u53d1",level:3},{value:"Generator \u59d4\u6258",id:"generator-\u59d4\u6258",level:2},{value:"Generator \u53cc\u5411\u6d88\u606f\u4f20\u9012",id:"generator-\u53cc\u5411\u6d88\u606f\u4f20\u9012",level:3},{value:"\u5f02\u6b65\u59d4\u6258",id:"\u5f02\u6b65\u59d4\u6258",level:3},{value:"\u9012\u5f52\u59d4\u6258",id:"\u9012\u5f52\u59d4\u6258",level:3},{value:"Generator \u5e76\u53d1",id:"generator-\u5e76\u53d1",level:3},{value:"Async/Await",id:"asyncawait",level:2},{value:"\u5e94\u7528",id:"\u5e94\u7528",level:2},{value:"1. \u5b9e\u73b0\u4e00\u4e2a sleep \u51fd\u6570",id:"1-\u5b9e\u73b0\u4e00\u4e2a-sleep-\u51fd\u6570",level:3},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2},{value:"\u5b9e\u73b0\u4e00\u4e2a Promise",id:"\u5b9e\u73b0\u4e00\u4e2a-promise",level:3},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],p={toc:u};function c(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b"},"\u539f\u7406-\u5f02\u6b65\u6d41\u7a0b"),(0,l.kt)("h2",{id:"ajax"},"Ajax"),(0,l.kt)("p",null,"\u6700\u65e9\u5f02\u6b65\u7684\u6982\u5ff5\u662f\u968f\u7740 ajax \u7684\u53d1\u5c55\u800c\u4ea7\u751f\u7684, \u5373\u90a3\u4e9b\u7a0d\u540e\u6267\u884c\u7684\u4ee3\u7801\u5757. \u6700\u4e3a\u7b80\u5355\u7684\u5c31\u662f\u4f7f\u7528 js \u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"setTimeOut"),"\u51fd\u6570\u6765\u5b9a\u4e49\u4e00\u4e2a\u67d0\u4e2a\u4e2a\u56fa\u5b9a\u65f6\u95f4\u4ee5\u540e\u7684\u4ee3\u7801. \u5f53\u8fd9\u6bb5\u4ee3\u7801\u63a8\u8fdf\u7684\u65f6\u95f4\u4e0d\u786e\u5b9a\u7684\u65f6\u5019, setTimeOut \u5c31\u53d8\u5f97\u4e0d\u9002\u7528\u4e86. \u6240\u4ee5\u51fa\u73b0\u4e86 ajax."),(0,l.kt)("p",null,"\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"ajax()"),"\u51fd\u6570, \u5176\u4e2d\u53ef\u4ee5\u518d\u7a0d\u540e\u6267\u884c\u4e00\u4e9b\u4ee3\u7801. \u50cf\u8fd9\u6837:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// ajax(..) \u662f\u67d0\u4e2a\u5305\u4e2d\u4efb\u610f\u7684Ajax\u51fd\u6570\najax('http://some.url.1', function myCallbackFunction(data) {\n    console.log(data); // Yay, \u6211\u5f97\u5230\u4e86\u4e00\u4e9b`data`!\n});\n")),(0,l.kt)("p",null,"\u5f02\u6b65\u5728\u6d41\u7a0b\u4e0a\u6bd4\u540c\u6b65\u8981\u601d\u8003\u66f4\u591a\u7684\u4e1c\u897f, \u6bd4\u5982\u5e76\u53d1, \u4e92\u52a8, \u534f\u4f5c\u7b49."),(0,l.kt)("p",null,"\u5e76\u53d1\u7684 ajax:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var res = {};\n\nfunction foo(results) {\n    res.foo = results;\n}\n\nfunction bar(results) {\n    res.bar = results;\n}\n\n// ajax(..) \u662f\u67d0\u4e2a\u5305\u4e2d\u4efb\u610f\u7684Ajax\u51fd\u6570\najax('http://some.url.1', foo);\najax('http://some.url.2', bar);\n")),(0,l.kt)("p",null,"\u4e92\u52a8\u7684\u5e76\u53d1:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var a, b;\n\nfunction foo(x) {\n    a = x * 2;\n    if (a && b) {\n        baz();\n    }\n}\n\nfunction bar(y) {\n    b = y * 2;\n    if (a && b) {\n        baz();\n    }\n}\n\nfunction baz() {\n    console.log(a + b);\n}\n\n// ajax(..) \u662f\u67d0\u4e2a\u5305\u4e2d\u4efb\u610f\u7684Ajax\u51fd\u6570\najax('http://some.url.1', foo);\najax('http://some.url.2', bar);\n")),(0,l.kt)("p",null,"\u5176\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"baz()"),"\u8c03\u7528\u5468\u56f4\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"if"),'\u6761\u4ef6\u901a\u5e38\u79f0\u4e3a"\u5927\u95e8", \u4f46\u5728\u6253\u5f00\u5927\u95e8\u4e4b\u524d\u9700\u8981\u7b49\u5f85\u4ed6\u4eec\u5168\u90e8\u5230\u8fbe. \u53e6\u4e00\u79cd\u53ef\u80fd\u5e76\u53d1\u7684\u4e92\u52a8\u72b6\u6001\u6709\u65f6\u79f0\u4e3a"\u7ade\u4e89", \u4f46\u66f4\u51c6\u786e\u7684\u53eb\u505a"\u95e8\u95e9", \u7279\u70b9\u662f\u5148\u5230\u8005\u80dc.'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var a;\n\nfunction foo(x) {\n    if (a == undefined) {\n        a = x * 2;\n        baz();\n    }\n}\n\nfunction bar(x) {\n    if (a == undefined) {\n        a = x / 2;\n        baz();\n    }\n}\n\nfunction baz() {\n    console.log(a);\n}\n\n// ajax(..) \u662f\u67d0\u4e2a\u5305\u4e2d\u4efb\u610f\u7684Ajax\u51fd\u6570\najax('http://some.url.1', foo);\najax('http://some.url.2', bar);\n")),(0,l.kt)("p",null,"Ajax \u662f\u6700\u7ecf\u5178\u7684\u56de\u8c03\u5f0f\u7684\u5f02\u6b65\u89e3\u51b3\u65b9\u6848, \u4f46\u4e5f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898, \u6bd4\u5982\u56de\u8c03\u5730\u72f1\u7b49. \u4e00\u822c\u6765\u8bf4, \u56de\u8c03\u6709\u4e24\u79cd\u8bbe\u8ba1:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u63d0\u4f9b\u5206\u79bb\u7684\u56de\u8c03(\u4e00\u4e2a\u7528\u4f5c\u6210\u529f\u7684\u901a\u77e5, \u4e00\u4e2a\u7528\u4f5c\u9519\u8bef\u7684\u901a\u77e5), \u4f8b\u5982 jquery \u7684 ajax, ES6 \u7684 promise \u7b49"),(0,l.kt)("li",{parentName:"ol"},"\u9519\u8bef\u4f18\u5148\u98ce\u683c: \u4e00\u4e2a\u56de\u8c03\u4ee5\u4e00\u4e2a\u53c2\u6570\u4f5c\u4e3a\u9519\u8bef\u5bf9\u8c61\u4fdd\u7559, \u5982\u679c\u6210\u529f, \u8fd9\u4e2a\u5bf9\u8c61\u662f\u7a7a, \u5426\u5219\u5c06\u88ab\u8bbe\u7f6e\u4e3a truthy, \u5e76\u4e14\u901a\u5e38\u4e0d\u518d\u4f20\u9012\u5176\u4ed6\u7684\u4e1c\u897f.")),(0,l.kt)("h2",{id:"promise"},"Promise"),(0,l.kt)("p",null,"Promise \u662f ES6 \u7684\u65b0\u8bed\u6cd5, \u63d0\u4f9b\u4e86\u4e00\u79cd\u65b0\u7684\u5f02\u6b65\u5904\u7406\u65b9\u5f0f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const promise = new Promise(function(resolve, reject) {\n  // ... some code\n\n  if (/* \u5f02\u6b65\u64cd\u4f5c\u6210\u529f */){\n    resolve(value);\n  } else {\n    reject(error);\n  }\n});\n")),(0,l.kt)("p",null,"Promise \u7684\u672c\u610f\u662f\u627f\u8bfa, \u4e00\u822c\u6765\u8bf4:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e00\u65e6 Promsie \u88ab\u89e3\u6790, \u5b83\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u503c, \u5e76\u4e14\u53ef\u4ee5\u6839\u636e\u9700\u8981\u88ab\u76d1\u542c\u4efb\u610f\u591a\u6b21"),(0,l.kt)("li",{parentName:"ul"},"Promise \u4e00\u65e6\u88ab\u5b9a\u4e49\u5c31\u4f1a\u7acb\u5373\u6267\u884c\u4e14\u65e0\u6cd5\u505c\u6b62."),(0,l.kt)("li",{parentName:"ul"},"\u4efb\u4f55\u62e5\u6709",(0,l.kt)("inlineCode",{parentName:"li"},"then()"),"\u65b9\u6cd5\u7684\u5bf9\u8c61\u6216\u51fd\u6570\u90fd\u53ef\u4ee5\u7528\u9e2d\u5b50\u7c7b\u578b\u7684\u65b9\u6cd5\u6765\u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a promise."),(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u7ed9",(0,l.kt)("inlineCode",{parentName:"li"},"then()"),"\u7684\u4f1a\u8c03\u7528\u603b\u662f\u4f1a\u88ab\u5f02\u6b65\u7684\u8c03\u7528"),(0,l.kt)("li",{parentName:"ul"},"\u4e00\u65e6\u4e00\u4e2a Promise \u88ab\u89e3\u6790, \u6240\u6709\u5728",(0,l.kt)("inlineCode",{parentName:"li"},"then()"),"\u4e0a\u6ce8\u518c\u7684\u56de\u8c03\u90fd\u5c06\u88ab\u7acb\u5373\u7684, \u6309\u987a\u5e8f\u7684, \u5728\u4e0b\u4e00\u4e2a\u5f02\u6b65\u673a\u4f1a\u4f1a\u88ab\u8c03\u7528, \u800c\u4e14\u5e76\u6ca1\u6709\u4efb\u4f55\u5728\u8fd9\u4e9b\u56de\u8c03\u4e2d\u53d1\u751f\u7684\u4e8b\u53ef\u4ee5\u5f71\u54cd/\u63a8\u8fdf\u5176\u4ed6\u56de\u8c03\u7684\u56de\u8c03.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"p.then(function() {\n    p.then(function() {\n        console.log('C');\n    });\n    console.log('A');\n});\np.then(function() {\n    console.log('B');\n});\n// A B C\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u7684 C \u662f\u65e0\u6cd5\u5e72\u6270\u5e76\u4e14\u4f18\u5148\u4e8e B \u7684."),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"Promise.race"),"\u53ef\u4ee5\u7ed9",(0,l.kt)("inlineCode",{parentName:"p"},"Promise"),"\u8bbe\u5b9a\u8d85\u65f6\u68c0\u6d4b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u4e00\u4e2a\u68c0\u6d4bPromise\u8d85\u65f6\u7684\u5de5\u5177\nfunction timeoutPromise(delay) {\n    return new Promise(function(resolve, reject) {\n        setTimeout(function() {\n            reject('Timeout!');\n        }, delay);\n    });\n}\n\n// \u4e3a`foo()`\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\nPromise.race([\n    foo(), // \u5c1d\u8bd5\u8c03\u7528`foo()`\n    timeoutPromise(3000) // \u7ed9\u5b833\u79d2\u949f\n]).then(\n    function() {\n        // `foo(..)`\u53ca\u65f6\u5730\u5b8c\u6210\u4e86\uff01\n    },\n    function(err) {\n        // `foo()`\u4e0d\u662f\u88ab\u62d2\u7edd\u4e86\uff0c\u5c31\u662f\u5b83\u6ca1\u6709\u53ca\u65f6\u5b8c\u6210\n        // \u90a3\u4e48\u53ef\u4ee5\u8003\u5bdf`err`\u6765\u77e5\u9053\u662f\u54ea\u79cd\u60c5\u51b5\n    }\n);\n")),(0,l.kt)("p",null,"\u5e76\u4e14",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u672c\u8eab\u8fd4\u56de\u53e6\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Promise"),", \u53ef\u4ee5\u7528\u6765\u7ec4\u6210\u94fe\u5f0f\u8c03\u7528:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function delay(time) {\n    return new Promise( function(resolve,reject){\n        setTimeout( resolve, time );\n    } );\n}\n\ndelay( 100 ) // step 1\n.then( function STEP2(){\n    console.log( "step 2 (after 100ms)" );\n    return delay( 200 );\n} )\n.then( function STEP3(){\n    console.log( "step 3 (after another 200ms)" );\n} )\n.then( function STEP4(){\n    console.log( "step 4 (next Job)" );\n    return delay( 50 );\n} )\n.then( function STEP5(){\n    console.log( "step 5 (after another 50ms)" );\n} )\n...\n')),(0,l.kt)("p",null,"\u6b64\u5916 Promise \u88ab\u5b9a\u4e49\u4e3a\u53ea\u80fd\u89e3\u6790\u4e00\u6b21, \u5982\u679c\u521b\u5efa\u4ee3\u7801\u5c1d\u8bd5\u8c03\u7528\u591a\u6b21\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"resolve"),"\u6216\u8005",(0,l.kt)("inlineCode",{parentName:"p"},"reject"),"\u591a\u6b21, \u90a3\u4e48 Promise \u53ea\u63a5\u53d7\u7b2c\u4e00\u6b21\u89e3\u6790, \u800c\u5ffd\u7565\u540e\u7eed\u7684\u5c1d\u8bd5."),(0,l.kt)("p",null,"Promise \u7684\u89e3\u6790\u53ea\u80fd\u4f20\u9012\u4e00\u4e2a\u53c2\u6570, \u591a\u4f59\u7684\u53c2\u6570\u4f1a\u88ab\u5ffd\u7565, \u6ca1\u6709\u53c2\u6570\u5c31\u662f undefined."),(0,l.kt)("p",null,"\u5728 Promise \u521b\u5efa\u8fc7\u7a0b\u4e2d\u5982\u679c\u629b\u51fa\u4e86\u4e00\u4e2a\u9519\u8bef, \u8fd9\u4e2a\u9519\u8bef\u5c06\u88ab\u6355\u83b7, \u5e76\u4e14\u5f53\u524d\u7684 Promise \u5f3a\u5236\u53d8\u4e3a\u62d2\u7edd, \u8fd8\u6709\u4e00\u4e2a\u7ec6\u8282:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var p = new Promise(function(resolve, reject) {\n    resolve(42);\n});\n\np.then(\n    function fulfilled(msg) {\n        foo.bar();\n        console.log(msg); // \u6c38\u8fdc\u4e0d\u4f1a\u8dd1\u5230\u8fd9\u91cc :(\n    },\n    function rejected(err) {\n        // \u4e5f\u6c38\u8fdc\u4e0d\u4f1a\u8dd1\u5230\u8fd9\u91cc :(\n    }\n);\n")),(0,l.kt)("h3",{id:"promise-\u6392\u7a0b"},"Promise \u6392\u7a0b"),(0,l.kt)("p",null,"\u94fe\u63a5\u5728\u4e24\u4e2a\u5206\u79bb\u7684 Promise \u4e0a\u7684\u56de\u8c03\u4e4b\u95f4\u7684\u76f8\u5bf9\u987a\u5e8f\u662f\u4e0d\u80fd\u53ef\u9760\u9884\u6d4b\u7684. \u6bd4\u5982\u8fd9\u6837:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var p3 = new Promise(function(resolve, reject) {\n    resolve('B');\n});\n\nvar p1 = new Promise(function(resolve, reject) {\n    resolve(p3);\n});\n\nvar p2 = new Promise(function(resolve, reject) {\n    resolve('A');\n});\n\np1.then(function(v) {\n    console.log(v);\n});\n\np2.then(function(v) {\n    console.log(v);\n});\n\n// A B  <-- \u4e0d\u662f\u4f60\u53ef\u80fd\u671f\u671b\u7684 B A\n")),(0,l.kt)("p",null,"\u4e3a\u4e86\u907f\u514d\u8fd9\u6837\u7684\u95ee\u9898, \u6211\u4eec\u4e0d\u5e94\u5f53\u4f9d\u9760\u4efb\u4f55\u8de8 Promise \u7684\u56de\u8c03\u987a\u5e8f. \u5f53\u7136, \u6700\u597d\u662f\u5728\u4ee3\u7801\u4e2d\u6839\u672c\u4e0d\u8981\u8ba9\u591a\u4e2a\u56de\u8c03\u7684\u987a\u5e8f\u6210\u4e3a\u95ee\u9898."),(0,l.kt)("h3",{id:"promise-\u6a21\u5f0f"},"Promise \u6a21\u5f0f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},'Promise.all: "\u4e0e", \u591a\u4e2a\u5e76\u53d1\u6d41\u7a0b\u90fd\u5b8c\u6210\u624d\u7ee7\u7eed\u6267\u884c:')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u8fd9\u91cc\u5047\u5b9a\u4e86request(..)\u662f\u4e00\u4e2a\u517c\u5bb9Promise\u7684Ajax\u5de5\u5177\nvar p1 = request('http://some.url.1/');\nvar p2 = request('http://some.url.2/');\n\nPromise.all([p1, p2])\n    .then(function(msgs) {\n        // `p1`\u548c`p2`\u90fd\u5df2\u5b8c\u6210\uff0c\u8fd9\u91cc\u5c06\u5b83\u4eec\u7684\u6d88\u606f\u4f20\u5165\n        return request('http://some.url.3/?v=' + msgs.join(','));\n    })\n    .then(function(msg) {\n        console.log(msg);\n    });\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},'Promise.race: "\u6216", \u591a\u4e2a\u5e76\u53d1\u53ea\u8981\u4e00\u4e2a\u5b8c\u6210\u4e86, \u5c31\u7ee7\u7eed\u4e0b\u4e00\u6b65\u5e76\u4e14\u4e22\u5f03\u5176\u4ed6 Promise:')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// `foo()`\u662f\u4e00\u4e2a\u517c\u5bb9Promise\n\n// `timeoutPromise(..)`\n// \u8fd4\u56de\u4e00\u4e2a\u5728\u6307\u5b9a\u5ef6\u8fdf\u4e4b\u540e\u4f1a\u88ab\u62d2\u7edd\u7684Promise\n\n// \u4e3a`foo()`\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\nPromise.race([\n    foo(), // \u5c1d\u8bd5`foo()`\n    timeoutPromise(3000) // \u7ed9\u5b833\u79d2\u949f\n]).then(\n    function() {\n        // `foo(..)`\u53ca\u65f6\u5730\u5b8c\u6210\u4e86\uff01\n    },\n    function(err) {\n        // `foo()`\u8981\u4e48\u662f\u88ab\u62d2\u7edd\u4e86\uff0c\u8981\u4e48\u5c31\u662f\u6ca1\u6709\u53ca\u65f6\u5b8c\u6210\n        // \u53ef\u4ee5\u8003\u5bdf`err`\u6765\u77e5\u9053\u662f\u54ea\u4e00\u4e2a\u539f\u56e0\n    }\n);\n")),(0,l.kt)("p",null,"\u6ce8\u610f\u4e00\u70b9, \u5982\u679c\u4e00\u4e2a\u7a7a\u7684 Array \u88ab\u4f20\u5165",(0,l.kt)("inlineCode",{parentName:"p"},"Promise.all()"),", \u5b83\u4f1a\u7acb\u5373\u5b8c\u6210, \u4f46",(0,l.kt)("inlineCode",{parentName:"p"},"Promise.race"),"\u4f1a\u6c38\u8fdc\u6302\u8d77, \u6c38\u8fdc\u4e0d\u4f1a\u89e3\u6790."),(0,l.kt)("p",null,"\u5982\u679c\u6784\u5efa\u4e86\u4e00\u4e2a\u4e0d\u5305\u542b\u9519\u8bef\u5904\u7406\u7684 Promise \u94fe, \u8fd9\u4e2a\u94fe\u7684\u4efb\u610f\u4f4d\u7f6e\u53d1\u751f\u7684\u4efb\u4f55\u9519\u8bef\u90fd\u5c06\u6cbf\u7740\u94fe\u6761\u5411\u4e0b\u65e0\u9650\u4f20\u64ad, \u76f4\u5230\u88ab\u76d1\u542c\u4e3a\u6b62."),(0,l.kt)("h3",{id:"\u5e76\u53d1\u8fed\u4ee3"},"\u5e76\u53d1\u8fed\u4ee3"),(0,l.kt)("p",null,"\u6709\u65f6\u5019\u5982\u679c\u8981\u8fed\u4ee3\u4e00\u4e2a Promise \u7684\u5217\u8868, \u5e76\u5bf9\u4ed6\u4eec\u6240\u6709\u90fd\u5b9e\u65bd\u4e00\u4e9b\u4efb\u52a1, \u5c31\u50cf array \u7684 forEach \u4e00\u6837, \u53ef\u4ee5\u8003\u8651\u8bbe\u8ba1\u4e00\u4e2a\u5f02\u6b65\u7684 map \u5de5\u5177:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"if (!Promise.map) {\n    Promise.map = function(vals, cb) {\n        // \u4e00\u4e2a\u7b49\u5f85\u6240\u6709\u88ab\u6620\u5c04\u7684promise\u7684\u65b0promise\n        return Promise.all(\n            // \u6ce8\u610f\uff1a\u666e\u901a\u7684\u6570\u7ec4`map(..)`\uff0c\n            // \u5c06\u503c\u7684\u6570\u7ec4\u53d8\u4e3apromise\u7684\u6570\u7ec4\n            vals.map(function(val) {\n                // \u5c06`val`\u66ff\u6362\u4e3a\u4e00\u4e2a\u5728`val`\n                // \u5f02\u6b65\u6620\u5c04\u5b8c\u6210\u540e\u624d\u89e3\u6790\u7684\u65b0promise\n                return new Promise(function(resolve) {\n                    cb(val, resolve);\n                });\n            })\n        );\n    };\n}\n")),(0,l.kt)("p",null,"\u4e0d\u8fc7, \u5728\u8fd9\u4e2a map \u7684\u5b9e\u73b0\u4e2d, \u65e0\u6cd5\u8868\u793a\u5f02\u6b65\u62d2\u7edd, \u4f46\u5982\u679c\u4e00\u4e2a\u5728\u6620\u5c04\u7684\u6bc1\u6389\u5185\u90e8\u53d1\u751f\u4e00\u4e2a\u540c\u6b65\u7684\u5f02\u5e38/\u9519\u8bef, Promise.map \u8fd4\u56de\u7684 Promise \u5c31\u4f1a\u62d2\u7edd."),(0,l.kt)("h3",{id:"\u5e76\u53d1\u9650\u5236"},"\u5e76\u53d1\u9650\u5236"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Promise.all"),"\u7684\u5e76\u53d1\u9650\u5236\u6307\u7684\u662f, \u6bcf\u4e2a\u65f6\u523b\u5e76\u53d1\u6267\u884c\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"promise"),"\u7684\u6570\u91cf\u662f\u56fa\u5b9a\u7684, \u6700\u7ec8\u7684\u6267\u884c\u7ed3\u679c\u8fd8\u662f\u4fdd\u6301\u4e0e\u539f\u6765\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Promise.all"),"\u4e00\u76f4."),(0,l.kt)("p",null,"\u6211\u4eec\u77e5\u9053promise\u5b9e\u9645\u4e0a\u5728\u5b9e\u4f8b\u5316\u5bf9\u8c61\u7684\u65f6\u5019\u5c31\u6267\u884c\u76f8\u5e94\u7684\u4ee3\u7801\u4e86. \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u5b9e\u4f8b\u5316\u7684\u65f6\u5019\u5c31\u53bb\u63a7\u5236\u76f8\u5173\u7684\u903b\u8f91, \u628a\u5b83\u4ea4\u7ed9\u5e76\u53d1\u63a7\u5236\u7684\u903b\u8f91."),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u4e00\u4e9b\u7b2c\u4e09\u65b9\u7684\u5b9e\u73b0, \u6bd4\u5982",(0,l.kt)("inlineCode",{parentName:"p"},"asycn-pool"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function asyncPool(poolLimit, array, iteratorFn) {\n    let i = 0;\n    const ret = [];\n    const executing = [];\n    const enqueue = function () {\n        // \u8fb9\u754c\u5904\u7406\uff0carray\u4e3a\u7a7a\u6570\u7ec4\n        if (i === array.length) {\n            return Promise.resolve();\n        }\n        // \u6bcf\u8c03\u4e00\u6b21enqueue\uff0c\u521d\u59cb\u5316\u4e00\u4e2apromise\n        const item = array[i++];\n        const p = Promise.resolve().then(() => iteratorFn(item, array));\n        // \u653e\u5165promises\u6570\u7ec4\n        ret.push(p);\n        // promise\u6267\u884c\u5b8c\u6bd5\uff0c\u4eceexecuting\u6570\u7ec4\u4e2d\u5220\u9664\n        const e = p.then(() => executing.splice(executing.indexOf(e), 1));\n        // \u63d2\u5165executing\u6570\u5b57\uff0c\u8868\u793a\u6b63\u5728\u6267\u884c\u7684promise\n        executing.push(e);\n        // \u4f7f\u7528Promise.race\uff0c\u6bcf\u5f53executing\u6570\u7ec4\u4e2dpromise\u6570\u91cf\u4f4e\u4e8epoolLimit\uff0c\u5c31\u5b9e\u4f8b\u5316\u65b0\u7684promise\u5e76\u6267\u884c\n        let r = Promise.resolve();\n        if (executing.length >= poolLimit) {\n            r = Promise.race(executing);\n        }\n        // \u9012\u5f52\uff0c\u76f4\u5230\u904d\u5386\u5b8carray\n        return r.then(() => enqueue());\n    };\n    return enqueue().then(() => Promise.all(ret));\n}\n")),(0,l.kt)("p",null,"\u5927\u6982\u7684\u903b\u8f91\u63cf\u8ff0\u4e3a:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4ecearray\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb, \u521d\u59cb\u5316promise\u5bf9\u8c61, \u540c\u65f6\u7528\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"li"},"executing"),"\u6570\u7ec4\u4fdd\u5b58\u6b63\u5728\u6267\u884c\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"Promise")),(0,l.kt)("li",{parentName:"ol"},"\u4e0d\u65ad\u7684\u521d\u59cb\u5316promise, \u76f4\u5230\u8fbe\u5230",(0,l.kt)("inlineCode",{parentName:"li"},"pollLimit")),(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"Promise.race"),", \u83b7\u53d6\u6b63\u5728\u6267\u884c\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"executing"),"\u4e2dpromise \u7684\u6267\u884c\u60c5\u51b5, \u5f53\u6709\u4e00\u4e2apromise\u6267\u884c\u5b8c\u6bd5, \u7ee7\u7eed\u521d\u59cb\u5316promise\u5e76\u653e\u5165\u5230executing\u4e2d"),(0,l.kt)("li",{parentName:"ol"},"\u6240\u6709\u7684promise\u90fd\u6267\u884c\u5b8c\u6bd5\u4e86, \u5c31\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"promise.all"),"\u8fd4\u56de")),(0,l.kt)("h2",{id:"generator"},"Generator"),(0,l.kt)("p",null,"Promise \u5b9e\u9645\u4e0a\u4e5f\u662f\u57fa\u4e8e\u56de\u8c03\u7684\u5f02\u6b65\u6d41\u7a0b\u63a7\u5236. \u8fd9\u79cd\u8868\u8fbe\u4f1a\u6709\u4e24\u4e2a\u5173\u952e\u7f3a\u9677:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u57fa\u4e8e\u56de\u8c03\u7684\u5f02\u6b65\u4e0e\u6211\u4eec\u5927\u8111\u89c4\u5212\u4efb\u52a1\u7684\u5404\u4e2a\u6b65\u9aa4\u7684\u8fc7\u7a0b\u4e0d\u76f8\u7b26"),(0,l.kt)("li",{parentName:"ul"},"\u7531\u4e8e\u63a7\u5236\u5012\u8f6c\u56de\u8c03\u65f6\u4e0d\u53ef\u9760\u7684, \u4e5f\u662f\u4e0d\u53ef\u7ec4\u5408\u7684.")),(0,l.kt)("p",null,"Promise \u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u989d\u5916\u7684\u4ee3\u7801\u63a7\u5236\u91cd\u5efa\u53ef\u9760\u6027\u548c\u53ef\u7ec4\u5408\u578b. \u6b64\u5916\u8fd8\u6709\u4e00\u79cd\u987a\u5e8f\u7684, \u770b\u8d77\u6765\u540c\u6b65\u7684\u98ce\u683c\u6765\u8868\u8fbe\u5f02\u6b65\u6d41\u7a0b\u63a7\u5236, \u5c31\u662f\u672c\u8282\u7684 Generator:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var x = 1;\n\n//\u6ce8\u610f\u5b9a\u4e49\u65b9\u5f0f\nfunction* foo() {\n    x++;\n    yield; // \u6682\u505c\uff01\n    console.log('x:', x);\n}\n\nfunction bar() {\n    x++;\n}\n\n// \u6784\u5efa\u4e00\u4e2a\u8fed\u4ee3\u5668`it`\u6765\u63a7\u5236generator\nvar it = foo();\n\n// \u5728\u8fd9\u91cc\u5f00\u59cb`foo()`\uff01\nit.next();\nx; // 2\nbar();\nx; // 3\nit.next(); // x: 3\n")),(0,l.kt)("p",null,'\u5728\u62a2\u5360\u5f0f\u7684\u591a\u7ebf\u7a0b\u8bed\u8a00\u4e2d, \u4e00\u4e2a\u7ebf\u7a0b\u7684\u51fd\u6570\u5e72\u6270\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u51fd\u6570\u7684\u4e24\u4e2a\u8bed\u53e5\u4e2d\u95f4\u7684\u72b6\u6001\u662f\u53ef\u80fd\u7684, \u867d\u7136 JS \u65e2\u4e0d\u662f\u62a2\u5360\u5f0f\u4e5f(\u8fd8)\u4e0d\u662f\u591a\u7ebf\u7a0b\u7684, \u4f46\u662f\u8fd9\u79cd"\u5e72\u6270"\u7684\u534f\u4f5c\u5f62\u5f0f\u786e\u5b9e\u6709\u53ef\u80fd\u7684.'),(0,l.kt)("p",null,"generator \u53ef\u4ee5\u5c06\u5185\u90e8\u7684\u4fe1\u606f\u8fdb\u884c\u8f93\u5165\u548c\u8f93\u51fa(yield)."),(0,l.kt)("p",null,"\u4e00\u822c\u6765\u8bf4, \u4e00\u4e2a\u8fed\u4ee3\u5668\u62e5\u6709\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"next()"),"\u6570\u91cf\u4f1a\u6bd4\u4e00\u4e2a Generator \u4e2d\u7684 yield \u8bed\u53e5\u7684\u6570\u91cf\u591a\u4e00\u4e2a."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo(x) {\n    var y = x * (yield);\n    return y;\n}\n\nvar it = foo(6);\n\n// \u5f00\u59cb`foo(..)`\nit.next();\n\nvar res = it.next(7);\n\nres.value; // 42\n")),(0,l.kt)("p",null,"\u7b2c\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"next"),"\u542f\u52a8\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"generator"),", \u7136\u540e\u8fd0\u884c\u5230\u7b2c\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),", \u7b2c\u4e8c\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"next"),"\u8c03\u7528\u6ee1\u8db3\u4e86\u7b2c\u4e00\u4e2a\u6682\u505c\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u8868\u8fbe\u5f0f, \u800c\u7b2c\u4e09\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"next"),"\u5c06\u6ee1\u8db3\u7b2c\u4e8c\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),", \u5982\u6b64\u53cd\u590d."),(0,l.kt)("p",null,"\u7b2c\u4e8c\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"next"),"\u7ed9\u7b2c\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u8f93\u5165\u53c2\u6570, \u4e5f\u53ef\u4ee5\u8bf4",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u4f20\u9012\u4e00\u4e2a\u503c\u51fa\u6765\u7ed9",(0,l.kt)("inlineCode",{parentName:"p"},"next"),"."),(0,l.kt)("h3",{id:"\u591a\u8fed\u4ee3\u5668"},"\u591a\u8fed\u4ee3\u5668"),(0,l.kt)("p",null,"\u6bcf\u5f53\u4f60\u6784\u5efa\u4e00\u4e2a\u8fed\u4ee3\u5668, \u4f60\u90fd\u9690\u542b\u7684\u6784\u5efa\u4e86\u4e00\u4e2a\u5c06\u7531\u8fd9\u4e2a\u8fed\u4ee3\u5668\u63a7\u5236\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"generator"),"\u7684\u5b9e\u4f8b."),(0,l.kt)("p",null,"\u540c\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"generator"),"\u7684\u591a\u4e2a\u5b9e\u4f8b\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c, \u751a\u81f3\u53ef\u4ee5\u4e92\u52a8."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    var x = yield 2;\n    z++;\n    var y = yield x * z;\n    console.log(x, y, z);\n}\n\nvar z = 1;\n\nvar it1 = foo();\nvar it2 = foo();\n\nvar val1 = it1.next().value; // 2 <-- \u8ba9\u51fa2\nvar val2 = it2.next().value; // 2 <-- \u8ba9\u51fa2\n\nval1 = it1.next(val2 * 10).value; // 40  <-- x:20,  z:2\nval2 = it2.next(val1 * 5).value; // 600 <-- x:200, z:3\n\nit1.next(val2 / 2); // y:300\n// 20 300 3\nit2.next(val1 / 4); // y:10\n// 200 10 3\n")),(0,l.kt)("h3",{id:"\u5f02\u6b65\u8fed\u4ee3-generator"},"\u5f02\u6b65\u8fed\u4ee3 Generator"),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"Generator"),"\u6765\u63a7\u5236\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"ajax"),"\u4efb\u52a1\u6d41\u7a0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function foo(x, y) {\n    ajax('http://some.url.1/?x=' + x + '&y=' + y, function(err, data) {\n        if (err) {\n            // \u5411`*main()`\u4e2d\u6254\u8fdb\u4e00\u4e2a\u9519\u8bef\n            it.throw(err);\n        } else {\n            // \u4f7f\u7528\u6536\u5230\u7684`data`\u6765\u7ee7\u7eed`*main()`\n            it.next(data);\n        }\n    });\n}\n\nfunction* main() {\n    try {\n        var text = yield foo(11, 31);\n        console.log(text);\n    } catch (err) {\n        console.error(err);\n    }\n}\n\nvar it = main();\n\n// \u4f7f\u4e00\u5207\u5f00\u59cb\u8fd0\u884c\uff01\nit.next();\n")),(0,l.kt)("p",null,"\u770b\u8d77\u6765\u6211\u4eec\u8c03\u7528\u4e86\u4e00\u4e2a\u666e\u901a\u7684\u51fd\u6570",(0,l.kt)("inlineCode",{parentName:"p"},"foo()"),", \u7136\u800c\u6211\u4eec\u5374\u4ee5\u540c\u6b65\u7684\u65b9\u5f0f\u83b7\u5f97\u4e86\u4e00\u6b65\u7684\u7ed3\u679c, \u5b9e\u9645\u4e0a\u5b83\u4ec5\u4ec5\u6682\u505c/\u963b\u585e\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"generator")," \u672c\u8eab\u7684\u4ee3\u7801."),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a, \u6211\u4eec\u5c06\u5f02\u6b65\u5904\u7406\u4f5c\u4e3a\u5b9e\u73b0\u7ec6\u8282\u62bd\u8c61\u51fa\u53bb, \u4ee5\u81f3\u4e8e\u6211\u4eec\u53ef\u4ee5\u540c\u6b65\u7684/\u987a\u5e8f\u7684\u63a8\u7406\u6211\u4eec\u7684\u6d41\u7a0b\u63a7\u5236."),(0,l.kt)("p",null,"\u751a\u81f3\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u8fd8\u5141\u8bb8",(0,l.kt)("inlineCode",{parentName:"p"},"generator"),"\u6765",(0,l.kt)("inlineCode",{parentName:"p"},"catch"),"\u4e00\u4e2a\u9519\u8bef. (try..catch \u65e0\u6cd5\u6355\u83b7\u5f02\u6b65\u7684\u9519\u8bef)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* main() {\n    var x = yield 'Hello World';\n\n    yield x.toLowerCase(); // \u5f15\u53d1\u4e00\u4e2a\u5f02\u5e38\uff01\n}\n\nvar it = main();\n\nit.next().value; // Hello World\n\ntry {\n    it.next(42);\n} catch (err) {\n    console.error(err); // TypeError\n}\n")),(0,l.kt)("h3",{id:"generator--promise"},"Generator + Promise"),(0,l.kt)("p",null,"\u53d1\u6325 Promise \u548c generator \u7684\u6700\u5927\u529f\u6548\u7684\u81ea\u7136\u65b9\u6cd5\u662f yield \u4e00\u4e2a Promise\uff0c\u5e76\u5c06\u8fd9\u4e2a Promise \u8fde\u63a5\u5230 generator \u7684 \u8fed\u4ee3\u5668 \u7684\u63a7\u5236\u7aef\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u57fa\u4e8e Promise \u7684 Ajax \u7684\u4f8b\u5b50:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function foo(x, y) {\n    return request('http://some.url.1/?x=' + x + '&y=' + y);\n}\n\nfoo(11, 31).then(\n    function(text) {\n        console.log(text);\n    },\n    function(err) {\n        console.error(err);\n    }\n);\n")),(0,l.kt)("p",null,"\u5c06\u8fd9\u4e2a Promise \u5c01\u88c5\u5230\u4e00\u4e2a Generator \u51fd\u6570\u4e2d:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function foo(x, y) {\n    return request('http://some.url.1/?x=' + x + '&y=' + y);\n}\n\nfunction* main() {\n    try {\n        var text = yield foo(11, 31);\n        console.log(text);\n    } catch (err) {\n        console.error(err);\n    }\n}\n")),(0,l.kt)("p",null,"\u5728 generator \u5185\u90e8, \u65e0\u8bba\u4ec0\u4e48\u6837\u7684\u503c\u88ab\u88ab",(0,l.kt)("inlineCode",{parentName:"p"},"yeild"),"\u51fa\u53bb\u90fd\u662f\u4e0d\u53ef\u89c1\u7684\u5b9e\u73b0\u7ec6\u8282, \u4e0b\u9762\u6765\u8fd0\u884c\u8fd9\u4e2a generator:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var it = main();\n\nvar p = it.next().value;\n\n// \u7b49\u5f85`p` promise\u89e3\u6790\np.then(\n    function(text) {\n        it.next(text);\n    },\n    function(err) {\n        it.throw(err);\n    }\n);\n")),(0,l.kt)("p",null,"\u7b80\u5355\u7684\u7ec4\u5408\u975e\u5e38\u597d\u7528, \u4f46\u662f\u4ecd\u7136\u5b58\u5728\u4e00\u4e9b\u95ee\u9898:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6211\u4eec\u9700\u8981\u4e3a\u6bcf\u4e00\u4e2a generator \u624b\u52a8\u7f16\u5199\u4e00\u4e2a\u4e0d\u540c\u7684 Promise \u94fe."),(0,l.kt)("li",{parentName:"ol"},"generator \u5728",(0,l.kt)("inlineCode",{parentName:"li"},"it.next()"),"\u671f\u95f4\u629b\u51fa\u4e00\u4e2a\u9519\u8bef, \u6211\u4eec\u5e94\u5f53\u5c06\u5176 catch \u8fd8\u662f\u76f4\u63a5\u5f80\u4e0a\u629b\u51fa?")),(0,l.kt)("h3",{id:"\u5e26\u6709-promise-\u7684-generator-\u8fd0\u884c\u671f"},"\u5e26\u6709 Promise \u7684 Generator \u8fd0\u884c\u671f"),(0,l.kt)("p",null,"\u6709\u4e00\u4e9b\u62bd\u8c61\u5e93\u63d0\u4f9b\u4e86\u8fd9\u6837\u7684\u5de5\u5177:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u611f\u8c22Benjamin Gruenbaum (@benjamingr\u5728GitHub)\u5728\u6b64\u505a\u51fa\u7684\u5de8\u5927\u6539\u8fdb\uff01\nfunction run(gen) {\n    var args = [].slice.call(arguments, 1);\n    var it;\n\n    // \u5728\u5f53\u524d\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u521d\u59cb\u5316generator\n    it = gen.apply(this, args);\n\n    // \u4e3agenerator\u7684\u5b8c\u6210\u8fd4\u56de\u4e00\u4e2apromise\n    return Promise.resolve().then(function handleNext(value) {\n        // \u8fd0\u884c\u81f3\u4e0b\u4e00\u4e2a\u8ba9\u51fa\u7684\u503c\n        var next = it.next(value);\n\n        return (function handleResult(next) {\n            // generator\u5df2\u7ecf\u5b8c\u6210\u8fd0\u884c\u4e86\uff1f\n            if (next.done) {\n                return next.value;\n            }\n            // \u5426\u5219\u7ee7\u7eed\u6267\u884c\n            else {\n                return Promise.resolve(next.value).then(\n                    // \u5728\u6210\u529f\u7684\u60c5\u51b5\u4e0b\u7ee7\u7eed\u5f02\u6b65\u5faa\u73af\uff0c\u5c06\u89e3\u6790\u7684\u503c\u9001\u56degenerator\n                    handleNext,\n\n                    // \u5982\u679c`value`\u662f\u4e00\u4e2a\u62d2\u7edd\u7684promise\uff0c\u5c31\u5c06\u9519\u8bef\u4f20\u64ad\u56degenerator\u81ea\u5df1\u7684\u9519\u8bef\u5904\u7406g\n                    function handleErr(err) {\n                        return Promise.resolve(it.throw(err)).then(handleResult);\n                    }\n                );\n            }\n        })(next);\n    });\n}\n")),(0,l.kt)("p",null,"\u6309\u7167\u8fd9\u4e2a\u51fd\u6570, \u6211\u4eec\u53ef\u4ee5\u81ea\u52a8\u7684\u5f02\u6b65\u7684\u63a8\u8fdb generator \u51fd\u6570, \u76f4\u5230\u6574\u4e2a\u51fd\u6570\u5b8c\u6210."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* main() {\n    // ..\n}\n\nrun(main);\n")),(0,l.kt)("h3",{id:"generator-\u4e2d\u7684-promise-\u5e76\u53d1"},"Generator \u4e2d\u7684 Promise \u5e76\u53d1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    // \u4f7f\u4e24\u4e2a\u8bf7\u6c42\u201c\u5e76\u884c\u201d\u5e76\u7b49\u5f85\u4e24\u4e2apromise\u90fd\u88ab\u89e3\u6790\n    var results = yield Promise.all([request('http://some.url.1'), request('http://some.url.2')]);\n\n    var r1 = results[0];\n    var r2 = results[1];\n\n    var r3 = yield request('http://some.url.3/?v=' + r1 + ',' + r2);\n\n    console.log(r3);\n}\n\n// \u4f7f\u7528\u524d\u9762\u5b9a\u4e49\u7684`run(..)`\u5de5\u5177\nrun(foo);\n")),(0,l.kt)("p",null,"\u4f5c\u4e3a\u4e00\u79cd\u4ee3\u7801\u5206\u5272, \u6211\u4eec\u5e94\u5f53\u5c3d\u91cf\u4f7f\u5f97 generator \u5185\u90e8\u7684\u4ee3\u7801\u76f8\u5bf9\u7b80\u5355, \u987a\u5e8f, \u5e76\u4e14\u770b\u8d77\u6765\u540c\u6b65, \u5c06\u5c3d\u53ef\u80fd\u591a\u7684\u5f02\u6b65\u7ec6\u8282\u9690\u85cf\u5728\u8fd9\u4e9b\u4ee3\u7801\u4e4b\u5916. \u6bd4\u5982\u4e0b\u9762\u8fd9\u79cd\u5199\u6cd5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u6ce8\u610f\uff1a\u8fd9\u662f\u4e00\u4e2a\u666e\u901a\u51fd\u6570\uff0c\u4e0d\u662fgenerator\nfunction bar(url1, url2) {\n    return Promise.all([request(url1), request(url2)]);\n}\n\nfunction* foo() {\n    // \u5c06\u57fa\u4e8ePromise\u7684\u5e76\u53d1\u7ec6\u8282\u9690\u85cf\u5728`bar(..)`\u5185\u90e8\n    var results = yield bar('http://some.url.1', 'http://some.url.2');\n\n    var r1 = results[0];\n    var r2 = results[1];\n\n    var r3 = yield request('http://some.url.3/?v=' + r1 + ',' + r2);\n\n    console.log(r3);\n}\n\n// \u4f7f\u7528\u521a\u624d\u5b9a\u4e49\u7684`run(..)`\u5de5\u5177\nrun(foo);\n")),(0,l.kt)("p",null,"\u5c06\u5f02\u6b65\u6027, \u50cf Promise \u8fd9\u79cd, \u4f5c\u4e3a\u4e00\u79cd\u5b9e\u73b0\u7ec6\u8282\u4e5f\u8bb8\u662f\u66f4\u597d\u7684\u5b9e\u8df5\u65b9\u6cd5."),(0,l.kt)("p",null,"\u6ce8\u610f: \u5bf9\u4e8e\u7f16\u7a0b\u6765\u8bf4, \u62bd\u8c61\u4e0d\u603b\u662f\u4e00\u79cd\u597d\u7684\u4e1c\u897f, \u5b83\u5728\u5e26\u6765\u7b80\u6d01\u6027\u7684\u540c\u65f6\u4f1a\u589e\u52a0\u590d\u6742\u5ea6, \u4f46\u662f\u8fd9\u79cd\u60c5\u51b5\u4e0b, \u6211\u4eec\u8ba4\u4e3a\u8fd9\u6837\u7684\u98ce\u683c\u662f\u66f4\u5065\u5eb7\u7684."),(0,l.kt)("h2",{id:"generator-\u59d4\u6258"},"Generator \u59d4\u6258"),(0,l.kt)("p",null,"Generator \u59d4\u6258, \u6307\u7684\u662f\u4ece\u4e00\u4e2a generator \u8c03\u7528\u53e6\u4e00\u4e2a generator \u7684\u5199\u6cd5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    var r2 = yield request('http://some.url.2');\n    var r3 = yield request('http://some.url.3/?v=' + r2);\n\n    return r3;\n}\n\nfunction* bar() {\n    var r1 = yield request('http://some.url.1');\n\n    // \u901a\u8fc7`run(..)`\u201c\u59d4\u6258\u201d\u5230`*foo()`\n    var r3 = yield run(foo);\n\n    console.log(r3);\n}\n\nrun(bar);\n")),(0,l.kt)("p",null,"\u9664\u4e86 run \u59d4\u6258, yield \u662f\u4e00\u79cd\u66f4\u597d\u7684\u529e\u6cd5: ",(0,l.kt)("inlineCode",{parentName:"p"},"yield * __"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    console.log('`*foo()` starting');\n    yield 3;\n    yield 4;\n    console.log('`*foo()` finished');\n}\n\nfunction* bar() {\n    yield 1;\n    yield 2;\n    yield* foo(); // `yield`-delegation!\n    yield 5;\n}\n\nvar it = bar();\n\nit.next().value; // 1\nit.next().value; // 2\nit.next().value; // `*foo()` starting\n// 3\nit.next().value; // 4\nit.next().value; // `*foo()` finished\n// 5\n")),(0,l.kt)("p",null,"\u6211\u4eec\u5728\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"foo()"),"\u7684\u65f6\u5019\u521b\u5efa\u4e86\u4e00\u4e2a\u8fed\u4ee3\u5668, \u7136\u540e",(0,l.kt)("inlineCode",{parentName:"p"},"yield *"),"\u5c06\u8fed\u4ee3\u5668\u7684\u63a7\u5236\u4f20\u9012\u7ed9\u4e86\u53e6\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"foo"),"\u8fed\u4ee3\u5668."),(0,l.kt)("p",null,"\u59d4\u6258\u7684\u8bed\u6cd5\u63d0\u4f9b\u4e86\u66f4\u7075\u6d3b\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"generator"),"\u4f7f\u7528\u65b9\u5f0f, \u80fd\u6709\u6548\u589e\u5f3a\u4ee3\u7801\u7684\u53ef\u8bfb\u6027, \u53ef\u7ef4\u62a4\u548c\u53ef\u8c03\u8bd5\u6027."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    var r2 = yield request('http://some.url.2');\n    var r3 = yield request('http://some.url.3/?v=' + r2);\n\n    return r3;\n}\n\nfunction* bar() {\n    var r1 = yield request('http://some.url.1');\n\n    // \u901a\u8fc7`run(..)`\u201c\u59d4\u6258\u201d\u5230`*foo()`\n    var r3 = yield* foo();\n\n    console.log(r3);\n}\n\nrun(bar);\n")),(0,l.kt)("h3",{id:"generator-\u53cc\u5411\u6d88\u606f\u4f20\u9012"},"Generator \u53cc\u5411\u6d88\u606f\u4f20\u9012"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    console.log('inside `*foo()`:', yield 'B');\n\n    console.log('inside `*foo()`:', yield 'C');\n\n    return 'D';\n}\n\nfunction* bar() {\n    console.log('inside `*bar()`:', yield 'A');\n\n    // `yield`-\u59d4\u6258\uff01\n    console.log('inside `*bar()`:', yield* foo());\n\n    console.log('inside `*bar()`:', yield 'E');\n\n    return 'F';\n}\n\nvar it = bar();\n\nconsole.log('outside:', it.next().value);\n// outside: A\n\nconsole.log('outside:', it.next(1).value);\n// inside `*bar()`: 1\n// outside: B\n\nconsole.log('outside:', it.next(2).value);\n// inside `*foo()`: 2\n// outside: C\n\nconsole.log('outside:', it.next(3).value);\n// inside `*foo()`: 3\n// inside `*bar()`: D\n// outside: E\n\nconsole.log('outside:', it.next(4).value);\n// inside `*bar()`: 4\n// outside: F\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u751a\u81f3\u4e0d\u9700\u8981\u59d4\u6258\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"generator"),", \u4e5f\u53ef\u4ee5\u59d4\u6258\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"iterable"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* bar() {\n    console.log('inside `*bar()`:', yield 'A');\n\n    // `yield`-\u59d4\u6258\u81f3\u4e00\u4e2a\u975egenerator\n    console.log('inside `*bar()`:', yield* ['B', 'C', 'D']);\n\n    console.log('inside `*bar()`:', yield 'E');\n\n    return 'F';\n}\n\nvar it = bar();\n\nconsole.log('outside:', it.next().value);\n// outside: A\n\nconsole.log('outside:', it.next(1).value);\n// inside `*bar()`: 1\n// outside: B\n\nconsole.log('outside:', it.next(2).value);\n// outside: C\n\nconsole.log('outside:', it.next(3).value);\n// outside: D\n\nconsole.log('outside:', it.next(4).value);\n// inside `*bar()`: undefined\n// outside: E\n\nconsole.log('outside:', it.next(5).value);\n// inside `*bar()`: 5\n// outside: F\n")),(0,l.kt)("p",null,"\u4e0d\u540c\u7684\u662f, array \u8fed\u4ee3\u5668\u4e0d\u5173\u5fc3\u4efb\u4f55\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"next()"),"\u4f20\u9012\u8fdb\u53bb\u7684\u6d88\u606f, \u6240\u4ee5 2,3,4 \u5b9e\u9645\u4e0a\u88ab\u5ffd\u7565\u4e86, \u6b64\u5916,\u8fd9\u4e2a\u8fed\u4ee3\u5668\u6ca1\u6709\u660e\u786e\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"return"),"\u503c, \u6240\u4ee5",(0,l.kt)("inlineCode",{parentName:"p"},"yield *"),"\u5728\u8868\u8fbe\u5f0f\u5b8c\u6210\u65f6\u5f97\u5230\u4e86\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"undefined"),"."),(0,l.kt)("p",null,"\u4e0e",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u59d4\u6258\u5728\u4e24\u4e2a\u65b9\u5411\u4e0a\u900f\u660e\u7684\u4f20\u9012\u6d88\u606f\u7684\u65b9\u5f0f\u76f8\u540c, \u9519\u8bef\u548c\u5f02\u5e38\u4e5f\u4f1a\u8fdb\u884c\u53cc\u5411\u4f20\u9012."),(0,l.kt)("h3",{id:"\u5f02\u6b65\u59d4\u6258"},"\u5f02\u6b65\u59d4\u6258"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo() {\n    var r2 = yield request('http://some.url.2');\n    var r3 = yield request('http://some.url.3/?v=' + r2);\n\n    return r3;\n}\n\nfunction* bar() {\n    var r1 = yield request('http://some.url.1');\n\n    var r3 = yield* foo();\n\n    console.log(r3);\n}\n\nrun(bar);\n")),(0,l.kt)("h3",{id:"\u9012\u5f52\u59d4\u6258"},"\u9012\u5f52\u59d4\u6258"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u59d4\u6258\u53ef\u4ee5\u4e00\u76f4\u6301\u7eed\u59d4\u6258\u4e0b\u53bb, \u6211\u4eec\u751a\u81f3\u53ef\u4ee5\u518d\u5177\u6709\u4e00\u90e8\u80fd\u529b\u7684 generator \u4e0a\u201d\u9012\u5f52\u201d\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"yield"),"\u59d4\u6258:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function* foo(val) {\n    if (val > 1) {\n        // \u9012\u5f52\u59d4\u6258\n        val = yield* foo(val - 1);\n    }\n\n    return yield request('http://some.url/?v=' + val);\n}\n\nfunction* bar() {\n    var r1 = yield* foo(3);\n    console.log(r1);\n}\n\nrun(bar);\n")),(0,l.kt)("h3",{id:"generator-\u5e76\u53d1"},"Generator \u5e76\u53d1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// `request(..)` \u662f\u4e00\u4e2a\u57fa\u4e8ePromise\u7684Ajax\u5de5\u5177\n\nvar res = [];\n\nfunction* reqData(url) {\n    res.push(yield request(url));\n}\n\nvar it1 = reqData('http://some.url.1');\nvar it2 = reqData('http://some.url.2');\n\nvar p1 = it1.next().value;\nvar p2 = it2.next().value;\n\np1.then(function(data) {\n    it1.next(data);\n    return p2;\n}).then(function(data) {\n    it2.next(data);\n});\n")),(0,l.kt)("p",null,"\u53e6\u4e00\u79cd\u5e76\u53d1:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// `request(..)` \u662f\u4e00\u4e2a\u57fa\u4e8ePromise\u7684Ajax\u5de5\u5177\n\nvar res = [];\n\nfunction* reqData(url) {\n    var data = yield request(url);\n\n    // \u4f20\u9012\u63a7\u5236\u6743\n    yield;\n\n    res.push(data);\n}\n\nvar it1 = reqData('http://some.url.1');\nvar it2 = reqData('http://some.url.2');\n\nvar p1 = it1.next().value;\nvar p2 = it2.next().value;\n\np1.then(function(data) {\n    it1.next(data);\n});\n\np2.then(function(data) {\n    it2.next(data);\n});\n\nPromise.all([p1, p2]).then(function() {\n    it1.next();\n    it2.next();\n});\n")),(0,l.kt)("h2",{id:"asyncawait"},"Async/Await"),(0,l.kt)("p",null,"Async/Await \u5c31\u662f\u4e00\u4e2a\u81ea\u6267\u884c\u7684 generate \u51fd\u6570\u3002\u5229\u7528 generate \u51fd\u6570\u7684\u7279\u6027\u628a\u5f02\u6b65\u7684\u4ee3\u7801\u5199\u6210\u201c\u540c\u6b65\u201d\u7684\u5f62\u5f0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\n\nconst readFile = function(fileName) {\n    return new Promise(function(resolve, reject) {\n        fs.readFile(fileName, function(error, data) {\n            if (error) return reject(error);\n            resolve(data);\n        });\n    });\n};\n\nconst gen = function*() {\n    const f1 = yield readFile('/etc/fstab');\n    const f2 = yield readFile('/etc/shells');\n    console.log(f1.toString());\n    console.log(f2.toString());\n};\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"await \u662f\u4e00\u4e2a\u8ba9\u51fa\u7ebf\u7a0b\u7684\u6807\u5fd7\u3002await \u540e\u9762\u7684\u8868\u8fbe\u5f0f\u4f1a\u5148\u6267\u884c\u4e00\u904d\uff0c\u5c06 await \u540e\u9762\u7684\u4ee3\u7801\u52a0\u5165\u5230 microtask \u4e2d\uff0c\u7136\u540e\u5c31\u4f1a\u8df3\u51fa\u6574\u4e2a async \u51fd\u6570\u6765\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801\u3002")),(0,l.kt)("p",null,"\u8fd9\u91cc\u6709\u4e2a\u4f8b\u5b50:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"async function async1() {\n    console.log('async1 start');\n    await async2();\n    console.log('async1 end');\n}\nasync function async2() {\n    console.log('async2');\n}\nconsole.log('script start');\nsetTimeout(function() {\n    console.log('setTimeout');\n}, 0);\nasync1();\nnew Promise(function(resolve) {\n    console.log('promise1');\n    resolve();\n}).then(function() {\n    console.log('promise2');\n});\nconsole.log('script end');\n\n/**\n * script start\n * async1 start\n * async2\n * promise1\n * script end\n * async1 end\n * promise2\n * setTimeout\n */\n")),(0,l.kt)("p",null,"\u5176\u4e2d\u5728\u6267\u884c async1 \u7684\u65f6\u5019, \u9047\u5230\u4e86 await\uff0c\u4f1a\u5c06 await \u540e\u9762\u7684\u8868\u8fbe\u5f0f\u6267\u884c\u4e00\u904d\uff0c\u6240\u4ee5\u5c31\u7d27\u63a5\u7740\u8f93\u51fa async2\uff0c\u7136\u540e\u5c06 await \u540e\u9762\u7684\u4ee3\u7801\u4e5f\u5c31\u662f console.log('async1 end')\u52a0\u5165\u5230 microtask \u4e2d\u7684 Promise \u961f\u5217\u4e2d\uff0c\u63a5\u7740\u8df3\u51fa async1 \u51fd\u6570\u6765\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801\u3002"),(0,l.kt)("h2",{id:"\u5e94\u7528"},"\u5e94\u7528"),(0,l.kt)("h3",{id:"1-\u5b9e\u73b0\u4e00\u4e2a-sleep-\u51fd\u6570"},"1. \u5b9e\u73b0\u4e00\u4e2a sleep \u51fd\u6570"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"//Promise\nconst sleep = time => {\n    return new Promise(resolve => setTimeout(resolve, time));\n};\nsleep(1000).then(() => {\n    console.log(1);\n});\n\n//Generator\nfunction* sleepGenerator(time) {\n    yield new Promise(function(resolve, reject) {\n        setTimeout(resolve, time);\n    });\n}\nsleepGenerator(1000)\n    .next()\n    .value.then(() => {\n        console.log(1);\n    });\n\n//async\nfunction sleep(time) {\n    return new Promise(resolve => setTimeout(resolve, time));\n}\nasync function output() {\n    let out = await sleep(1000);\n    console.log(1);\n    return out;\n}\noutput();\n\n//ES5\nfunction sleep(callback, time) {\n    if (typeof callback === 'function') setTimeout(callback, time);\n}\n\nfunction output() {\n    console.log(1);\n}\nsleep(output, 1000);\n")),(0,l.kt)("h2",{id:"\u5176\u4ed6"},"\u5176\u4ed6"),(0,l.kt)("h3",{id:"\u5b9e\u73b0\u4e00\u4e2a-promise"},"\u5b9e\u73b0\u4e00\u4e2a Promise"),(0,l.kt)("p",null,"\u9996\u5148\u6211\u4eec\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684promise\u51fd\u6570:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u4e09\u4e2a\u72b6\u6001\uff1aPENDING\u3001FULFILLED\u3001REJECTED\nconst PENDING = 'PENDING';\nconst FULFILLED = 'FULFILLED';\nconst REJECTED = 'REJECTED';\n\nclass Promise {\n  constructor(executor) {\n    // \u9ed8\u8ba4\u72b6\u6001\u4e3a PENDING\n    this.status = PENDING;\n    // \u5b58\u653e\u6210\u529f\u72b6\u6001\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a undefined\n    this.value = undefined;\n    // \u5b58\u653e\u5931\u8d25\u72b6\u6001\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a undefined\n    this.reason = undefined;\n\n    // \u8c03\u7528\u6b64\u65b9\u6cd5\u5c31\u662f\u6210\u529f\n    let resolve = (value) => {\n      // \u72b6\u6001\u4e3a PENDING \u65f6\u624d\u53ef\u4ee5\u66f4\u65b0\u72b6\u6001\uff0c\u9632\u6b62 executor \u4e2d\u8c03\u7528\u4e86\u4e24\u6b21 resovle/reject \u65b9\u6cd5\n      if(this.status ===  PENDING) {\n        this.status = FULFILLED;\n        this.value = value;\n      }\n    } \n\n    // \u8c03\u7528\u6b64\u65b9\u6cd5\u5c31\u662f\u5931\u8d25\n    let reject = (reason) => {\n      // \u72b6\u6001\u4e3a PENDING \u65f6\u624d\u53ef\u4ee5\u66f4\u65b0\u72b6\u6001\uff0c\u9632\u6b62 executor \u4e2d\u8c03\u7528\u4e86\u4e24\u6b21 resovle/reject \u65b9\u6cd5\n      if(this.status ===  PENDING) {\n        this.status = REJECTED;\n        this.reason = reason;\n      }\n    }\n\n    try {\n      // \u7acb\u5373\u6267\u884c\uff0c\u5c06 resolve \u548c reject \u51fd\u6570\u4f20\u7ed9\u4f7f\u7528\u8005  \n      executor(resolve,reject)\n    } catch (error) {\n      // \u53d1\u751f\u5f02\u5e38\u65f6\u6267\u884c\u5931\u8d25\u903b\u8f91\n      reject(error)\n    }\n  }\n\n  // \u5305\u542b\u4e00\u4e2a then \u65b9\u6cd5\uff0c\u5e76\u63a5\u6536\u4e24\u4e2a\u53c2\u6570 onFulfilled\u3001onRejected\n  then(onFulfilled, onRejected) {\n    if (this.status === FULFILLED) {\n      onFulfilled(this.value)\n    }\n\n    if (this.status === REJECTED) {\n      onRejected(this.reason)\n    }\n  }\n}\n")),(0,l.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u57fa\u7840\u73ed\u7684proise, \u4f46\u662f\u6211\u4eec\u53ea\u5904\u7406\u4e86\u540c\u6b65\u64cd\u4f5c, \u800c\u6ca1\u6709\u5904\u7406\u5f02\u6b65\u64cd\u4f5c. \u8fdb\u884c\u9002\u5f53\u7684\u6539\u9020:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const PENDING = 'PENDING';\nconst FULFILLED = 'FULFILLED';\nconst REJECTED = 'REJECTED';\n\nclass Promise {\n  constructor(executor) {\n    this.status = PENDING;\n    this.value = undefined;\n    this.reason = undefined;\n    // \u5b58\u653e\u6210\u529f\u7684\u56de\u8c03\n    this.onResolvedCallbacks = [];\n    // \u5b58\u653e\u5931\u8d25\u7684\u56de\u8c03\n    this.onRejectedCallbacks= [];\n\n    let resolve = (value) => {\n      if(this.status ===  PENDING) {\n        this.status = FULFILLED;\n        this.value = value;\n        // \u4f9d\u6b21\u5c06\u5bf9\u5e94\u7684\u51fd\u6570\u6267\u884c\n        this.onResolvedCallbacks.forEach(fn=>fn());\n      }\n    } \n\n    let reject = (reason) => {\n      if(this.status ===  PENDING) {\n        this.status = REJECTED;\n        this.reason = reason;\n        // \u4f9d\u6b21\u5c06\u5bf9\u5e94\u7684\u51fd\u6570\u6267\u884c\n        this.onRejectedCallbacks.forEach(fn=>fn());\n      }\n    }\n\n    try {\n      executor(resolve,reject)\n    } catch (error) {\n      reject(error)\n    }\n  }\n\n  then(onFulfilled, onRejected) {\n    if (this.status === FULFILLED) {\n      onFulfilled(this.value)\n    }\n\n    if (this.status === REJECTED) {\n      onRejected(this.reason)\n    }\n\n    if (this.status === PENDING) {\n      // \u5982\u679cpromise\u7684\u72b6\u6001\u662f pending\uff0c\u9700\u8981\u5c06 onFulfilled \u548c onRejected \u51fd\u6570\u5b58\u653e\u8d77\u6765\uff0c\u7b49\u5f85\u72b6\u6001\u786e\u5b9a\u540e\uff0c\u518d\u4f9d\u6b21\u5c06\u5bf9\u5e94\u7684\u51fd\u6570\u6267\u884c\n      this.onResolvedCallbacks.push(() => {\n        onFulfilled(this.value)\n      });\n\n      // \u5982\u679cpromise\u7684\u72b6\u6001\u662f pending\uff0c\u9700\u8981\u5c06 onFulfilled \u548c onRejected \u51fd\u6570\u5b58\u653e\u8d77\u6765\uff0c\u7b49\u5f85\u72b6\u6001\u786e\u5b9a\u540e\uff0c\u518d\u4f9d\u6b21\u5c06\u5bf9\u5e94\u7684\u51fd\u6570\u6267\u884c\n      this.onRejectedCallbacks.push(()=> {\n        onRejected(this.reason);\n      })\n    }\n  }\n}\n")),(0,l.kt)("p",null,"\u6211\u4eec\u7528\u4e00\u4e2a\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f, \u5b9e\u73b0\u4e86: ",(0,l.kt)("inlineCode",{parentName:"p"},"\u6536\u96c6\u4f9d\u8d56 => \u89e6\u53d1\u901a\u77e5 => \u53d6\u51fa\u4f9d\u8d56\u6267\u884c"),". \u6210\u529f\u7684\u652f\u6301\u4e86\u5185\u90e8\u7684\u5f02\u6b65\u6267\u884c."),(0,l.kt)("p",null,"\u9664\u6b64\u4e4b\u5916, \u6211\u4eec\u77e5\u9053",(0,l.kt)("inlineCode",{parentName:"p"},"promise"),"\u7684\u4f18\u52bf\u5728\u4e8e\u94fe\u5f0f\u8c03\u7528, \u5728\u6211\u4eec\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"Promise"),"\u7684\u65f6\u5019, \u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u51fd\u6570\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"return"),"\u4e86\u4e00\u4e2a\u503c, \u6211\u4eec\u5c31\u80fd\u5728\u4e0b\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u4e2d\u83b7\u53d6\u5230, \u8fd9\u5c31\u662f\u6240\u8c13\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u7684\u94fe\u5f0f\u8c03\u7528. \u800c\u4e14, \u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"then()"),"\u4e3a\u7a7a\u7684\u65f6\u5019, \u540e\u9762\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u4f9d\u7136\u53ef\u4ee5\u83b7\u53d6\u524d\u9762\u7684\u503c. \u5373\u6240\u8c13\u7684",(0,l.kt)("strong",{parentName:"p"},"\u503c\u7684\u7a7f\u900f")),(0,l.kt)("p",null,"\u90a3\u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u7684\u5462? \u672c\u8d28\u4e0a\u5c31\u662f\u5728\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u7684\u65f6\u5019, \u91cd\u65b0\u521b\u5efa\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"promise"),"\u5bf9\u8c61, \u628a\u4e0a\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u7684\u8fd4\u56de\u7ed3\u679c\u4f20\u9012\u7ed9\u8fd9\u4e2a\u65b0\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"promise"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u65b9\u6cd5. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const PENDING = 'PENDING';\nconst FULFILLED = 'FULFILLED';\nconst REJECTED = 'REJECTED';\n\n/**\n *\n * @param {*} promise2 \u51c6\u5907\u88ab\u8fd4\u56de\u7684promise\u5bf9\u8c61\n * @param {*} x then\u51fd\u6570\u4e2d\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u6267\u884c\u7684\u7ed3\u679c\n * @param {*} resolve \u8fd4\u56de\u7684promise\u7684resolve\u65b9\u6cd5\n * @param {*} reject \u8fd4\u56de\u7684promise\u7684reject\u65b9\u6cd5\n */\nconst resolvePromise = (promise2, x, resolve, reject) => {\n    // \u81ea\u5df1\u7b49\u5f85\u81ea\u5df1\u5b8c\u6210\u662f\u9519\u8bef\u7684\u5b9e\u73b0, \u7528\u4e00\u4e2a\u7c7b\u578b\u9519\u8bef, \u7ed3\u675f\u6389promise\n    if (promise2 === x) {\n        return reject(\n            new TypeError('Chaining cycle detected for promise #<Promise>'),\n        );\n    }\n\n    // \u53ea\u80fd\u8c03\u7528\u4e00\u6b21\n    let called;\n    if ((typeof x === 'object' && x != null) || typeof x === 'function') {\n        // \u9650\u5236\u4e86x\u53ea\u80fd\u662f\u4e00\u4e2afunction\u6216\u8005\u5bf9\u8c61\n        try {\n            let then = x.then;\n            if (typeof then === 'function') {\n                then.call(\n                    x,\n                    y => {\n                        if (called) return;\n                        called = true;\n                        // \u9012\u5f52\u89e3\u6790\u7684\u8fc7\u7a0b\n                        resolvePromise(promise2, y, resolve, reject);\n                    },\n                    r => {\n                        // \u53ea\u8981\u5931\u8d25\u4e86, \u5c31\u662f\u554a\u6bd4\n                        if (called) return;\n                        called = true;\n                        reject(r);\n                    },\n                );\n            } else {\n                // \u5982\u679c x.then \u662f\u4e00\u4e2a\u666e\u901a\u503c, \u5c31\u76f4\u63a5\u8fd4\u56deresolve\u4f5c\u4e3a\u7ed3\u679c\n                resolve(x);\n            }\n        } catch (error) {\n            if (called) return;\n            called = true;\n            reject(e);\n        }\n    } else {\n        // \u5982\u679cx\u662f\u4e2a\u666e\u901a\u503c, \u5c31\u76f4\u63a5\u8fd4\u56deresolve\u4f5c\u4e3a\u7ed3\u679c\n        resolve(x);\n    }\n};\n\n// \u6536\u96c6\u4f9d\u8d56 => \u89e6\u53d1\u901a\u77e5 => \u53d6\u51fa\u4f9d\u8d56\u6267\u884c\nclass MyPromise {\n    constructor(executor) {\n        // \u5f53\u524d\u7684\u5de5\u4f5c\u72b6\u6001\n        this.status = PENDING;\n        // \u5b58\u653e\u6210\u529f\u7ed3\u679c\u7684\u503c\n        this.value = undefined;\n        // \u5b58\u653e\u5931\u8d25\u7ed3\u679c\u7684\u503c\n        this.reason = undefined;\n        // \u5b58\u653e\u6210\u529f\u7684\u56de\u8c03\n        this.onResolvedCallbacks = [];\n        // \u5b58\u653e\u5931\u8d25\u7684\u56de\u8c03\n        this.onRejectedCallbacks = [];\n\n        let resolve = value => {\n            if (this.status === PENDING) {\n                this.status = FULFILLED;\n                this.value = value;\n                // \u4f9d\u6b21\u5c06\u5bf9\u5e94\u7684\u51fd\u6570\u6267\u884c\n                this.onResolvedCallbacks.forEach(fn => fn());\n            }\n        };\n\n        let reject = reason => {\n            if (this.status === PENDING) {\n                this.status = REJECTED;\n                this.reason = reason;\n                // \u4f9d\u6b21\u5c06\u5bf9\u5e94\u7684\u51fd\u6570\u6267\u884c\n                this.onRejectedCallbacks.forEach(fn => fn());\n            }\n        };\n\n        try {\n            executor(resolve, reject);\n        } catch (error) {\n            reject(error);\n        }\n    }\n\n    then(onFulfilled, onRejected) {\n        // \u89e3\u51b3onFulfilled, onRejected \u6ca1\u6709\u4f20\u503c\u7684\u95ee\u9898\n        onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v => v;\n        // \u56e0\u4e3a\u9519\u8bef\u7684\u503c\u8981\u8ba9\u540e\u9762\u8bbf\u95ee\u5230, \u6240\u4ee5\u8fd9\u91cc\u4e5f\u8981\u629b\u51fa\u4e00\u4e2a\u9519\u8bef, \u5426\u5219\u4f1a\u5728\u4e4b\u540e\u7684then\u7684resolve\u4e2d\u88ab\u6355\u83b7\n        onRejected = typeof onRejected === 'function' ? onRejected : v => v;\n\n        // \u6bcf\u6b21\u8c03\u7528then\u90fd\u8981\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684promise\n        let promise2 = new MyPromise((resolve, reject) => {\n            // \u8fd9\u90e8\u5206\u4ee3\u7801\u662f\u76f4\u63a5\u6267\u884c\u7684, \u7528setTimeout\u5b9e\u73b0\u5f02\u6b65\n            // promise \u5df2\u5b8c\u6210\u7684\u60c5\u51b5\n            if (this.status === FULFILLED) {\n                setTimeout(() => {\n                    try {\n                        // \u83b7\u53d6onFulfilled\u5f97\u5230\u7684\u503c\n                        let x = onFulfilled(this.value);\n                        resolvePromise(promise2, x, resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                }, 0);\n            }\n\n            if (this.status === REJECTED) {\n                setTimeout(() => {\n                    try {\n                        let x = onRejected(this.reason);\n                        resolvePromise(promise2, x, resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                }, 0);\n            }\n\n            if (this.status === PENDING) {\n                this.onResolvedCallbacks.push(() => {\n                    setTimeout(() => {\n                        try {\n                            let x = onFulfilled(this.value);\n                            resolvePromise(promise2, x, resolve, reject);\n                        } catch (e) {\n                            reject(e);\n                        }\n                    }, 0);\n                });\n\n                this.onRejectedCallbacks.push(() => {\n                    setTimeout(() => {\n                        try {\n                            let x = onRejected(this.reason);\n                            resolvePromise(promise2, x, resolve, reject);\n                        } catch (e) {\n                            reject(e);\n                        }\n                    }, 0);\n                });\n            }\n        });\n        return promise2;\n    }\n}\n\nconst promise = new MyPromise((resolve, reject) => {\n    reject('\u5931\u8d25');\n}).then().then(\n    data => {\n        console.log(data);\n    },\n    err => {\n        console.log('err', err);\n    },\n);\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u8fd4\u56depromise\u7684\u903b\u8f91\u4e5f\u597d\u7406\u89e3, \u4e0d\u8fc7\u5176\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"resolvePromise"),"\u51fd\u6570\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\u5462?"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"let then = x.then;\n// \u8fd9\u91cc\u8868\u793a\u6709then\u65b9\u6cd5, \u5219x\u5e94\u8be5\u662f\u4e00\u4e2apromise\nif (typeof then === 'function') {\n    then.call(\n        x,\n        y => {\n            if (called) return;\n            called = true;\n            // \u9012\u5f52\u89e3\u6790\u7684\u8fc7\u7a0b\n            resolvePromise(promise2, y, resolve, reject);\n        },\n        r => {\n            // \u53ea\u8981\u5931\u8d25\u4e86, \u5c31\u662f\u554a\u6bd4\n            if (called) return;\n            called = true;\n            reject(r);\n        },\n    );\n} else {\n    // \u5982\u679c x.then \u662f\u4e00\u4e2a\u666e\u901a\u503c, \u5c31\u76f4\u63a5\u8fd4\u56deresolve\u4f5c\u4e3a\u7ed3\u679c\n    resolve(x);\n}\n")),(0,l.kt)("p",null,"x\u662f\u6211\u4eec\u6267\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"resolve"),"\u540e\u83b7\u53d6\u7684\u503c, \u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"x"),"\u4e0a\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u4e14\u8be5",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u53ef\u4ee5\u8c03\u7528, \u6211\u4eec\u5c31\u8ba4\u4e3ax\u5c31\u662f\u4e00\u4e2apromise, \u6240\u4ee5\u5728\u8fd9\u91cc\u5bf9x\u8fdb\u884c\u8c03\u7528, \u83b7\u53d6\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"x"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u4e2d\u7684\u503c, \u5e76\u4e14\u8fdb\u884c\u9012\u5f52, \u76f4\u5230\u83b7\u53d6\u5230\u4e00\u4e2a\u666e\u901a\u7684\u975epromise\u503c\u4e3a\u6b62"),(0,l.kt)("p",null,"\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u628ax\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"then"),"\u65b9\u6cd5. "),(0,l.kt)("p",null,"Promise\u7684\u4e3b\u9898\u5185\u5bb9\u4ee3\u7801\u5c31\u5b8c\u6210\u4e86, \u63a5\u4e0b\u53bb\u8865\u5145\u4e00\u4e9bAPI:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"promise.resolve: \u9ed8\u8ba4\u4ea7\u751f\u4e00\u4e2a\u6210\u529f\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"promise"),":")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"static resolve(data){\n  return new Promise((resolve,reject)=>{\n    resolve(data);\n  })\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"promise.reject:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"static reject(reason){\n  return new Promise((resolve,reject)=>{\n    reject(reason);\n  })\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"promise.finally:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Promise.prototype.finally = function(callback) {\n  return this.then((value)=>{\n    return Promise.resolve(callback()).then(()=>value)\n  },(reason)=>{\n    return Promise.resolve(callback()).then(()=>{throw reason})\n  })  \n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"promise.all:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Promise.all = function(values) {\n  if (!Array.isArray(values)) {\n    const type = typeof values;\n    return new TypeError(`TypeError: ${type} ${values} is not iterable`)\n  }\n  return new Promise((resolve, reject) => {\n    let resultArr = [];\n    let orderIndex = 0;\n    const processResultByKey = (value, index) => {\n      resultArr[index] = value;\n      if (++orderIndex === values.length) {\n          resolve(resultArr)\n      }\n    }\n    for (let i = 0; i < values.length; i++) {\n      let value = values[i];\n      if (value && typeof value.then === 'function') {\n        value.then((value) => {\n          processResultByKey(value, i);\n        }, reject);\n      } else {\n        processResultByKey(value, i);\n      }\n    }\n  });\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"promise.race:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Promise.race = function(promises) {\n  return new Promise((resolve, reject) => {\n    // \u4e00\u8d77\u6267\u884c\u5c31\u662ffor\u5faa\u73af\n    for (let i = 0; i < promises.length; i++) {\n      let val = promises[i];\n      if (val && typeof val.then === 'function') {\n        val.then(resolve, reject);\n      } else { // \u666e\u901a\u503c\n        resolve(val)\n      }\n    }\n  });\n}\n")),(0,l.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://es6.ruanyifeng.com/#docs/async"},"\u962e\u4e00\u5cf0\u7684 ES \u5165\u95e8")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/getify/You-Dont-Know-JS/blob/master/async%20%26%20performance/ch4.md"},"\u4f60\u4e0d\u77e5\u9053\u7684 js async & performance")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/183801144"},"\u9762\u8bd5\u5b98\uff1a\u201c\u4f60\u80fd\u624b\u5199\u4e00\u4e2a Promise \u5417\u201d"))))}c.isMDXComponent=!0}}]);