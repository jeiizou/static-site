"use strict";(self.webpackChunk_jeiiz_wiki_site=self.webpackChunk_jeiiz_wiki_site||[]).push([[8113],{50158:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>c});var l=t(46393);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,l,o=function(e,n){if(null==e)return{};var t,l,o={},a=Object.keys(e);for(l=0;l<a.length;l++)t=a[l],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)t=a[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=l.createContext({}),d=function(e){var n=l.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=d(e.components);return l.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},m=l.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=d(t),c=o,f=m["".concat(s,".").concat(c)]||m[c]||u[c]||a;return t?l.createElement(f,r(r({ref:n},p),{},{components:t})):l.createElement(f,r({ref:n},p))}));function c(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,r=new Array(a);r[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var d=2;d<a;d++)r[d]=t[d];return l.createElement.apply(null,r)}return l.createElement.apply(null,t)}m.displayName="MDXCreateElement"},76930:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var l=t(39421),o=(t(46393),t(50158));const a={},r="Node-\u6a21\u5757\u673a\u5236",i={unversionedId:"\u524d\u7aef\u57fa\u7840/Node/Node-\u6a21\u5757\u673a\u5236",id:"\u524d\u7aef\u57fa\u7840/Node/Node-\u6a21\u5757\u673a\u5236",title:"Node-\u6a21\u5757\u673a\u5236",description:"CommonJS",source:"@site/docs/01-\u524d\u7aef\u57fa\u7840/05-Node/02-Node-\u6a21\u5757\u673a\u5236.md",sourceDirName:"01-\u524d\u7aef\u57fa\u7840/05-Node",slug:"/\u524d\u7aef\u57fa\u7840/Node/Node-\u6a21\u5757\u673a\u5236",permalink:"/docs/\u524d\u7aef\u57fa\u7840/Node/Node-\u6a21\u5757\u673a\u5236",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Node-npm\u539f\u7406",permalink:"/docs/\u524d\u7aef\u57fa\u7840/Node/Node-npm\u539f\u7406"},next:{title:"Node-\u8fdb\u7a0b",permalink:"/docs/\u524d\u7aef\u57fa\u7840/Node/Node-\u8fdb\u7a0b"}},s={},d=[{value:"CommonJS",id:"commonjs",level:2},{value:"\u6a21\u5757\u52a0\u8f7d\u6982\u89c8",id:"\u6a21\u5757\u52a0\u8f7d\u6982\u89c8",level:2},{value:"requier \u7684\u52a0\u8f7d\u89c4\u5219",id:"requier-\u7684\u52a0\u8f7d\u89c4\u5219",level:2},{value:"Module \u6e90\u7801\u6982\u89c8",id:"module-\u6e90\u7801\u6982\u89c8",level:2},{value:"Module._load",id:"module_load",level:3},{value:"Module.__resolveFilename",id:"module__resolvefilename",level:3},{value:"Module._findPath",id:"module_findpath",level:3},{value:"Module.load",id:"moduleload",level:3},{value:"Module.__compile",id:"module__compile",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"\u5982\u4f55\u6e05\u9664 require\u7f13\u5b58",id:"\u5982\u4f55\u6e05\u9664-require\u7f13\u5b58",level:3},{value:"<code>exports.xxx=xxx</code>\u548c<code>module.exports={}</code>\u7684\u533a\u522b",id:"exportsxxxxxx\u548cmoduleexports\u7684\u533a\u522b",level:3},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],p={toc:d};function u(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,l.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"node-\u6a21\u5757\u673a\u5236"},"Node-\u6a21\u5757\u673a\u5236"),(0,o.kt)("h2",{id:"commonjs"},"CommonJS"),(0,o.kt)("p",null,"\u4f7f\u7528\u793a\u4f8b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//test.js\n//\u5f15\u5165\u4e00\u4e2a\u6a21\u5757\u5230\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\nconst math = require('math');\nmath.add(1, 2);\n\n//math.js\nexports.add = function () {\n \xa0 \xa0let sum = 0, i = 0, args = arguments, l = args.length;\n \xa0 \xa0while(i < l) {\n \xa0 \xa0 \xa0 \xa0sum += args[i++];\n \xa0  }\n \xa0 \xa0return sum;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6a21\u5757\u6807\u8bc6"),"\u6307\u7684\u5c31\u662f\u4f20\u9012\u7ed9",(0,o.kt)("inlineCode",{parentName:"p"},"require()"),"\u65b9\u6cd5\u7684\u53c2\u6570, \u5fc5\u987b\u662f\u5c0f\u9a7c\u5cf0\u547d\u540d\u7684\u5b57\u7b26\u4e32, \u6216\u8005\u4ee5",(0,o.kt)("inlineCode",{parentName:"p"},"."),",",(0,o.kt)("inlineCode",{parentName:"p"},".."),"\u5f00\u5934\u7684\u76f8\u5bf9\u8def\u5f84\u6216\u8005\u7edd\u5bf9\u8def\u5f84, \u53ef\u4ee5\u7701\u7565\u6587\u4ef6\u540e\u7f00\u540d",(0,o.kt)("inlineCode",{parentName:"p"},".js"),"\u7b49. "),(0,o.kt)("h2",{id:"\u6a21\u5757\u52a0\u8f7d\u6982\u89c8"},"\u6a21\u5757\u52a0\u8f7d\u6982\u89c8"),(0,o.kt)("p",null,"\u5728Node\u4e2d\u5f15\u5165\u6a21\u5757, \u9700\u8981\u7ecf\u5386\u56db\u4e2a\u6b65\u9aa4:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u8def\u5f84\u5206\u6790"),(0,o.kt)("li",{parentName:"ol"},"\u6587\u4ef6\u5b9a\u4f4d"),(0,o.kt)("li",{parentName:"ol"},"\u7f16\u8bd1\u6267\u884c"),(0,o.kt)("li",{parentName:"ol"},"\u52a0\u5165\u5185\u5b58")),(0,o.kt)("p",null,"\u5176\u4e2d, \u8def\u5f84\u5206\u6790\u548c\u6587\u4ef6\u5b9a\u4f4d\u53ef\u4ee5\u4e00\u8d77\u8bf4."),(0,o.kt)("p",null,"Node\u4e2d\u7684\u6a21\u5757\u5206\u4e3a\u4e24\u79cd:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u6a21\u5757: Node\u81ea\u8eab\u63d0\u4f9b\u7684\u6a21\u5757, \u5728Node\u7684\u8fdb\u7a0b\u5f00\u59cb\u7684\u65f6\u5019\u5c31\u9884\u52a0\u8f7d\u4e86"),(0,o.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u6a21\u5757: \u7528\u6237\u7f16\u5199\u7684\u6a21\u5757, \u5305\u62ecnpm\u5b89\u88c5\u7684\u7b2c\u4e09\u65b9\u6a21\u5757. ")),(0,o.kt)("h2",{id:"requier-\u7684\u52a0\u8f7d\u89c4\u5219"},"requier \u7684\u52a0\u8f7d\u89c4\u5219"),(0,o.kt)("p",null,"\u5047\u8bbe\u5728Y\u8def\u5f84\u7684js\u6587\u4ef6\u4e2d\u6267\u884c\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"require(X)"),", \u5176\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b(\u8fd9\u90e8\u5206\u5185\u5bb9\u6765\u81ea",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/api/modules.html#modules_all_together"},"Node\u4f7f\u7528\u624b\u518c"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'require(X) from module at path Y\n1. If X is a core module,\n   a. return the core module\n   b. STOP\n2. If X begins with \'/\'\n   a. set Y to be the filesystem root\n3. If X begins with \'./\' or \'/\' or \'../\'\n   a. LOAD_AS_FILE(Y + X)\n   b. LOAD_AS_DIRECTORY(Y + X)\n   c. THROW "not found"\n4. If X begins with \'#\'\n   a. LOAD_PACKAGE_IMPORTS(X, dirname(Y))\n5. LOAD_PACKAGE_SELF(X, dirname(Y))\n6. LOAD_NODE_MODULES(X, dirname(Y))\n7. THROW "not found"\n\nLOAD_AS_FILE(X)\n1. If X is a file, load X as its file extension format. STOP\n2. If X.js is a file, load X.js as JavaScript text. STOP\n3. If X.json is a file, parse X.json to a JavaScript Object. STOP\n4. If X.node is a file, load X.node as binary addon. STOP\n\nLOAD_INDEX(X)\n1. If X/index.js is a file, load X/index.js as JavaScript text. STOP\n2. If X/index.json is a file, parse X/index.json to a JavaScript object. STOP\n3. If X/index.node is a file, load X/index.node as binary addon. STOP\n\nLOAD_AS_DIRECTORY(X)\n1. If X/package.json is a file,\n   a. Parse X/package.json, and look for "main" field.\n   b. If "main" is a falsy value, GOTO 2.\n   c. let M = X + (json main field)\n   d. LOAD_AS_FILE(M)\n   e. LOAD_INDEX(M)\n   f. LOAD_INDEX(X) DEPRECATED\n   g. THROW "not found"\n2. LOAD_INDEX(X)\n\nLOAD_NODE_MODULES(X, START)\n1. let DIRS = NODE_MODULES_PATHS(START)\n2. for each DIR in DIRS:\n   a. LOAD_PACKAGE_EXPORTS(X, DIR)\n   b. LOAD_AS_FILE(DIR/X)\n   c. LOAD_AS_DIRECTORY(DIR/X)\n\nNODE_MODULES_PATHS(START)\n1. let PARTS = path split(START)\n2. let I = count of PARTS - 1\n3. let DIRS = [GLOBAL_FOLDERS]\n4. while I >= 0,\n   a. if PARTS[I] = "node_modules" CONTINUE\n   b. DIR = path join(PARTS[0 .. I] + "node_modules")\n   c. DIRS = DIRS + DIR\n   d. let I = I - 1\n5. return DIRS\n\nLOAD_PACKAGE_IMPORTS(X, DIR)\n1. Find the closest package scope SCOPE to DIR.\n2. If no scope was found, return.\n3. If the SCOPE/package.json "imports" is null or undefined, return.\n4. let MATCH = PACKAGE_IMPORTS_RESOLVE(X, pathToFileURL(SCOPE),\n  ["node", "require"]) defined in the ESM resolver.\n5. RESOLVE_ESM_MATCH(MATCH).\n\nLOAD_PACKAGE_EXPORTS(X, DIR)\n1. Try to interpret X as a combination of NAME and SUBPATH where the name\n   may have a @scope/ prefix and the subpath begins with a slash (`/`).\n2. If X does not match this pattern or DIR/NAME/package.json is not a file,\n   return.\n3. Parse DIR/NAME/package.json, and look for "exports" field.\n4. If "exports" is null or undefined, return.\n5. let MATCH = PACKAGE_EXPORTS_RESOLVE(pathToFileURL(DIR/NAME), "." + SUBPATH,\n   `package.json` "exports", ["node", "require"]) defined in the ESM resolver.\n6. RESOLVE_ESM_MATCH(MATCH)\n\nLOAD_PACKAGE_SELF(X, DIR)\n1. Find the closest package scope SCOPE to DIR.\n2. If no scope was found, return.\n3. If the SCOPE/package.json "exports" is null or undefined, return.\n4. If the SCOPE/package.json "name" is not the first segment of X, return.\n5. let MATCH = PACKAGE_EXPORTS_RESOLVE(pathToFileURL(SCOPE),\n   "." + X.slice("name".length), `package.json` "exports", ["node", "require"])\n   defined in the ESM resolver.\n6. RESOLVE_ESM_MATCH(MATCH)\n\nRESOLVE_ESM_MATCH(MATCH)\n1. let { RESOLVED, EXACT } = MATCH\n2. let RESOLVED_PATH = fileURLToPath(RESOLVED)\n3. If EXACT is true,\n   a. If the file at RESOLVED_PATH exists, load RESOLVED_PATH as its extension\n      format. STOP\n4. Otherwise, if EXACT is false,\n   a. LOAD_AS_FILE(RESOLVED_PATH)\n   b. LOAD_AS_DIRECTORY(RESOLVED_PATH)\n5. THROW "not found"\n')),(0,o.kt)("p",null,"\u4e3e\u4e2a\u4f8b\u5b50, \u6bd4\u5982\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"/home/ry/projects/foo.js"),"\u6267\u884c\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"require('bar')"),", Node\u7684\u8fd0\u884c\u8fc7\u7a0b\u5982\u4e0b:"),(0,o.kt)("p",null,"\u9996\u5148, \u786e\u5b9aX\u7684\u7edd\u5bf9\u8def\u5f84\u53ef\u80fd\u662f\u4e0b\u9762\u8fd9\u4e9b\u4f4d\u7f6e, \u4e00\u6b21\u641c\u7d22\u6bcf\u4e00\u4e2a\u76ee\u5f55:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/home/ry/projects/node_modules/bar\n/home/ry/node_modules/bar\n/home/node_modules/bar\n/node_modules/bar\n")),(0,o.kt)("p",null,"\u641c\u7d22\u7684\u65f6\u5019, \u5148\u628a",(0,o.kt)("inlineCode",{parentName:"p"},"bar"),"\u5f53\u6210\u6587\u4ef6\u540d, \u4f9d\u6b21\u5c1d\u8bd5\u52a0\u8f7d\u4e0b\u9762\u8fd9\u4e9b\u6587\u4ef6, \u53ea\u8981\u6709\u6210\u529f\u5c31\u8fd4\u56de:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"bar\nbar.js\nbar.json\nbar.node\n")),(0,o.kt)("p",null,"\u5982\u679c\u90fd\u4e0d\u6210\u529f, \u5219\u8bf4\u660e",(0,o.kt)("inlineCode",{parentName:"p"},"bar"),"\u53ef\u80fd\u662f\u76ee\u5f55\u540d, \u4e8e\u662f\u4e00\u6b21\u5c1d\u8bd5\u52a0\u8f7d\u4e0b\u9762\u8fd9\u4e9b\u6587\u4ef6:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"bar/package.json\uff08main\u5b57\u6bb5\uff09\nbar/index.js\nbar/index.json\nbar/index.node\n")),(0,o.kt)("p",null,"\u5982\u679c\u6240\u6709\u76ee\u5f55\u4e2d, \u90fd\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u6216\u8005\u76ee\u5f55, \u5c31\u629b\u51fa\u4e00\u4e2a\u9519\u8bef. "),(0,o.kt)("h2",{id:"module-\u6e90\u7801\u6982\u89c8"},"Module \u6e90\u7801\u6982\u89c8"),(0,o.kt)("p",null,"\u5728 Node \u4e2d, \u6bcf\u4e2a\u6587\u4ef6\u6a21\u5757\u90fd\u662f\u4e00\u4e2a\u5bf9\u8c61, \u5b83\u7684\u5b9a\u4e49\u5982\u4e0b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function Module(id, parent) {\n  this.id = id;\n  this.exports = {};\n  this.parent = parent;\n  this.filename = null;\n  this.loaded = false;\n  this.children = [];\n}\n\nmodule.exports = Module;\n\nvar module = new Module(filename, parent);\n")),(0,o.kt)("p",null,"\u6240\u6709\u7684\u6a21\u5757\u90fd\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"Module"),"\u7684\u5b9e\u4f8b. "),(0,o.kt)("h3",{id:"module_load"},"Module._load"),(0,o.kt)("p",null,"\u5e76\u4e14",(0,o.kt)("inlineCode",{parentName:"p"},"require()"),"\u65b9\u6cd5\u5176\u5b9e\u5185\u90e8\u8c03\u7528\u7684\u4e5f\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"Module._load"),"\u65b9\u6cd5:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// require \u5176\u5b9e\u5185\u90e8\u8c03\u7528Module._load\u65b9\u6cd5\nModule._load=function(request,parentm, isMain){\n    // \u8ba1\u7b97\u7edd\u5bf9\u8def\u5f84\n    var filename=Module._resolveFilename(request, parent);\n\n    // \u7b2c\u4e00\u6b65: \u5982\u679c\u6709\u7f13\u5b58, \u53d6\u51fa\u7f13\u5b58\n    var cacheModule = Module._cache[filename];\n    if(cacheModule){\n        return cacheModule.exports;\n    }\n\n    // \u7b2c\u4e8c\u6b65: \u662f\u5426\u4e3a\u5185\u7f6e\u6a21\u5757\n    if(NativeModule.exists(filename)){\n        return NativeModule.require(filename);\n    }\n\n    // \u7b2c\u4e09\u6b65: \u751f\u6210\u6a21\u5757\u5b9e\u4f8b, \u5b58\u5165\u7f13\u5b58\n    // \u8fd9\u91cc\u7684MOdule\u5c31\u662f\u4e0a\u9762\u4e00\u5c0f\u8282\u4e2d\u5b9a\u4e49\u7684Module\n    var module = new Module(filename, parent);\n    Module._cache[filename] = module;\n\n    // \u7b2c\u56db\u6b65: \u52a0\u8f7d\u6a21\u5757\n    // \u4e0b\u9762\u7684module.load\u5b9e\u9645\u4e0a\u662fModule\u539f\u578b\u4e0a\u6709\u4e00\u4e2a\u65b9\u6cd5\u53ebModule.prototype.load\n    try {\n        module.load(filename);\n        hadException = false;\n    } finally {\n        if (hadException) {\n        delete Module._cache[filename];\n        }\n    }\n\n    // \u7b2c\u4e94\u6b65\uff1a\u8f93\u51fa\u6a21\u5757\u7684exports\u5c5e\u6027\n    return module.exports;\n}\n")),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5728require\u7684\u8fc7\u7a0b\u4e2d, \u662f\u4f1a\u7f13\u5b58\u5df2\u7ecf\u52a0\u8f7d\u7684\u6a21\u5757\u7684, \u8fd9\u6837\u5728\u540e\u9762\u7684\u65f6\u5019, \u5c31\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u91cd\u65b0\u641c\u7d22\u548c\u5904\u7406\u6587\u4ef6\u8def\u5f84\u4e86. "),(0,o.kt)("h3",{id:"module__resolvefilename"},"Module.__resolveFilename"),(0,o.kt)("p",null,"\u5176\u4e2d, ",(0,o.kt)("inlineCode",{parentName:"p"},"Module.__resolveFilename"),"\u7684\u6e90\u7801\u5982\u4e0b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Module._resolveFilename = function(request, parent) {\n  // \u7b2c\u4e00\u6b65\uff1a\u5982\u679c\u662f\u5185\u7f6e\u6a21\u5757\uff0c\u4e0d\u542b\u8def\u5f84\u8fd4\u56de\n  if (NativeModule.exists(request)) {\n    return request;\n  }\n\n  // \u7b2c\u4e8c\u6b65\uff1a\u786e\u5b9a\u6240\u6709\u53ef\u80fd\u7684\u8def\u5f84\n  var resolvedModule = Module._resolveLookupPaths(request, parent);\n  var id = resolvedModule[0];\n  var paths = resolvedModule[1];\n\n  // \u7b2c\u4e09\u6b65\uff1a\u786e\u5b9a\u54ea\u4e00\u4e2a\u8def\u5f84\u4e3a\u771f\n  var filename = Module._findPath(request, paths);\n  if (!filename) {\n    var err = new Error(\"Cannot find module '\" + request + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  }\n  return filename;\n};\n")),(0,o.kt)("p",null,"\u5728\u8be5\u65b9\u6cd5\u5185\u90e8\u8c03\u7528\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"Module.resolveLookupPaths"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"Module._findPath()"),", \u524d\u8005\u7528\u6765\u5217\u51fa\u53ef\u80fd\u7684\u8def\u5f84, \u540e\u8005\u7528\u6765\u786e\u8ba4\u90a3\u4e2a\u8def\u5f84\u662f\u5bf9\u7684:"),(0,o.kt)("h3",{id:"module_findpath"},"Module._findPath"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"_findPath"),"\u7684\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Module._findPath = function(request, paths) {\n\n  // \u5217\u51fa\u6240\u6709\u53ef\u80fd\u7684\u540e\u7f00\u540d\uff1a.js\uff0c.json, .node\n  var exts = Object.keys(Module._extensions);\n\n  // \u5982\u679c\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5c31\u4e0d\u518d\u641c\u7d22\n  if (request.charAt(0) === '/') {\n    paths = [''];\n  }\n\n  // \u662f\u5426\u6709\u540e\u7f00\u7684\u76ee\u5f55\u659c\u6760\n  var trailingSlash = (request.slice(-1) === '/');\n\n  // \u7b2c\u4e00\u6b65\uff1a\u5982\u679c\u5f53\u524d\u8def\u5f84\u5df2\u5728\u7f13\u5b58\u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7f13\u5b58\n  var cacheKey = JSON.stringify({request: request, paths: paths});\n  if (Module._pathCache[cacheKey]) {\n    return Module._pathCache[cacheKey];\n  }\n\n  // \u7b2c\u4e8c\u6b65\uff1a\u4f9d\u6b21\u904d\u5386\u6240\u6709\u8def\u5f84\n  for (var i = 0, PL = paths.length; i < PL; i++) {\n    var basePath = path.resolve(paths[i], request);\n    var filename;\n\n    if (!trailingSlash) {\n      // \u7b2c\u4e09\u6b65\uff1a\u662f\u5426\u5b58\u5728\u8be5\u6a21\u5757\u6587\u4ef6\n      filename = tryFile(basePath);\n\n      if (!filename && !trailingSlash) {\n        // \u7b2c\u56db\u6b65\uff1a\u8be5\u6a21\u5757\u6587\u4ef6\u52a0\u4e0a\u540e\u7f00\u540d\uff0c\u662f\u5426\u5b58\u5728\n        filename = tryExtensions(basePath, exts);\n      }\n    }\n\n    // \u7b2c\u4e94\u6b65\uff1a\u76ee\u5f55\u4e2d\u662f\u5426\u5b58\u5728 package.json \n    if (!filename) {\n      filename = tryPackage(basePath, exts);\n    }\n\n    if (!filename) {\n      // \u7b2c\u516d\u6b65\uff1a\u662f\u5426\u5b58\u5728\u76ee\u5f55\u540d + index + \u540e\u7f00\u540d \n      filename = tryExtensions(path.resolve(basePath, 'index'), exts);\n    }\n\n    // \u7b2c\u4e03\u6b65\uff1a\u5c06\u627e\u5230\u7684\u6587\u4ef6\u8def\u5f84\u5b58\u5165\u8fd4\u56de\u7f13\u5b58\uff0c\u7136\u540e\u8fd4\u56de\n    if (filename) {\n      Module._pathCache[cacheKey] = filename;\n      return filename;\n    }\n  }\n\n  // \u7b2c\u516b\u6b65\uff1a\u6ca1\u6709\u627e\u5230\u6587\u4ef6\uff0c\u8fd4\u56defalse \n  return false;\n};\n")),(0,o.kt)("h3",{id:"moduleload"},"Module.load"),(0,o.kt)("p",null,"\u6709\u4e86\u6a21\u5757\u7684\u7edd\u5bf9\u8def\u5f84, \u5c31\u53ef\u4ee5\u52a0\u8f7d\u8be5\u6a21\u5757\u4e86:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Module.prototype.load = function(filename) {\n  var extension = path.extname(filename) || '.js';\n  if (!Module._extensions[extension]) extension = '.js';\n  Module._extensions[extension](this, filename);\n  this.loaded = true;\n};\n")),(0,o.kt)("p",null,"\u9996\u5148\u786e\u5b9a\u6a21\u5757\u7684\u540e\u7f00\u540d, \u4e0d\u540c\u7684\u540e\u7f00\u540d\u5bf9\u5e94\u4e0d\u540c\u7684\u52a0\u8f7d\u65b9\u6cd5, \u6bd4\u5982",(0,o.kt)("inlineCode",{parentName:"p"},".js"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},".json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Module._extensions['.js'] = function(module, filename) {\n  var content = fs.readFileSync(filename, 'utf8');\n  module._compile(stripBOM(content), filename);\n};\n\nModule._extensions['.json'] = function(module, filename) {\n  var content = fs.readFileSync(filename, 'utf8');\n  try {\n    module.exports = JSON.parse(stripBOM(content));\n  } catch (err) {\n    err.message = filename + ': ' + err.message;\n    throw err;\n  }\n};\n")),(0,o.kt)("p",null,"\u4ee5",(0,o.kt)("inlineCode",{parentName:"p"},".js"),"\u6587\u4ef6\u7684\u52a0\u8f7d\u4e3a\u4f8b, \u9996\u5148, \u5c06\u6a21\u5757\u6587\u4ef6\u8bfb\u53d6\u4e3a\u5b57\u7b26\u4e32, \u7136\u540e\u5265\u79bb",(0,o.kt)("inlineCode",{parentName:"p"},"utf8"),"\u7f16\u7801\u7279\u6709\u7684BOM\u6587\u4ef6\u5934, \u6700\u540e\u7f16\u8bd1\u8be5\u6a21\u5757."),(0,o.kt)("h3",{id:"module__compile"},"Module.__compile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Module.prototype._compile = function(content, filename) {\n  var self = this;\n  var args = [self.exports, require, self, filename, dirname];\n  return compiledWrapper.apply(self.exports, args);\n};\n")),(0,o.kt)("p",null,"\u7b49\u540c\u4e8e:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"(function (exports, require, module, __filename, __dirname) {\n  // \u6a21\u5757\u6e90\u7801\n});\n")),(0,o.kt)("p",null,"\u672c\u8d28\u4e0a\u5c31\u662f\u6ce8\u5165\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"export"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"require"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"module"),"\u4e09\u4e2a\u6a21\u5757. "),(0,o.kt)("h2",{id:"\u5e38\u89c1\u95ee\u9898"},"\u5e38\u89c1\u95ee\u9898"),(0,o.kt)("h3",{id:"\u5982\u4f55\u6e05\u9664-require\u7f13\u5b58"},"\u5982\u4f55\u6e05\u9664 require\u7f13\u5b58"),(0,o.kt)("p",null,"\u5f00\u53d1node\u7684\u65f6\u5019\u4f1a\u9762\u4e34\u4e00\u4e2a\u95ee\u9898, \u5982\u679c\u4fee\u6539\u4e86\u914d\u7f6e\u6570\u636e, \u5fc5\u987b\u91cd\u542f\u670d\u52a1\u5668\u624d\u80fd\u770b\u5230\u4fee\u6539\u7684\u7ed3\u679c. \u8fd9\u662f\u56e0\u4e3a\u6a21\u5757\u7f13\u5b58\u7684\u539f\u56e0. "),(0,o.kt)("p",null,"\u53ef\u4ee5\u8fd9\u6837\u5220\u9664\u7f13\u5b58:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"delete require.cache[require.resolve('./server.js')];\napp = require('./server.js');\n")),(0,o.kt)("h3",{id:"exportsxxxxxx\u548cmoduleexports\u7684\u533a\u522b"},(0,o.kt)("inlineCode",{parentName:"h3"},"exports.xxx=xxx"),"\u548c",(0,o.kt)("inlineCode",{parentName:"h3"},"module.exports={}"),"\u7684\u533a\u522b"),(0,o.kt)("p",null,"\u5f88\u591a\u65f6\u5019\uff0c\u4f60\u4f1a\u770b\u5230\uff0c\u5728Node\u73af\u5883\u4e2d\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5728\u4e00\u4e2a\u6a21\u5757\u4e2d\u8f93\u51fa\u53d8\u91cf\uff1a"),(0,o.kt)("p",null,"\u65b9\u6cd5\u4e00\uff1a\u5bf9module.exports\u8d4b\u503c:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function hello() {\n    console.log('Hello, world!');\n}\n\nfunction greet(name) {\n    console.log('Hello, ' + name + '!');\n}\n\nmodule.exports = {\n    hello: hello,\n    greet: greet\n};\n")),(0,o.kt)("p",null,"\u65b9\u6cd5\u4e8c: \u76f4\u63a5\u4f7f\u7528exports"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// hello.js\nfunction hello() {\n    console.log('Hello, world!');\n}\n\nfunction greet(name) {\n    console.log('Hello, ' + name + '!');\n}\n\nfunction hello() {\n    console.log('Hello, world!');\n}\n\nexports.hello = hello;\nexports.greet = greet;\n\n// \u4f46\u662f\u4f60\u4e0d\u53ef\u4ee5\u76f4\u63a5\u5bf9exports\u8d4b\u503c\uff1a\n// \u4ee3\u7801\u53ef\u4ee5\u6267\u884c\uff0c\u4f46\u662f\u6a21\u5757\u5e76\u6ca1\u6709\u8f93\u51fa\u4efb\u4f55\u53d8\u91cf:\nexports = {\n    hello: hello,\n    greet: greet\n};\n")),(0,o.kt)("p",null,"\u5982\u679c\u4f60\u5bf9\u4e0a\u9762\u7684\u5199\u6cd5\u611f\u5230\u5341\u5206\u56f0\u60d1\uff0c\u4e0d\u8981\u7740\u6025\uff0c\u6211\u4eec\u6765\u5206\u6790Node\u7684\u52a0\u8f7d\u673a\u5236\uff1a"),(0,o.kt)("p",null,"\u9996\u5148\uff0cNode\u4f1a\u628a\u6574\u4e2a\u5f85\u52a0\u8f7d\u7684hello.js\u6587\u4ef6\u653e\u5165\u4e00\u4e2a\u5305\u88c5\u51fd\u6570load\u4e2d\u6267\u884c\u3002\u5728\u6267\u884c\u8fd9\u4e2aload()\u51fd\u6570\u524d\uff0cNode\u51c6\u5907\u597d\u4e86module\u53d8\u91cf\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"var module = {\n    id: 'hello',\n    exports: {}\n};\n")),(0,o.kt)("p",null,"load()\u51fd\u6570\u6700\u7ec8\u8fd4\u56demodule.exports\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"var load = function (exports, module) {\n    // hello.js\u7684\u6587\u4ef6\u5185\u5bb9\n    ...\n    // load\u51fd\u6570\u8fd4\u56de:\n    return module.exports;\n};\n\nvar exportes = load(module.exports, module);\n")),(0,o.kt)("p",null,"\u4e5f\u5c31\u662f\u8bf4\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cNode\u51c6\u5907\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"exports"),"\u53d8\u91cf\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports"),"\u53d8\u91cf\u5b9e\u9645\u4e0a\u662f\u540c\u4e00\u4e2a\u53d8\u91cf\uff0c\u5e76\u4e14\u521d\u59cb\u5316\u4e3a\u7a7a\u5bf9\u8c61",(0,o.kt)("inlineCode",{parentName:"p"},"{}"),"\uff0c\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"exports.foo = function () { return 'foo'; };\nexports.bar = function () { return 'bar'; };\n")),(0,o.kt)("p",null,"\u4e5f\u53ef\u4ee5\u5199\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports.foo = function () { return 'foo'; };\nmodule.exports.bar = function () { return 'bar'; };\n")),(0,o.kt)("p",null,"\u6362\u53e5\u8bdd\u8bf4\uff0cNode\u9ed8\u8ba4\u7ed9\u4f60\u51c6\u5907\u4e86\u4e00\u4e2a\u7a7a\u5bf9\u8c61{}\uff0c\u8fd9\u6837\u4f60\u53ef\u4ee5\u76f4\u63a5\u5f80\u91cc\u9762\u52a0\u4e1c\u897f\u3002"),(0,o.kt)("p",null,"\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u8981\u8f93\u51fa\u7684\u662f\u4e00\u4e2a\u51fd\u6570\u6216\u6570\u7ec4\uff0c\u90a3\u4e48\uff0c\u53ea\u80fd\u7ed9module.exports\u8d4b\u503c\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = function () { return 'foo'; };\n")),(0,o.kt)("p",null,"\u7ed9exports\u8d4b\u503c\u662f\u65e0\u6548\u7684\uff0c\u56e0\u4e3a\u8d4b\u503c\u540e\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports"),"\u4ecd\u7136\u662f\u7a7a\u5bf9\u8c61",(0,o.kt)("inlineCode",{parentName:"p"},"{}\u3002")),(0,o.kt)("p",null,"\u7ed3\u8bba:"),(0,o.kt)("p",null,"\u5982\u679c\u8981\u8f93\u51fa\u4e00\u4e2a\u952e\u503c\u5bf9\u8c61",(0,o.kt)("inlineCode",{parentName:"p"},"{}"),"\uff0c\u53ef\u4ee5\u5229\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"exports"),"\u8fd9\u4e2a\u5df2\u5b58\u5728\u7684\u7a7a\u5bf9\u8c61",(0,o.kt)("inlineCode",{parentName:"p"},"{}"),"\uff0c\u5e76\u7ee7\u7eed\u5728\u4e0a\u9762\u6dfb\u52a0\u65b0\u7684\u952e\u503c\uff1b"),(0,o.kt)("p",null,"\u5982\u679c\u8981\u8f93\u51fa\u4e00\u4e2a\u51fd\u6570\u6216\u6570\u7ec4\uff0c\u5fc5\u987b\u76f4\u63a5\u5bf9",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports"),"\u5bf9\u8c61\u8d4b\u503c\u3002"),(0,o.kt)("p",null,"\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u7ed3\u8bba\uff1a\u76f4\u63a5\u5bf9",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports"),"\u8d4b\u503c\uff0c\u53ef\u4ee5\u5e94\u5bf9\u4efb\u4f55\u60c5\u51b5\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n    foo: function () { return 'foo'; }\n};\n\n// \u6216\u8005\nmodule.exports = function () { return 'foo'; };\n")),(0,o.kt)("p",null,"\u5efa\u8bae\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports = xxx"),"\u7684\u65b9\u5f0f\u6765\u8f93\u51fa\u6a21\u5757\u53d8\u91cf\uff0c\u8fd9\u6837\uff0c\u4f60\u53ea\u9700\u8981\u8bb0\u5fc6\u4e00\u79cd\u65b9\u6cd5\u3002"),(0,o.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://juejin.cn/post/6844904030905303054"},"\u6df1\u5165\u4e86\u89e3Nodejs\u6a21\u5757\u673a\u5236")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://nodejs.org/api/modules.html#modules_all_together"},"Node.js \u4f7f\u7528\u624b\u518c")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://www.ruanyifeng.com/blog/2015/05/require.html"},"require() \u6e90\u7801\u89e3\u8bfb")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://juejin.cn/post/6844904097556987917"},"\u963f\u91cc\u524d\u7aef\u653b\u57ce\u72ee\u4eec\u5199\u4e86\u4e00\u4efd\u524d\u7aef\u9762\u8bd5\u9898\u7b54\u6848\uff0c\u8bf7\u67e5\u6536"))))}u.isMDXComponent=!0}}]);