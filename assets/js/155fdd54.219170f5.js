"use strict";(self.webpackChunk_jeiiz_wiki_site=self.webpackChunk_jeiiz_wiki_site||[]).push([[5691],{50158:(e,n,t)=>{t.d(n,{Zo:()=>o,kt:()=>d});var a=t(46393);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=a.createContext({}),c=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},o=function(e){var n=c(e.components);return a.createElement(u.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,o=s(e,["components","mdxType","originalType","parentName"]),p=c(t),d=r,f=p["".concat(u,".").concat(d)]||p[d]||m[d]||l;return t?a.createElement(f,i(i({ref:n},o),{},{components:t})):a.createElement(f,i({ref:n},o))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=p;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<l;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},30915:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var a=t(39421),r=(t(46393),t(50158));const l={},i="\u67b6\u6784-\u4ee3\u6570\u6548\u5e94",s={unversionedId:"\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-\u4ee3\u6570\u6548\u5e94",id:"\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-\u4ee3\u6570\u6548\u5e94",title:"\u67b6\u6784-\u4ee3\u6570\u6548\u5e94",description:"\u4ee3\u6570\u6548\u5e94\u6709\u70b9\u7c7b\u4f3c\u50cftry/catch:",source:"@site/docs/06-\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-\u4ee3\u6570\u6548\u5e94.md",sourceDirName:"06-\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b",slug:"/\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-\u4ee3\u6570\u6548\u5e94",permalink:"/docs/\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-\u4ee3\u6570\u6548\u5e94",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u67b6\u6784-IoC&DIP&Reflect",permalink:"/docs/\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-IoC&DIP&Reflect"},next:{title:"\u67b6\u6784-\u5f02\u5e38\u76d1\u63a7",permalink:"/docs/\u67b6\u6784&\u6a21\u5f0f&\u5de5\u7a0b/\u67b6\u6784-\u5f02\u5e38\u76d1\u63a7"}},u={},c=[{value:"\u6ca1\u6709\u989c\u8272\u7684\u51fd\u6570",id:"\u6ca1\u6709\u989c\u8272\u7684\u51fd\u6570",level:2},{value:"\u5173\u4e8e\u7eaf\u51c0",id:"\u5173\u4e8e\u7eaf\u51c0",level:2},{value:"\u5173\u4e8e\u7c7b\u578b",id:"\u5173\u4e8e\u7c7b\u578b",level:2},{value:"\u4ee3\u6570\u6548\u5e94\u548cJS",id:"\u4ee3\u6570\u6548\u5e94\u548cjs",level:2},{value:"\u4ee3\u6570\u6548\u5e94\u548c\u5f02\u6b65\u7684\u533a\u522b",id:"\u4ee3\u6570\u6548\u5e94\u548c\u5f02\u6b65\u7684\u533a\u522b",level:2},{value:"\u5f02\u6b65\u6027\u4f1a\u611f\u67d3\u6240\u6709\u7684\u4e0a\u5c42\u8c03\u7528\u8005",id:"\u5f02\u6b65\u6027\u4f1a\u611f\u67d3\u6240\u6709\u7684\u4e0a\u5c42\u8c03\u7528\u8005",level:2},{value:"\u53ef\u590d\u7528\u6027\u7684\u533a\u522b",id:"\u53ef\u590d\u7528\u6027\u7684\u533a\u522b",level:2},{value:"\u4e0eGenerator Functions\u7684\u533a\u522b",id:"\u4e0egenerator-functions\u7684\u533a\u522b",level:2},{value:"React \u4e2d\u7684\u4ee3\u6570\u6548\u5e94",id:"react-\u4e2d\u7684\u4ee3\u6570\u6548\u5e94",level:2},{value:"Suspend",id:"suspend",level:2},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],o={toc:c};function m(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},o,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u67b6\u6784-\u4ee3\u6570\u6548\u5e94"},"\u67b6\u6784-\u4ee3\u6570\u6548\u5e94"),(0,r.kt)("p",null,"\u4ee3\u6570\u6548\u5e94\u6709\u70b9\u7c7b\u4f3c\u50cf",(0,r.kt)("inlineCode",{parentName:"p"},"try/catch"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getName(user) {\n  let name = user.name;\n  if (name === null) {\n    throw new Error('A girl has no name');\n  }\n  return name;\n}\n\nfunction makeFriends(user1, user2) {\n  user1.friendNames.add(getName(user2));\n  user2.friendNames.add(getName(user1));\n}\n\nconst arya = { name: null };\nconst gendry = { name: 'Gendry' };\ntry {\n  makeFriends(arya, gendry);\n} catch (err) {\n  console.log(\"Oops, that didn't work out: \", err);\n}\n")),(0,r.kt)("p",null,"\u4e0d\u540c\u7684\u662f, ",(0,r.kt)("inlineCode",{parentName:"p"},"catch"),"\u5728\u6355\u83b7\u5230\u9519\u8bef\u4e4b\u540e, \u5c31\u65e0\u6cd5\u56de\u5230\u539f\u6765\u7684\u4ee3\u7801\u7ee7\u7eed\u6267\u884c."),(0,r.kt)("p",null,'\u800c\u4ee3\u6570\u6548\u5e94, \u53ef\u4ee5"\u5947\u8ff9"\u822c\u7684\u56de\u5230\u539f\u6765\u7684\u5730\u65b9, \u7136\u540e\u7ee7\u7eed\u8fd0\u884c\u539f\u6765\u7684\u4ee3\u7801. '),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getName(user) {\n  let name = user.name;\n  if (name === null) {\n    name = perform 'ask_name';\n  }\n  return name;\n}\n\nfunction makeFriends(user1, user2) {\n  user1.friendNames.add(getName(user2));\n  user2.friendNames.add(getName(user1));\n}\n\nconst arya = { name: null };\nconst gendry = { name: 'Gendry' };\ntry {\n  makeFriends(arya, gendry);\n} handle (effect) {\n  if (effect === 'ask_name') {\n    resume with 'Arya Stark';\n  }\n}\n")),(0,r.kt)("p",null,"\u4e0d\u50cf\u4e4b\u524d, \u6211\u4eec\u6267\u884c\u4e86\u4e00\u4e2a'\u6548\u5e94'. \u5c31\u50cf\u6211\u4eec\u53ef\u4ee5",(0,r.kt)("inlineCode",{parentName:"p"},"throw"),"\u4efb\u4f55\u503c\u4e00\u6837, \u6211\u4eec\u4e5f\u53ef\u4ee5\u4f20\u7ed9",(0,r.kt)("inlineCode",{parentName:"p"},"preform"),"\u4efb\u4f55\u503c. \u8fd9\u4e2a\u4f8b\u5b50\u4e2d, \u4f20\u5165\u7684\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32."),(0,r.kt)("p",null,"\u5f53\u6211\u4eec",(0,r.kt)("inlineCode",{parentName:"p"},"perform"),"\u4e00\u4e2a\u6548\u5e94\u7684\u65f6\u5019, \u5f15\u64ce\u4f1a\u5728\u8c03\u7528\u63a8\u5c55\u4e2d\u5bfb\u627e\u6700\u8fd1\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"try/handle"),"\u6548\u5e94\u5904\u7406:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"try {\n  makeFriends(arya, gendry);\n} handle (effect) {\n  if (effect === 'ask_name') {\n    resume with 'Arya Stark';\n  }\n}\n")),(0,r.kt)("p",null,"\u7136\u540e, \u6211\u4eec\u53ef\u4ee5\u8df3\u56de\u5230\u6211\u4eec\u6267\u884c\u6548\u5e94\u7684\u5730\u65b9, \u5e76\u901a\u8fc7\u8fd9\u4e2a\u5904\u7406\u8bed\u53e5\u4f20\u56de\u4e00\u4e9b\u4e1c\u897f:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getName(user) {\n  let name = user.name;\n  if (name === null) {\n    // 1. \u6211\u4eec\u5728\u8fd9\u91cc\u6267\u884c\u6548\u5e94\n    name = perform 'ask_name';\n    // 4. ...\u6700\u540e\u56de\u5230\u8fd9\u91cc\uff08\u73b0\u5728 name \u662f 'Arya Stark'\uff09\u4e86\n  }\n  return name;\n}\n\n// ...\u5df4\u62c9\u5df4\u62c9\n\ntry {\n  makeFriends(arya, gendry);\n} handle (effect) {\n  // 2. \u6211\u4eec\u8fdb\u5165\u5904\u7406\u7a0b\u5e8f\uff08\u7c7b\u4f3c try/catch\uff09\n  if (effect === 'ask_name') {\n    // 3. \u4f46\u662f\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5e26\u4e00\u4e2a\u503c\u7ee7\u7eed\u6267\u884c\uff08\u4e0e try/catch \u4e0d\u540c!\uff09\n    resume with 'Arya Stark';\n  }\n}\n")),(0,r.kt)("p",null,"\u4ee3\u6570\u6548\u5e94, \u6bd4",(0,r.kt)("inlineCode",{parentName:"p"},"try/catch"),"\u7075\u6d3b\u7684\u591a, \u9519\u8bef\u6062\u590d\u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u7528\u6cd5\u800c\u5df2. "),(0,r.kt)("h2",{id:"\u6ca1\u6709\u989c\u8272\u7684\u51fd\u6570"},"\u6ca1\u6709\u989c\u8272\u7684\u51fd\u6570"),(0,r.kt)("p",null,"\u4ee3\u6570\u6548\u5e94\u4e3a\u5f02\u6b65\u4ee3\u7801\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6709\u8da3\u7684\u63d0\u793a."),(0,r.kt)("p",null,"\u5728\u5b9e\u73b0\u4e86",(0,r.kt)("inlineCode",{parentName:"p"},"async/await"),"\u7684\u8bed\u8a00\u4e2d, ",(0,r.kt)("strong",{parentName:"p"},"\u51fd\u6570\u5e38\u5e38\u662f\u6709\u989c\u8272\u7684"),". \u4e3e\u4e2a\u4f8b\u5b50, \u5728js\u4e2d, \u6211\u4eec\u4e0d\u80fd\u5355\u72ec\u5c06getname\n\u53d8\u6210\u5f02\u6b65\u7684, \u800c",(0,r.kt)("inlineCode",{parentName:"p"},"makeFriend"),"\u4ee5\u53ca\u5176\u4ed6\u7684\u4e0a\u5c42\u8c03\u7528\u8005\u4e0d\u53d8\u6210\u5f02\u6b65\u7684. \u4ed6\u4eec\u90fd\u8981\u53d8\u6210",(0,r.kt)("inlineCode",{parentName:"p"},"async"),"\u7684."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u5982\u679c\u6211\u4eec\u8981\u628a\u5b83\u53d8\u6210\u5f02\u6b65\u7684...\nasync getName(user) {\n  // ...\n}\n\n// \u90a3\u4e48\u8fd9\u91cc\u4e5f\u8981\u53d8\u6210\u5f02\u6b65\u7684...\nasync function makeFriends(user1, user2) {\n  user1.friendNames.add(await getName(user2));\n  user2.friendNames.add(await getName(user1));\n}\n\n// \u4ee5\u6b64\u7c7b\u63a8...\n")),(0,r.kt)("p",null,"\u5bf9\u4e8ejs\u7684generators\u4e5f\u662f\u7c7b\u4f3c\u7684. \u4f46\u662f\u5bf9\u4e8e\u6211\u4eec\u521a\u624d\u7684\u4f8b\u5b50\u6765\u8bf4, \u5374\u4e0d\u9700\u8981\u90a3\u4e48\u505a."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getName(user) {\n  let name = user.name;\n  if (name === null) {\n    name = perform 'ask_name';\n  }\n  return name;\n}\n\nfunction makeFriends(user1, user2) {\n  user1.friendNames.add(getName(user2));\n  user2.friendNames.add(getName(user1));\n}\n\nconst arya = { name: null };\nconst gendry = { name: 'Gendry' };\ntry {\n  makeFriends(arya, gendry);\n} handle (effect) {\n  if (effect === 'ask_name') {\n    setTimeout(() => {\n      resume with 'Arya Stark';\n    }, 1000);\n  }\n}\n")),(0,r.kt)("p",null,"\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d, \u6211\u4eec\u4f1a\u57281s\u540e\u8c03\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"resume with"),". \u4f60\u53ef\u4ee5\u4efb\u52a1",(0,r.kt)("inlineCode",{parentName:"p"},"resume with"),"\u662f\u4e00\u4e2a\u53ea\u80fd\u8c03\u7528\u4e00\u6b21\u7684\u56de\u8c03, \u4e5f\u53ef\u4ee5\u53eb\u4ed6",(0,r.kt)("inlineCode",{parentName:"p"},"\u5355\u6b21\u9650\u5b9a\u5ef6\u7eed(continuation)")),(0,r.kt)("p",null,"\u73b0\u5728, \u4ee3\u6570\u7684\u673a\u5236\u5e94\u8be5\u6e05\u6670\u4e00\u70b9\u4e86. \u5f53\u6211\u4eec",(0,r.kt)("inlineCode",{parentName:"p"},"throw"),"\u4e00\u4e2a\u9519\u8bef\u7684\u65f6\u5019, js\u5f15\u64ce\u91ca\u653e\u5806\u6808, \u9500\u6bc1\u8fd0\u884c\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf. \u7136\u800c, \u5f53\u6211\u4eec",(0,r.kt)("inlineCode",{parentName:"p"},"perform"),"\u4e00\u4e2a\u6548\u5e94, \u6211\u4eec\u5047\u5b9a\u7684\u5f15\u64ce\u4f1a\u7528\u4f59\u4e0b\u7684\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u56de\u8c03, \u7136\u540e\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"resume with"),"\u53bb\u8c03\u7528\u5b83."),(0,r.kt)("h2",{id:"\u5173\u4e8e\u7eaf\u51c0"},"\u5173\u4e8e\u7eaf\u51c0"),(0,r.kt)("p",null,"\u629b\u5f00\u51fd\u6570\u5f0f\u7f16\u7a0b\u7814\u7a76\u4ee3\u6570\u6548\u5e94\u662f\u6ca1\u6709\u610f\u4e49\u7684, \u56e0\u4e3a\u5b83\u4eec\u89e3\u51b3\u7684\u4e00\u4e9b\u95ee\u9898\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u4e2d\u7279\u6709\u7684. "),(0,r.kt)("p",null,"\u4e3e\u4e2a\u4f8b\u5b50\u6765\u8bf4, \u5728\u4e0d\u5141\u8bb8\u4ea7\u751f\u526f\u4f5c\u7528\u7684\u8bed\u8a00\u4e2d, \u5fc5\u987b\u4f7f\u7528\u60f3monads\u8fd9\u6837\u7684\u6982\u5ff5\u6765\u5c06\u6548\u5e94\u5f15\u5165\u4f60\u7684\u7a0b\u5e8f. \u5982\u679c\u4f60\u8bfb\u8fc7monad\u7684\u6559\u7a0b, \u5c31\u4f1a\u77e5\u9053\u4ed6\u4eec\u7406\u89e3\u8d77\u6765\u6709\u70b9\u5947\u602a. "),(0,r.kt)("p",null,"\u4ee3\u6570\u6548\u5e94\u53ef\u4ee5\u8ba9\u4f60\u5728\u5199\u4ee3\u7801\u7684\u65f6\u5019\u5173\u6ce8\u4f60\u5728\u505a\u4ec0\u4e48, \u4ece\u800c\u5c06",(0,r.kt)("inlineCode",{parentName:"p"},"what"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"how"),"\u5206\u79bb:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function enumerateFiles(dir) { // \u679a\u4e3e\u6587\u4ef6\n  const contents = perform OpenDirectory(dir);\n  perform Log('Enumerating files in ', dir);\n  for (let file of contents.files) {\n    perform HandleFile(file);\n  }\n  perform Log('Enumerating subdirectories in ', dir);\n  for (let directory of contents.dir) {\n    // \u9012\u5f52\u6216\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u65f6\uff0c\u4e5f\u53ef\u4f7f\u7528 effects\u3002\n    enumerateFiles(directory);\n  }\n  perform Log('Done');\n}\n")),(0,r.kt)("p",null,"\u968f\u540e, \u5c06\u5b83\u5305\u542b\u5728\u5b9e\u73b0\u4e86\u600e\u4e48\u6837\u5904\u7406\u7684\u5757\u4e2d:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let files = [];\ntry {\n  enumerateFiles('C:\\\\');\n} handle (effect) {\n  if (effect instanceof Log) {\n    myLoggingLibrary.log(effect.message);\n    resume;\n  } else if (effect instanceof OpenDirectory) {\n    myFileSystemImpl.openDir(effect.dirName, (contents) => {\n      resume with contents;\n    });\n  } else if (effect instanceof HandleFile) {\n    files.push(effect.fileName);\n    resume;\n  }\n}\n// \u73b0\u5728 `files` \u6570\u7ec4\u4e2d\u6709\u6240\u6709\u7684\u6587\u4ef6\u5566\n")),(0,r.kt)("p",null,"\u8fd9\u610f\u5473\u7740\u8fd9\u4e9b\u7247\u6bb5\u5347\u804c\u53ef\u4ee5\u88ab\u6253\u5305\u6536\u5f55\u8d77\u6765:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { withMyLoggingLibrary } from 'my-log';\nimport { withMyFileSystem } from 'my-fs';\n\nfunction ourProgram() {\n  enumerateFiles('C:\\\\');\n}\n\nwithMyLoggingLibrary(() => {\n  withMyFileSystem(() => {\n    ourProgram();\n  });\n});\n")),(0,r.kt)("p",null,"\u800c\u4e14\u4e0d\u60f3",(0,r.kt)("inlineCode",{parentName:"p"},"async/await"),"\u6216\u8005",(0,r.kt)("inlineCode",{parentName:"p"},"Generators"),", \u4ee3\u6570\u6548\u5e94\u4e0d\u4f1a\u590d\u6742\u5316\u4e2d\u95f4\u7684\u51fd\u6570(\u611f\u67d3\u4e0a\u5c42\u8c03\u7528\u8005). "),(0,r.kt)("h2",{id:"\u5173\u4e8e\u7c7b\u578b"},"\u5173\u4e8e\u7c7b\u578b"),(0,r.kt)("p",null,"\u4ee3\u6570\u6548\u5e94\u6e90\u4e8e\u9759\u6001\u7c7b\u578b\u8bed\u8a00, \u6240\u4ee5\u5173\u4e8e\u4ed6\u4eec\u7684\u5927\u90e8\u5206\u4e89\u8bba\u96c6\u4e2d\u5728\u4ed6\u4eec\u7c7b\u578b\u8868\u8fbe\u7684\u65b9\u5f0f. "),(0,r.kt)("p",null,"\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u53ef\u4ee5\u6267\u884c\u6548\u5e94, \u901a\u5e38\u6765\u8bf4\u8fd9\u56de\u88ab\u7f16\u7801\u8fdb\u5b83\u7684\u7c7b\u578b\u7b7e\u540d\u4e2d. \u6240\u4ee5\u4f60\u4e0d\u80fd\u5728\u4e00\u4e2a\u968f\u673a\u6548\u5e94\u6b63\u5728\u53d1\u751f\u7684\u60c5\u51b5\u4e0b\u7ed3\u675f, \u5426\u5219\u4f60\u65e0\u6cd5\u8ffd\u8e2a\u4ed6\u4eec\u7684\u6765\u6e90."),(0,r.kt)("p",null,'\u8fd9\u6837\u7684\u8bdd, \u76f8\u5f53\u4e8e\u5728\u6280\u672f\u4e0a\u4ee3\u6570\u6548\u5e94\u4e5f\u4e3a\u51fd\u6570"\u8d4b\u4e88\u4e86\u989c\u8272", \u56e0\u4e3a\u5728\u9759\u6001\u7c7b\u578b\u8bed\u8a00\u4e2d\u6548\u5e94\u662f\u7c7b\u578b\u7b7e\u540d\u7684\u4e00\u90e8\u5206. \u4f46\u662f\u4e3a\u4e86\u5f15\u5165\u65b0\u6548\u5e94\u800c\u4fee\u590d\u4e2d\u95f4\u51fd\u6570\u7684\u7c7b\u578b\u6ce8\u91ca, \u8fd9\u4ef6\u4e8b\u672c\u8eab\u4e0d\u662f\u8bed\u4e49\u7684\u7684\u66f4\u6539. \u8fd9\u4e2a\u63a8\u65ad\u8fd8\u53ef\u4ee5\u5e2e\u52a9\u907f\u514d\u7ea7\u8054\u66f4\u6539. '),(0,r.kt)("h2",{id:"\u4ee3\u6570\u6548\u5e94\u548cjs"},"\u4ee3\u6570\u6548\u5e94\u548cJS"),(0,r.kt)("p",null,"\u9002\u5408\u90a3\u4e9b\u53d8\u5316\u4e0d\u5e38\u89c1,\u4e14\u6807\u51c6\u5e93\u5b8c\u5168\u62e5\u62b1effect\u7684\u8bed\u8a00. "),(0,r.kt)("h2",{id:"\u4ee3\u6570\u6548\u5e94\u548c\u5f02\u6b65\u7684\u533a\u522b"},"\u4ee3\u6570\u6548\u5e94\u548c\u5f02\u6b65\u7684\u533a\u522b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function getName(user) {\n  let name = user.name;\n  if (name === null) {\n      name = await getDefaultNameFromServer();\n  }\n  return name;\n}\n\nasync function makeFriends(user1, user2) {\n  user1.friendNames.push(await getName(user2));\n  user2.friendNames.push(await getName(user1));\n}\n\nconst arya = { name: null, friendNames: [] };\nconst gendry = { name: 'Gendry', friendNames: [] };\n\nmakeFriends(arya, gendry)\n  .then(() => console.log('done!'));\n")),(0,r.kt)("h2",{id:"\u5f02\u6b65\u6027\u4f1a\u611f\u67d3\u6240\u6709\u7684\u4e0a\u5c42\u8c03\u7528\u8005"},"\u5f02\u6b65\u6027\u4f1a\u611f\u67d3\u6240\u6709\u7684\u4e0a\u5c42\u8c03\u7528\u8005"),(0,r.kt)("p",null,"\u73b0\u5728\u53ef\u4ee5\u53d1\u73b0, ",(0,r.kt)("inlineCode",{parentName:"p"},"makeFriends"),"\u73b0\u5728\u53d8\u6210\u5f02\u6b65\u7684\u4e86. \u8fd9\u662f\u56e0\u4e3a\u5f02\u6b65\u6027\u4f1a\u611f\u67d3\u6240\u6709\u7684\u4e0a\u5c42\u8c03\u7528\u8005. \u5982\u679c\u8981\u5c06\u67d0\u4e2a\u51fd\u6570\u6539\u6210async\u51fd\u6570, \u662f\u975e\u5e38\u56f0\u96be\u7684, \u56e0\u6b64\u5b83\u7684\u6240\u6709\u4e0a\u5c42\u8c03\u7528\u8005\u90fd\u9700\u8981\u4fee\u6539"),(0,r.kt)("p",null,"\u800c\u5728\u524d\u9762\u7684Algebric Effects\u4e2d, \u4e2d\u95f4\u8c03\u7528\u8005",(0,r.kt)("inlineCode",{parentName:"p"},"makeFriends"),"\u5bf9Algebraic Effect\u662f\u5b8c\u5168\u65e0\u611f\u7684. \u53ea\u8981\u5728\u67d0\u4e2a\u4e0a\u5c42\u8c03\u7528\u8005\u63d0\u4f9b\u4e86effect handle\u5c31\u53ef\u4ee5\u4e86. "),(0,r.kt)("h2",{id:"\u53ef\u590d\u7528\u6027\u7684\u533a\u522b"},"\u53ef\u590d\u7528\u6027\u7684\u533a\u522b"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"getName"),"\u76f4\u63a5\u8026\u5408\u4e86\u526f\u4f5c\u7528\u65b9\u6cd5",(0,r.kt)("inlineCode",{parentName:"p"},"getDefaultNameFromServer"),". \u800c\u5728\u524d\u9762\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"Algebraic Effects"),'\u7684\u4f8b\u5b50\u4e2d, \u526f\u4f5c\u7528\u7684\u6267\u884c\u903b\u8f91\u662f"\u5728\u8fd0\u884c\u65f6", "\u901a\u8fc7\u8c03\u7528\u5173\u7cfb", "\u52a8\u6001\u7684"\u51b3\u5b9a\u7684. \u8fd9\u5927\u5927\u589e\u5f3a\u4e86getName\u7684\u53ef\u590d\u7528\u6027. '),(0,r.kt)("p",null,"\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u6765\u8fbe\u5230\u76f8\u4f3c\u7684\u53ef\u590d\u7528\u6027. "),(0,r.kt)("h2",{id:"\u4e0egenerator-functions\u7684\u533a\u522b"},"\u4e0eGenerator Functions\u7684\u533a\u522b"),(0,r.kt)("p",null,"Generator Function\u7684\u8c03\u7528\u8005\u5728\u8c03\u7528Generator Function\u65f6\u4e5f\u662f\u6709\u611f\u7684\u3002Generator Function\u5c06\u7a0b\u5e8f\u63a7\u5236\u6743\u4ea4\u7ed9\u5b83\u7684\u76f4\u63a5\u8c03\u7528\u8005\uff0c\u5e76\u4e14\u53ea\u80fd\u7531\u76f4\u63a5\u8c03\u7528\u8005\u6765\u6062\u590d\u6267\u884c\u3001\u63d0\u4f9b\u7ed3\u679c\u503c\u3002"),(0,r.kt)("p",null,"\u76f4\u63a5\u8c03\u7528\u8005\u4e5f\u53ef\u4ee5\u5c06\u7a0b\u5e8f\u63a7\u5236\u6743\u7ee7\u7eed\u6cbf\u7740\u6267\u884c\u6808\u7ee7\u7eed\u5411\u4e0a\u4ea4, \u76f4\u5230\u9047\u5230\u80fd\u63d0\u4f9b\u7ed3\u679c\u7684\u8c03\u7528\u8005"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"function* getName(user) {\n  let name = user.name;\n  if (name === null) {\n      name = yield 'ask_name'; // perform an effect to get a default name!\n  }\n  return name;\n}\n\nfunction* makeFriends(user1, user2) {\n  user1.friendNames.push(yield* getName(user2));\n  user2.friendNames.push(yield* getName(user1));\n}\n\nasync function main() {\n  const arya = { name: null, friendNames: [] };\n  const gendry = { name: 'Gendry', friendNames: [] };\n  \n  let gen = makeFriends(arya, gendry);\n  let state = gen.next();\n  while(!state.done) {\n      if (state.value === 'ask_name') {\n          state = gen.next(await getDefaultNameFromServer());\n      }\n  }\n}\n")),(0,r.kt)("p",null,"reudx-saga\u5c31\u662f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"Generator Function"),", \u5c06\u526f\u4f5c\u7528\u7684\u6267\u884c\u4ecesaga\u4e2d\u62bd\u79bb, saga\u53ea\u9700\u8981\u5411\u8c03\u7528\u8005\u53d1\u51fa\u526f\u4f5c\u7528\u8bf7\u6c42, \u5e76\u5c06\u6267\u884c\u6743\u4ea4\u7ed9\u8c03\u7528\u8005, \u800c\u4e0d\u81ea\u5df1\u6267\u884c\u526f\u4f5c\u7528."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// \u8fd9\u662f\u4e00\u4e2asaga\nfunction* fetchUser(action) {\n   try {\n      const user = yield call(Api.fetchUser, action.payload.userId);\n      yield put({type: "USER_FETCH_SUCCEEDED", user: user});\n   } catch (e) {\n      yield put({type: "USER_FETCH_FAILED", message: e.message});\n   }\n}\n')),(0,r.kt)("p",null,"\u7406\u8bba\u53ef\u4ee5\u7528generator function\u7684\u63a7\u5236\u6743\u8f6c\u79fb\u6765\u5b9e\u73b0Algebraic Effect. \u4f46\u662f\u65e0\u6cd5\u907f\u514d\u611f\u67d3\u8c03\u7528\u8005\u7684\u95ee\u9898, \u65e0\u6cd5\u5411\u771f\u6b63\u7684Algebric Effects\u90a3\u6837\u8ba9\u8c03\u7528\u8005\u65e0\u611f\u77e5."),(0,r.kt)("p",null,"\u4f60\u9700\u8981\u5c06\u6240\u6709\u7684Functional Component\u3001custom hooks\u90fd\u6539\u9020\u6210generator function\u3002\u5e76\u4e14generator function\u53ea\u80fd\u4ece\u4e0a\u6b21yield\u7684\u5730\u65b9\u6062\u590d\u6267\u884c\uff0c\u800c\u4e0d\u80fd\u6062\u590d\u5230\u66f4\u65e9\u7684yield\u72b6\u6001\u3002"),(0,r.kt)("h2",{id:"react-\u4e2d\u7684\u4ee3\u6570\u6548\u5e94"},"React \u4e2d\u7684\u4ee3\u6570\u6548\u5e94"),(0,r.kt)("p",null,"js\u81ea\u5df1\u5e76\u4e0d\u652f\u6301Algebraic Effect. \u5f97\u76ca\u4e8eReact\u81ea\u5df1\u5b9e\u73b0\u7684Fiber\u6a21\u578b, \u53ef\u4ee5\u63d0\u4f9b\u6377\u5f84Algebric Effects\u7684\u80fd\u529b."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://segmentfault.com/a/1190000020110045#item-3-1"},'React Fiber\u67b6\u6784\uff1a\u53ef\u63a7\u7684"\u8c03\u7528\u6808"')),(0,r.kt)("h2",{id:"suspend"},"Suspend"),(0,r.kt)("p",null,"Suspend\u5c31\u662f\u4e00\u4e2a\u4f8b\u5b50, React\u5728\u6e32\u67d3\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u5c1a\u672a\u5c31\u7eea\u7684\u6570\u636e\u65f6, \u80fd\u591f\u6682\u505c\u6e32\u67d3. \u7b49\u5230\u6570\u636e\u5c31\u7eea\u7684\u65f6\u5019\u518d\u7ee7\u7eed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// cache\u76f8\u5173\u7684API\u6765\u81eaReact\u56e2\u961f\u6b63\u5728\u5f00\u53d1\u7684react-cache\uff1a\n// https://github.com/facebook/react/tree/master/packages/react-cache\nconst cache = createCache();\nconst UserResource = createResource(fetchUser); // fetchUser is async\n\nconst User = (props) => {\n    const user = UserResource.read( // \u7528\u540c\u6b65\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u5f02\u6b65\u4ee3\u7801!\n        cache,\n          props.id\n    );\n  return <h3>{user.name}</h3>;\n}\n\nfunction App() {\n  return (\n    <div>\n      <Suspense fallback={<div>Loading...</div>}>\n        <User id={123} />\n      </Suspense>\n    </div>\n  );\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"react-cache"),"\u662fReact\u56e2\u961f\u6b63\u5728\u5f00\u53d1\u7684\u7279\u6027, \u5c06",(0,r.kt)("inlineCode",{parentName:"p"},"Suspense"),"\u7528\u4e8e\u6570\u636e\u83b7\u53d6\u7684\u573a\u666f, \u8ba9\u9700\u8981\u7b49\u5f85\u6570\u636e\u7684\u7ec4\u4ef6\u6682\u505c\u6e32\u67d3. "),(0,r.kt)("p",null,"\u76ee\u524d\u5df2\u7ecf\u53d1\u5e03\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"React.lazy"),"\u6765\u6682\u505c\u6e32\u67d3\u7684\u80fd\u529b, \u5176\u5b9e\u4e5f\u662f\u7c7b\u4f3c\u7684\u539f\u7406"),(0,r.kt)("p",null,"\u5728\u5fc3\u667a\u6a21\u578b\u4e2d, ",(0,r.kt)("inlineCode",{parentName:"p"},"UserResource.read"),"\u53ef\u4ee5\u770b\u505a\u53d1\u8d77\u4e86\u4e00\u4e2a Algebraic Effect. User\u53d1\u51fa\u8fd9\u4e2aeffect\u4ee5\u540e, \u63a7\u5236\u6743\u5c31\u6682\u65f6\u4ea4\u7ed9\u4e86React(React\u662fUser\u7684\u8c03\u7528\u8005). React scheduler\u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684effect handler, \u68c0\u67e5cache\u4e2d\u662f\u5426\u6709\u5bf9\u5e94id\u7684user:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u5728cache\u4e2d, \u5219\u7acb\u5373\u5c06\u63a7\u5236\u6743\u4ea4\u8fd8\u7ed9User, \u5e76\u63d0\u4f9b\u5bf9\u5e94\u7684user\u6570\u636e"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e0d\u5728cache\u4e2d, \u5219\u8c03\u7528fetchUser\u4ece\u7f51\u7edc\u8bf7\u6c42\u5bf9\u5e94id\u7684user, \u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d, \u6e32\u67d3\u6682\u505c, suspense\u6e32\u67d3fallback\u89c6\u56fe. \u5f97\u5230\u7ed3\u679c\u4ee5\u540e, \u5c06\u63a7\u5236\u6743\u4ea4\u8fd8\u7ed9User, \u5e76\u63d0\u4f9b\u5bf9\u5e94\u7684\u6570\u636e.")),(0,r.kt)("p",null,"\u5728\u5b9e\u9645\u5b9e\u73b0\u4e2d, \u4ed6\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"throw"),"\u6765\u6a21\u62dfAlgebraic Effect. \u5982\u679c\u6570\u636e\u5c1a\u672a\u51c6\u5907\u597d, UserResource.read\u4f1a\u629b\u51fa\u4e00\u4e2a\u7279\u6b8a\u7684Promise, \u5f97\u76ca\u4e8eReact Fiber\u67b6\u6784, \u8c03\u7528\u6808\u5e76\u4e0d\u662fReact scheduler=>App=>User, \u800c\u662f\u5148React scheduler=>App, \u7136\u540e",(0,r.kt)("inlineCode",{parentName:"p"},"React scheduler=>User"),"."),(0,r.kt)("p",null,"\u56e0\u6b64User\u7ec4\u4ef6\u629b\u51fa\u7684\u9519\u8bef\u4f1a\u88abReact scheduler\u63a5\u4f4f, \u7136\u540e\u5c06\u6e32\u67d3\u6682\u505c\u5728User\u7ec4\u4ef6. \u8fd9\u610f\u5473\u7740\u524d\u9762\u7684App\u7ec4\u4ef6\u7684\u5de5\u4f5c\u4e0d\u4f1a\u4e22\u5931, \u7b49\u5230promise\u89e3\u6790\u5230\u6570\u636e\u4ee5\u540e, \u5c06\u4eceUser Fiber\u7ee7\u7eed\u6e32\u67d3. \u7ee7\u7eed\u6e32\u67d3\u7684\u65b9\u5f0f: React scheduler\u4ece\u4e0a\u6b21\u6682\u505c\u7684\u7ec4\u4ef6\u5f00\u59cb, \u8c03\u7528render\u8fdb\u884c\u6e32\u67d3, \u8fd9\u6b21\u6e32\u67d3\u7684\u65f6\u5019User\u7ec4\u4ef6\u80fd\u591f\u7528\u4ececache\u7acb\u5373\u62ff\u5230\u6570\u636e"),(0,r.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/76158581"},"\u5199\u7ed9\u90a3\u4e9b\u641e\u4e0d\u61c2\u4ee3\u6570\u6548\u5e94\u7684\u6211\u4eec")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://segmentfault.com/a/1190000020110166"},"Algebraic Effects\uff0c\u4ee5\u53ca\u5b83\u5728React\u4e2d\u7684\u5e94\u7528"))))}m.isMDXComponent=!0}}]);